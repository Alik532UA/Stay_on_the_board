# üìÅ Stores (`/lib/stores`)

–¶–µ–π –∫–∞—Ç–∞–ª–æ–≥ –º—ñ—Å—Ç–∏—Ç—å **Svelte Stores** ‚Äî —Ä–µ–∞–∫—Ç–∏–≤–Ω—ñ —Å—Ö–æ–≤–∏—â–∞ —Å—Ç–∞–Ω—É –¥–æ–¥–∞—Ç–∫—É. –°—Ç–æ—Ä–∏ —î **SSoT (Single Source of Truth)** –¥–ª—è –≤—Å—ñ—Ö –¥–∞–Ω–∏—Ö.

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–∞ —Ä–æ–ª—å

```mermaid
graph TD
    Stores[(Stores)] --> |subscribe| UI[UI Components]
    Services --> |update| Stores
    GameModes --> |update via services| Stores
    Stores --> |derived| DerivedStores[(Derived Stores)]
```

## üìù –ö–æ–Ω–≤–µ–Ω—Ü—ñ—ó

1. **–Ü–º–µ–Ω—É–≤–∞–Ω–Ω—è**: `<–Ω–∞–∑–≤–∞>Store.ts` (–Ω–∞–ø—Ä. `boardStore.ts`)
2. **–ï–∫—Å–ø–æ—Ä—Ç**: 
   - –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å—Ç–∞–Ω—É: `export interface XyzState { ... }`
   - –°—Ç–æ—Ä: `export const xyzStore = createXyzStore();`
3. **–§–∞–±—Ä–∏–∫–∞**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –ø–∞—Ç–µ—Ä–Ω —Ñ–∞–±—Ä–∏–∫–∏ `createXyzStore()` –¥–ª—è —ñ–Ω–∫–∞–ø—Å—É–ª—è—Ü—ñ—ó
4. **–ë–µ–∑ –ø–æ–±—ñ—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤**: –°—Ç–æ—Ä–∏ –ù–ï –≤–∏–∫–ª–∏–∫–∞—é—Ç—å API, DOM, —Ç–∞–π–º–µ—Ä–∏
5. **–¢–∏–ø—ñ–∑–∞—Ü—ñ—è**: –í—Å—ñ —Å—Ç–æ—Ä–∏ –º–∞—é—Ç—å —Å—Ç—Ä–æ–≥–æ —Ç–∏–ø—ñ–∑–æ–≤–∞–Ω–∏–π —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üìö –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó —Å—Ç–æ—Ä—ñ–≤

### –Ü–≥—Ä–æ–≤–∏–π —Å—Ç–∞–Ω (Core Game State)
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | SSoT –¥–ª—è |
|:-----|:------------|:---------|
| `boardStore.ts` | –°—Ç–∞–Ω –¥–æ—à–∫–∏ | –ü–æ–∑–∏—Ü—ñ—è —Ñ—ñ—à–∫–∏, —Ä–æ–∑–º—ñ—Ä, –≤—ñ–¥–≤—ñ–¥–∞–Ω—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏ |
| `playerStore.ts` | –°—Ç–∞–Ω –≥—Ä–∞–≤—Ü—ñ–≤ | –°–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤, –ø–æ—Ç–æ—á–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å |
| `scoreStore.ts` | –°—Ç–∞–Ω —Ä–∞—Ö—É–Ω–∫—É | –ë–∞–ª–∏, –±–æ–Ω—É—Å–∏, —à—Ç—Ä–∞—Ñ–∏ |
| `uiStateStore.ts` | –°—Ç–∞–Ω UI –≥—Ä–∏ | –í–∏–±—Ä–∞–Ω–∏–π –Ω–∞–ø—Ä—è–º–æ–∫, isGameOver |
| `gameStore.ts` | –ê–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º –≥—Ä–∏ | –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ IGameMode |
| `gameOverStore.ts` | –î–∞–Ω—ñ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≥—Ä–∏ | –ü–µ—Ä–µ–º–æ–∂–µ—Ü—å, –ø—Ä–∏—á–∏–Ω–∞ |

### –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è | SSoT –¥–ª—è |
|:-----|:------------|:---------|
| `gameSettingsStore.ts` | –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –≥—Ä–∏ | –†–æ–∑–º—ñ—Ä –¥–æ—à–∫–∏, Block Mode, –≥–æ–ª–æ—Å |
| `appSettingsStore.ts` | –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫—É | –ú–æ–≤–∞, —Ç–µ–º–∞ |

### –ü–æ—Ö—ñ–¥–Ω–∏–π —Å—Ç–∞–Ω (Derived)
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `derivedState.ts` | –û–±—á–∏—Å–ª—é–≤–∞–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è: `currentPlayer`, `visualPosition`, `isPlayerTurn` |
| `availableMovesStore.ts` | –î–æ—Å—Ç—É–ø–Ω—ñ —Ö–æ–¥–∏ (–æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è —Å–µ—Ä–≤—ñ—Å–æ–º) |

### UI/UX
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `modalStore.ts` | –°—Ç–∞–Ω –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω (—Å—Ç–µ–∫) |
| `animationStore.ts` | –ß–µ—Ä–≥–∞ –∞–Ω—ñ–º–∞—Ü—ñ–π |
| `layoutStore.ts` | –†–æ–∑—Ç–∞—à—É–≤–∞–Ω–Ω—è –∫–æ–ª–æ–Ω–æ–∫ |
| `tooltipStore.ts` | –ü—ñ–¥–∫–∞–∑–∫–∏ |
| `uiEffectsStore.ts` | –í—ñ–∑—É–∞–ª—å–Ω—ñ –µ—Ñ–µ–∫—Ç–∏ |
| `focusManager.ts` | –ö–µ—Ä—É–≤–∞–Ω–Ω—è —Ñ–æ–∫—É—Å–æ–º |

### –¢–∞–π–º–µ—Ä–∏
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `timerStore.ts` | –ó–∞–ª–∏—à–∫–æ–≤–∏–π —á–∞—Å –≥—Ä–∏/—Ö–æ–¥—É |

### –°–ø–µ—Ü—ñ–∞–ª—å–Ω—ñ —Ä–µ–∂–∏–º–∏
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `gameModeStore.ts` | –ê–∫—Ç–∏–≤–Ω–∏–π —Ä–µ–∂–∏–º (training/local/online) |
| `testModeStore.ts` | –¢–µ—Å—Ç–æ–≤–∏–π —Ä–µ–∂–∏–º (–¥–ª—è e2e —Ç–µ—Å—Ç—ñ–≤) |
| `replayStore.ts` | –ü–µ—Ä–µ–≥–ª—è–¥ –ø–æ–≤—Ç–æ—Ä—É –≥—Ä–∏ |
| `replayAutoPlayStore.ts` | –ê–≤—Ç–æ–ø—Ä–æ–≥—Ä–∞–≤–∞–Ω–Ω—è –ø–æ–≤—Ç–æ—Ä—É |

### –ì–æ–ª–æ—Å
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `voiceStore.ts` | –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –≥–æ–ª–æ—Å—ñ–≤ |
| `voiceControlStore.ts` | –°—Ç–∞–Ω –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∫–µ—Ä—É–≤–∞–Ω–Ω—è |

### –ù–∞–≥–æ—Ä–æ–¥–∏
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `rewardsStore.ts` | –î–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å |

### –Ü–Ω—à—ñ
| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
|:-----|:------------|
| `debugLogStore.ts` | –õ–æ–≥–∏ –¥–ª—è –≤—ñ–¥–ª–∞–¥–∫–∏ |
| `versionStore.ts` | –í–µ—Ä—Å—ñ—è –¥–æ–¥–∞—Ç–∫—É |
| `notificationStore.ts` | –ù–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó |
| `isModalOpenStore.ts` | –ß–∏ –≤—ñ–¥–∫—Ä–∏—Ç–æ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ |

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤—ñ –ø—Ä–∞–≤–∏–ª–∞

> [!CAUTION]
> **SSoT:** –ö–æ–∂–µ–Ω —Ñ—Ä–∞–≥–º–µ–Ω—Ç –¥–∞–Ω–∏—Ö –º–∞—î –û–î–ù–ï –¥–∂–µ—Ä–µ–ª–æ –ø—Ä–∞–≤–¥–∏. –ù–ï –¥—É–±–ª—é–≤–∞—Ç–∏ —Å—Ç–∞–Ω –º—ñ–∂ —Å—Ç–æ—Ä–∞–º–∏.

> [!WARNING]
> - –ù–ï –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `store.set()` –Ω–∞–ø—Ä—è–º—É –∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏
> - –ù–ï –∑–±–µ—Ä—ñ–≥–∞—Ç–∏ –ø–æ—Ö—ñ–¥–Ω—ñ –¥–∞–Ω—ñ ‚Äî –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `derived()`
> - –ù–ï –º—É—Ç—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç–∏ –Ω–∞–ø—Ä—è–º—É ‚Äî –∑–∞–≤–∂–¥–∏ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ –Ω–æ–≤–∏–π –æ–±'—î–∫—Ç

> [!IMPORTANT]
> –î–ª—è —Å–∫–ª–∞–¥–Ω–∏—Ö –æ–Ω–æ–≤–ª–µ–Ω—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ —Å—Ç–æ—Ä—É –∑–∞–º—ñ—Å—Ç—å `update()`:
> ```typescript
> // ‚ùå –ü–æ–≥–∞–Ω–æ
> boardStore.update(s => ({ ...s, playerRow: 1 }))
> 
> // ‚úÖ –î–æ–±—Ä–µ
> boardStore.movePlayer(1, 2)
> ```

## üîó –ó–∞–ª–µ–∂–Ω–æ—Å—Ç—ñ

- –°—Ç–æ—Ä–∏ –º–æ–∂—É—Ç—å —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏:
  - –Ü–Ω—à—ñ —Å—Ç–æ—Ä–∏ (—Ç—ñ–ª—å–∫–∏ –¥–ª—è `derived()`)
  - `logService` (–¥–ª—è –ª–æ–≥—É–≤–∞–Ω–Ω—è)
  - –¢–∏–ø–∏ —Ç–∞ —É—Ç–∏–ª—ñ—Ç–∏
- –°—Ç–æ—Ä–∏ –ù–ï –ø–æ–≤–∏–Ω–Ω—ñ —ñ–º–ø–æ—Ä—Ç—É–≤–∞—Ç–∏:
  - –°–µ—Ä–≤—ñ—Å–∏ (–∫—Ä—ñ–º `logService`)
  - Svelte-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
