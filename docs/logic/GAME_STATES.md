# Стани гри та переходи

Цей документ описує всі стани гри "Stay on the Board" та переходи між ними.

## Основні стани гри

### 1. Початковий стан (Initial State)
- **Опис**: Гра ще не почалася
- **Елементи**: Дошка порожня, фігура не розміщена
- **Доступні дії**: Вибір розміру дошки, налаштування
- **Переходи**: 
  - → Стан розміщення фігури (після натискання "Почати гру")

### 2. Стан розміщення фігури (Piece Placement State)
- **Опис**: Фігура розміщується випадково на дошці
- **Елементи**: Фігура з'являється на випадковій клітинці
- **Доступні дії**: Немає (автоматичний перехід)
- **Переходи**: 
  - → Стан вибору ходу гравця (автоматично)

### 3. Стан вибору ходу гравця (Player Turn State)
- **Опис**: Гравець вибирає свій хід
- **Елементи**: 
  - Кнопки напрямку активні
  - Кнопки відстані активні
  - Центральна кнопка показує вибір
  - Кнопка "Немає ходів" активна
- **Доступні дії**: 
  - Вибір напрямку
  - Вибір відстані
  - Підтвердження ходу
  - Заява "Немає ходів"
- **Переходи**: 
  - → Стан виконання ходу гравця (після підтвердження)
  - → Стан перевірки "Немає ходів" (після заяви)

### 4. Стан виконання ходу гравця (Player Move Execution State)
- **Опис**: Хід гравця виконується
- **Елементи**: 
  - Всі кнопки керування неактивні
  - Фігура рухається на нову позицію
  - Очки оновлюються
- **Доступні дії**: Немає (автоматичний перехід)
- **Переходи**: 
  - → Стан перевірки кінця гри (після руху)
  - → Стан ходу комп'ютера (якщо гра з комп'ютером, хід комп'ютера виконується одразу автоматично після ходу гравця)
  - → Стан вибору ходу гравця (якщо локальна гра)

### 5. Стан ходу комп'ютера (Computer Turn State)
- **Опис**: Комп'ютер вибирає та виконує свій хід
- **Елементи**: 
  - Всі кнопки керування неактивні
  - Повідомлення "Хід комп'ютера..."
  - Затримка 1 секунда
- **Доступні дії**: Немає (автоматичний перехід)
- **Переходи**: 
  - → Стан виконання ходу комп'ютера (після затримки)

### 6. Стан виконання ходу комп'ютера (Computer Move Execution State)
- **Опис**: Хід комп'ютера виконується
- **Елементи**: 
  - Фігура рухається на нову позицію
  - Центральна кнопка показує хід комп'ютера
- **Доступні дії**: Немає (автоматичний перехід)
- **Переходи**: 
  - → Стан перевірки кінця гри (після руху)

### 7. Стан перевірки "Немає ходів" (No Moves Check State)
- **Опис**: Система перевіряє наявність ходів
- **Елементи**: 
  - Всі кнопки керування неактивні
  - Повідомлення "Перевіряємо ходи..."
- **Доступні дії**: Немає (автоматичний перехід)
- **Переходи**: 
  - → Стан перемоги гравця (якщо ходів дійсно немає)
  - → Стан поразки гравця (якщо ходи є)

### 8. Стан перевірки кінця гри (Game End Check State)
- **Опис**: Система перевіряє чи гра закінчена
- **Елементи**: 
  - Перевірка виходу за межі дошки
  - Перевірка потрапляння на заблоковану клітинку
- **Доступні дії**: Немає (автоматичний перехід)
- **Переходи**: 
  - → Стан поразки (якщо гравець програє)
  - → Стан вибору ходу гравця (якщо гра продовжується)

### 9. Стан перемоги (Victory State)
- **Опис**: Гравець перемагає
- **Елементи**: 
  - Модальне вікно з повідомленням про перемогу
  - Фінальний рахунок
  - Кнопки "Нова гра", "Меню"
- **Доступні дії**: 
  - Почати нову гру
  - Повернутися в меню
- **Переходи**: 
  - → Стан початковий (нова гра)
  - → Головне меню

### 10. Стан поразки (Defeat State)
- **Опис**: Гравець програє
- **Елементи**: 
  - Модальне вікно з повідомленням про поразку
  - Фінальний рахунок
  - Кнопки "Нова гра", "Меню"
- **Доступні дії**: 
  - Почати нову гру
  - Повернутися в меню
- **Переходи**: 
  - → Стан початковий (нова гра)
  - → Головне меню

## Діаграма станів

```
Початковий стан
    ↓
Розміщення фігури
    ↓
┌─────────────────────────────────────────────────────────┐
│                    ГРАВЕЦЬ                              │
│  Вибір ходу ←→ Виконання ходу ←→ Перевірка кінця гри   │
└─────────────────────────────────────────────────────────┘
    ↓ (якщо гра з комп'ютером)
┌─────────────────────────────────────────────────────────┐
│                  КОМП'ЮТЕР                              │
│  Хід комп'ютера → Виконання ходу → Перевірка кінця гри │
└─────────────────────────────────────────────────────────┘
    ↓
┌─────────────────────────────────────────────────────────┐
│                    КІНЕЦЬ ГРИ                           │
│  Перемога ←→ Поразка ←→ Нова гра                        │
└─────────────────────────────────────────────────────────┘
```

## Спеціальні стани

### Стан паузи (Pause State)
- **Опис**: Гра призупинена
- **Елементи**: 
  - Всі кнопки керування неактивні
  - Повідомлення "Гра призупинена"
- **Доступні дії**: 
  - Продовжити гру
  - Повернутися в меню
- **Переходи**: 
  - → Попередній стан (продовження)
  - → Головне меню

### Стан налаштувань (Settings State)
- **Опис**: Відкрито налаштування під час гри
- **Елементи**: 
  - Модальне вікно з налаштуваннями
  - Основна гра прихована
- **Доступні дії**: 
  - Змінити налаштування
  - Закрити налаштування
- **Переходи**: 
  - → Попередній стан (закриття)
  - → Головне меню (вихід)

## Переходи між станами

### Умовні переходи
- **Перевірка валідності ходу**: Хід виконується тільки якщо він валідний
- **Перевірка наявності ходів**: Система перевіряє можливість продовження гри
- **Перевірка режиму гри**: Різні переходи для гри з комп'ютером та локальної гри

### Автоматичні переходи
- **Розміщення фігури**: Відбувається автоматично після початку гри
- **Хід комп'ютера**: Виконується автоматично одразу після ходу гравця у режимі "Гра з комп'ютером"
- **Перевірка кінця гри**: Відбувається після кожного ходу

### Ручні переходи
- **Вибір ходу**: Контролюється гравцем
- **Заява "Немає ходів"**: Ініціюється гравцем
- **Навігація**: Контролюється гравцем

## Технічна реалізація

### StateManager
- Зберігає поточний стан гри
- Керує переходами між станами
- Синхронізує стан з UI
> ВАЖЛИВО: Поле `board` має бути присутнє у початковому стані (initialState.game) для коректної роботи підписок та оновлення UI.

### GameLogic
- Містить логіку перевірки станів
- Керує виконанням ходів
- Визначає умови перемоги/поразки

### EventBus
- Передає події зміни стану
- Дозволяє компонентам реагувати на зміни
- Забезпечує слабке зв'язування

## Пов'язані файли

- [GAME_RULES.md](GAME_RULES.md) - Правила гри та механіка
- [UI_COMPONENTS.md](UI_COMPONENTS.md) - Логіка всіх UI елементів
- [NAVIGATION.md](NAVIGATION.md) - Навігація між екранами
- [COMPUTER_AI.md](COMPUTER_AI.md) - Алгоритм комп'ютера 