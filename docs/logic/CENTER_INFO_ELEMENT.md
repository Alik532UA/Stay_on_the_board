# Документація Елемента Center Info

## Огляд

Елемент `center-info` - це центральна кнопка в сітці напрямків гри "Залишитися на дошці", яка служить основним візуальним індикатором поточного стану вибору ходу гравця та відображення ходів комп'ютера.

## Розташування та Структура

### HTML Структура
```html
<button id="center-info" class="control-btn center-info" type="button"></button>
```

### Розташування
- **Позиція**: Центр сітки напрямків (позиція 5 в сітці 3x3)
- **Контекст**: Розташований між кнопками напрямків у візуальній сітці керування

### CSS Класи
- `.control-btn`: Базовий клас для кнопок керування
- `.center-info`: Специфічний клас для центральної кнопки інформації

## Функціональність

### Основні Функції
1. **Відображення Поточного Вибору**: Показує вибраний напрямок та/або відстань
2. **Показ Ходу Комп'ютера**: Відображає останній хід комп'ютера після його виконання
3. **Підтвердження Ходу**: Стає клікабельною кнопкою для підтвердження ходу
4. **Візуальний Фідбек**: Надає інтуїтивний фідбек про стан гри

## Стани Елемента

### 1. Початковий Стан (Пауза між ходами)
- **Відображення**: Порожній контент
- **CSS Клас**: Без спеціальних класів
- **Курсор**: `default`
- **Клікабельний**: Ні
- **Стилі**: Без обводки, прозорий фон
- **Умова**: Не вибрано напрямок і відстань, немає ходу комп'ютера для показу
- **Призначення**: Пауза між ходом комп'ютера та початком вибору гравцем

### 2. Стан Показу Ходу Комп'ютера
- **Відображення**: Останній хід комп'ютера (наприклад, `"→2"`)
- **CSS Клас**: `computer-move-display`
- **Курсор**: `default`
- **Клікабельний**: Ні
- **Стилі**: Помаранчевий фон, без обводки
- **Умова**: Не вибрано напрямок і відстань, але існує `computerLastMoveDisplay`

### 3. Стан Тільки Напрямок
- **Відображення**: Тільки стрілка напрямку (наприклад, `"→"`, `"↑"`, `"↙"`)
- **CSS Клас**: `direction-distance-state`
- **Курсор**: `default`
- **Клікабельний**: Ні
- **Стилі**: Без обводки, стандартний фон
- **Умова**: Вибрано напрямок, не вибрано відстань

### 4. Стан Тільки Відстань
- **Відображення**: Тільки число відстані (наприклад, `"2"`, `"3"`)
- **CSS Клас**: `direction-distance-state`
- **Курсор**: `default`
- **Клікабельний**: Ні
- **Стилі**: Без обводки, стандартний фон
- **Умова**: Вибрано відстань, не вибрано напрямок

### 5. Стан Повного Ходу (Підтверджуваний)
- **Відображення**: Напрямок + Відстань (наприклад, `"→2"`, `"↑3"`, `"↙1"`)
- **CSS Клас**: `confirm-btn-active`
- **Курсор**: `pointer`
- **Клікабельний**: Так (викликає `confirmMove()`)
- **Стилі**: Зелена обводка, анімація пульсації
- **Умова**: Вибрано і напрямок, і відстань

## Мапінг Стрілок Напрямку

| Напрямок | Символ | Опис |
|----------|--------|------|
| 1 | `↙` | Вниз-ліворуч |
| 2 | `↓` | Вниз |
| 3 | `↘` | Вниз-праворуч |
| 4 | `←` | Ліворуч |
| 6 | `→` | Праворуч |
| 7 | `↖` | Вгору-ліворуч |
| 8 | `↑` | Вгору |
| 9 | `↗` | Вгору-праворуч |

## CSS Стилі

### Базові Стилі
```css
#center-info {
    border: none !important; /* Завжди без обводки за замовчуванням */
}

/* Прозорий фон тільки для початкового стану (коли немає класів) */
#center-info:not(.confirm-btn-active):not(.computer-move-display):not(.direction-distance-state) {
    background: transparent !important;
}
```

### Стилі за Станами
```css
/* Підтверджуваний стан */
#center-info.confirm-btn-active {
    background: var(--confirm-btn-bg);
    color: white;
    border-color: var(--confirm-btn-bg);
    animation: pulse 2s infinite;
    cursor: pointer;
}

#center-info.confirm-btn-active:hover {
    background: var(--confirm-btn-hover);
    border-color: var(--confirm-btn-hover);
    transform: scale(1.02);
}

/* Показ ходу комп'ютера */
#center-info.computer-move-display {
    background-color: orange;
    border: none;
}
```

### Анімації
```css
@keyframes pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
    }
    70% {
        box-shadow: 0 0 0 10px rgba(76, 175, 80, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
    }
}
```

## Технічна Реалізація

### Метод `updateCenterInfo()`
```javascript
updateCenterInfo() {
    const centerInfo = this.element.querySelector('#center-info');
    if (!centerInfo) return;
    
    // Видаляємо попередні обробники подій
    centerInfo.removeEventListener('click', this.centerInfoClickHandler);
    
    // Скидаємо всі стилі
    centerInfo.classList.remove('confirm-btn-active', 'computer-move-display', 'direction-distance-state');
    centerInfo.style.cursor = 'default';
    centerInfo.style.border = 'none';
    centerInfo.style.backgroundColor = '';
    
    // Логіка визначення стану та відображення...
    
    // Якщо користувач нічого не вибрав, але є хід комп'ютера
    if (this.selectedDirection === null && this.selectedDistance === null && this.computerLastMoveDisplay) {
        centerInfo.textContent = this.computerLastMoveDisplay;
        centerInfo.classList.add('computer-move-display');
        centerInfo.style.backgroundColor = 'orange';
        centerInfo.style.border = 'none';
        return;
    }
    
    // Логіка для інших станів...
}
```

### Змінні Стану
- `this.selectedDirection`: Поточний вибраний напрямок (1-9 або null)
- `this.selectedDistance`: Поточна вибрана відстань (1 до boardSize-1 або null)
- `this.computerLastMoveDisplay`: Останній хід комп'ютера для відображення
- `this.distanceManuallySelected`: Флаг ручного вибору відстані
- `this.centerInfoClickHandler`: Обробник кліку для підтвердження ходу

### Обробники Подій
- **Клік**: При стані `.confirm-btn-active` викликає `confirmMove()`
- **Автоматичне оновлення**: Реагує на зміни в State Manager

## Інтеграція з Іншими Компонентами

### GameLogic
```javascript
// Показ ходу комп'ютера
gameControlsComponent.showComputerMove(direction, distance);

// Очищення показу комп'ютера
gameControlsComponent.clearComputerMove();
```

### State Manager
- Підписка на `game.selectedDirection`
- Підписка на `game.selectedDistance`
- Автоматичне оновлення при зміні стану

### Event Bus
- Випуск події `game:confirmMove` при кліку на підтверджуваний стан

## Приклади Використання

### Початковий Стан
```html
<button id="center-info" class="control-btn center-info" type="button"></button>
```
- **Контент**: Порожній
- **Стилі**: Без обводки, прозорий фон

### Хід Комп'ютера
```html
<button id="center-info" class="control-btn center-info computer-move-display" 
        style="background-color: orange; border: none;">→2</button>
```
- **Контент**: `"→2"` (напрямок + відстань)
- **Стилі**: Помаранчевий фон, без обводки

### Підтверджуваний Хід
```html
<button id="center-info" class="control-btn center-info confirm-btn-active" 
        style="cursor: pointer;">→2</button>
```
- **Контент**: `"→2"` (напрямок + відстань)
- **Стилі**: Зелена обводка, анімація, курсор pointer

## Обмеження та Особливості

### Обмеження
- Максимальна відстань обмежена розміром дошки (boardSize - 1)
- Показ комп'ютера очищається при виборі гравцем
- Тільки один стан може бути активним одночасно
- Клікабельність доступна тільки в підтверджуваному стані

### Особливості
- Автоматичне оновлення при зміні стану гри
- Збереження ручно вибраної відстані при зміні напрямку
- Інтуїтивний візуальний фідбек для користувача
- Помаранчевий фон для відрізнення ходів комп'ютера
- Анімація пульсації для привернення уваги до підтверджуваного ходу

### Логіка Фонів
- **Прозорий фон**: Тільки в початковому стані (пауза між ходами)
- **Помаранчевий фон**: При показі ходу комп'ютера
- **Зелений фон**: При підтверджуваному стані (готовий хід гравця)
- **Стандартний фон**: При виборі тільки напрямку або тільки відстані

## Клавіатурні Скорочення

### Взаємодія з Center Info
- **NumPad 5**: Підтвердження ходу (альтернатива кліку)
- **Клік на center-info**: Підтвердження ходу (коли доступно)

### Візуальні Індикатори
- **Порожній елемент**: Немає вибору
- **Стрілка**: Вибрано тільки напрямок
- **Число**: Вибрано тільки відстань
- **Стрілка + число**: Повний хід готовий до підтвердження
- **Помаранчевий фон**: Показ ходу комп'ютера

## Тестування

### Сценарії Тестування
1. **Початковий стан**: Перевірка порожнього відображення
2. **Вибір напрямку**: Перевірка відображення стрілки
3. **Вибір відстані**: Перевірка відображення числа
4. **Повний хід**: Перевірка клікабельності та анімації
5. **Хід комп'ютера**: Перевірка помаранчевого фону
6. **Очищення**: Перевірка скидання стану

### Очікувана Поведінка
- Плавні переходи між станами
- Правильне відображення символів напрямку
- Коректна робота клікабельності
- Відповідність візуальних стилів стану 

## Важлива логіка (2025)
- Хід комп'ютера у center-info зберігається до першої дії гравця (вибору напрямку або відстані), а не до підтвердження ходу. Це гарантує, що гравець завжди бачить останній хід комп'ютера, навіть якщо робить хід дуже швидко. 

## Архітектура (2025)
- Всі ходи (гравця і комп'ютера) одразу додаються у moveQueue (чергу ходів).
- Дошка лише анімує цю чергу у своєму темпі, не впливаючи на логіку center-info чи стан гри.
- Center-info завжди показує останній хід з moveQueue, навіть якщо дошка ще анімує попередні ходи.
- Таймери/анімації не блокують логіку гри. 