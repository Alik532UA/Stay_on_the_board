# Показ Доступних Ходів

## Огляд

Функціональність "Показувати доступні ходи" дозволяє гравцю бачити всі можливі ходи на дошці у вигляді білих точок. Це допомагає в стратегічному плануванні та зменшує ймовірність помилок.

## Налаштування

### Чекбокс "Показувати доступні ходи"
- **Розташування**: Налаштування → Ігровий процес
- **Тип**: iOS-style перемикач
- **За замовчуванням**: `true` (увімкнено)
- **Зберігання**: В `settings.showMoves`

## Логіка Роботи

### Стани Відображення

#### 1. Чекбокс вимкнено (`showMoves: false`)
- **Білі точки**: Не показуються
- **Підсвічені ходи**: Не показуються
- **Візуальний стан**: Доска показує тільки фігури та заблоковані клітинки

#### 2. Чекбокс увімкнено (`showMoves: true`)
- **Білі точки**: Показуються для всіх доступних ходів
- **Підсвічені ходи**: Показуються тільки при виборі конкретного напрямку та відстані
- **Візуальний стан**: Доска показує фігури, доступні ходи та підсвічені ходи

### Візуальні Елементи

#### Білі точки (Доступні ходи)
- **Символ**: `●` (біла точка)
- **Розмір**: `calc(var(--cell-size) * 0.33)`
- **Колір**: `var(--text-accent)` (білий)
- **Позиція**: Центр клітинки
- **CSS клас**: `.cell-available`
- **Умова показу**: `isAvailable && showingAvailableMoves`

#### Підсвічені ходи
- **Символ**: `●` (біла точка з додатковим стилем)
- **Розмір**: `calc(var(--cell-size) * 0.33)`
- **Колір**: `var(--text-accent)` (білий)
- **Позиція**: Центр клітинки
- **CSS клас**: `.cell-available .move-dot-highlighted`
- **Умова показу**: `isHighlighted`

### Пріоритет Відображення

1. **Підсвічені ходи** (найвищий пріоритет)
   - Показуються коли вибрано конкретний напрямок і відстань
   - Замінюють звичайні білі точки для цього ходу

2. **Доступні ходи** (нижчий пріоритет)
   - Показуються коли чекбокс увімкнено
   - Не показуються для підсвічених ходів

## Технічна Реалізація

### Стани в StateManager

```javascript
// Налаштування
settings: {
  showMoves: boolean // Чи показувати доступні ходи
}

// Стан гри
game: {
  availableMoves: Array<Move>, // Всі доступні ходи
  highlightedMoves: Array<Move>, // Підсвічені ходи (тільки вибраний)
  showingAvailableMoves: boolean // Синхронізовано з settings.showMoves
}
```

### Ключові Функції

#### `toggleAvailableMoves(show)`
- **Призначення**: Перемикає показ доступних ходів
- **Параметри**: `show` - boolean
- **Дії**:
  1. Встановлює `game.showingAvailableMoves = show`
  2. Викликає `updateAvailableMoves()` для оновлення підсвічування

#### `updateAvailableMoves()`
- **Призначення**: Оновлює список доступних ходів та підсвічування
- **Логіка**:
  1. Обчислює всі доступні ходи для поточної позиції
  2. Зберігає їх в `game.availableMoves`
  3. Оновлює `game.highlightedMoves` на основі вибраного напрямку/відстані

### Компоненти

#### GameBoardComponent
- **Відповідальність**: Відображення білих точок на дошці
- **Логіка рендерингу**:
  ```javascript
  if (isHighlighted) {
    // Показує підсвічений хід
    cell.classList.add('highlighted-move');
    cell.innerHTML = '<span class="move-dot move-dot-highlighted"></span>';
  } else if (isAvailable && showingAvailableMoves) {
    // Показує доступний хід
    cell.classList.add('available-move');
    cell.innerHTML = '<span class="move-dot"></span>';
  }
  ```

#### SettingsComponent
- **Відповідальність**: Керування чекбоксом в налаштуваннях
- **Обробка подій**: Оновлює `settings.showMoves` при зміні

#### GameControlsComponent
- **Відповідальність**: Синхронізація стану чекбокса з налаштуваннями
- **Функція**: `syncCheckboxWithSettings()`

## Поведінка в Різних Режимах Гри

### Гра з Комп'ютером (`vsComputer`)
- **За замовчуванням**: `showMoves = true`
- **Причина**: Допомагає гравцю планувати ходи проти комп'ютера
- **Автоматичне встановлення**: В `onGameStart()` для режиму `vsComputer`

### Локальна Гра (`localTwoPlayer`)
- **За замовчуванням**: Значення з налаштувань
- **Гнучкість**: Гравець може вимкнути для складності

### Онлайн Гра (`online`)
- **За замовчуванням**: Значення з налаштувань
- **Синхронізація**: Налаштування синхронізуються між гравцями

## Взаємодія з Іншими Функціями

### Режим Заблокованих Клітинок
- **Вплив**: Доступні ходи враховують заблоковані клітинки
- **Оновлення**: При зміні режиму автоматично перераховуються доступні ходи

### Зміна Розміру Дошки
- **Вплив**: Доступні ходи перераховуються для нового розміру
- **Збереження**: Налаштування `showMoves` зберігається

### Голосове Керування
- **Команди**:
  - `"показати ходи"` - вмикає показ доступних ходів
  - `"сховати ходи"` - вимикає показ доступних ходів

## CSS Стилі

### Базові Стилі
```css
.cell-available {
    position: relative;
}

.cell-available::after {
    content: '●';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: calc(var(--cell-size) * 0.33);
    color: var(--text-accent);
}
```

### Підсвічені ходи
```css
.move-dot-highlighted {
    display: none !important;
}

.cell-available .move-dot-highlighted {
    display: block !important;
}
```

### Теми
- **Темна тема**: Білі точки залишаються білими
- **Світла тема**: Білі точки залишаються білими
- **Пікова тема**: Білі точки залишаються білими

## Логування

### Ключові Події
- `toggleAvailableMoves called, show = {show}`
- `updateAvailableMoves - showingAvailableMoves: {showingAvailableMoves, movesCount}`
- `renderBoard - moves state: {availableMovesCount, highlightedMovesCount, showingAvailableMoves}`

### Діагностика
- Відстеження кількості доступних та підсвічених ходів
- Моніторинг стану чекбокса
- Перевірка синхронізації між налаштуваннями та станом гри

## Тестування

### Сценарії Тестування
1. **Вимкнений чекбокс**: Перевірити відсутність білих точок
2. **Увімкнений чекбокс**: Перевірити наявність білих точок
3. **Вибір напрямку**: Перевірити підсвічування ходів у напрямку
4. **Вибір відстані**: Перевірити підсвічування ходів з відстанню
5. **Повний вибір**: Перевірити підсвічування конкретного ходу
6. **Зміна розміру дошки**: Перевірити оновлення доступних ходів
7. **Режим заблокованих клітинок**: Перевірити врахування заблокованих клітинок

### Критичні Шляхи
- Синхронізація між `settings.showMoves` та `game.showingAvailableMoves`
- Правильний пріоритет відображення (підсвічені > доступні)
- Оновлення при зміні стану гри
- Збереження налаштувань між сесіями

## Відомі Обмеження

### Продуктивність
- Перерахунок доступних ходів при кожній зміні стану
- Візуальне оновлення всіх клітинок при зміні налаштувань

### UX Обмеження
- Неможливість тимчасово приховати доступні ходи під час гри
- Відсутність різних типів індикаторів для різних типів ходів

## Майбутні Покращення

### Заплановані Функції
- Різні кольори для різних типів ходів
- Тимчасове приховування під час аналізу
- Анімація появи/зникнення точок
- Налаштування прозорості точок

### Оптимізації
- Кешування доступних ходів
- Ліниве обчислення для великих дошок
- Дебаунсинг оновлень UI 