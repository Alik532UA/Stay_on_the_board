# Правила написання e2e автотестів

## 1. Використання ID для елементів
Якщо для автотеста потрібно взаємодіяти з кнопкою чи іншим елементом, для цього елемента необхідно створити унікальний `ID`. Не слід покладатися на текстові значення (`Name`, `Text`), оскільки вони можуть змінюватися.

## 2. Система тегів для автотестів
Кожен автотест **повинен** мати мінімум два теги для чіткої ідентифікації та керування:

1.  **Унікальний ID:** Служить для запуску конкретного тесту. Формат: `@[ПРЕФІКС]-[НОМЕР]`, наприклад `@OTM-1`, `@PAG-2`.
2.  **Статус:** Відображає поточний стан тесту.

### Статуси тестів
*   **`@inProgress`:** Призначається новоствореним тестам. Якщо тест із цим тегом падає, AI повинен запитати користувача: "Чи в браузері очікуваний результат?". Якщо так — виправляти тест, інакше — код.
*   **`@done`:** Призначається стабільним тестам, що коректно перевіряють функціонал. Падіння такого тесту сигналізує про помилку в коді програми.
*   **`@bug`:** Призначається тестам, які виявили помилку в додатку. Це дозволяє відстежувати відомі проблеми.

**Приклад:**
```typescript
// Тест в розробці для модального вікна "Opponent Trapped Modal"
test('Повинно відображатися модальне вікно', { tag: ['@inProgress', '@OTM-1'] }, async ({ page }) => {
  // ...
});

// Стабільний тест для потоку "Play Again"
test('Повинна починатись нова гра', { tag: ['@done', '@PAG-1'] }, async ({ page }) => {
  // ...
});
```

## 3. Використання інструментів "Test Mode"
Автотести можуть використовувати інструменти, доступні при активації режиму "Test Mode: ON". Це дозволяє за потреби контролювати ходи комп'ютера та інші аспекти гри для більш глибокого тестування.

## 4. Тестування локалізованих елементів

**Проблема:** Перевірка елементів за їхнім видимим текстом (наприклад, `toHaveText('Приклад')`) робить тести крихкими. Такі тести ламаються щоразу, коли змінюється текст або мова інтерфейсу.

**Рішення:** Щоб уникнути цієї проблеми, слід перевіряти не сам текст, а ключ локалізації. Для цього до елемента додається спеціальний атрибут `data-i18n-key`, який містить ключ з файлу локалізації.

**Приклад:**

Замість крихкої перевірки:
`await expect(page.getByTestId('title')).toHaveText('Суперник у пастці!');`

Слід використовувати надійну перевірку атрибута:
`await expect(page.getByTestId('title')).toHaveAttribute('data-i18n-key', 'modal.computerNoMovesTitle');`

Такий підхід гарантує, що тест залишиться стабільним незалежно від змін у текстах або переключення мови.