# Фічі

У цій папці зберігаються документи, що описують функціональні можливості, фічі, сценарії використання та інструкції для Stay on the Board.

## Вимоги до структури файлів
- Тип
- Статус
- Назва
- Опис

## Ключові документи
- tutorial.md — туторіал
- version-control.md — контроль версій

## 1. Система перегляду записів (Replay System)

Система реплеїв повністю відокремлена від основної ігрової логіки і знаходиться на окремій сторінці `/replay`.

### Потік даних

1.  **Завершення гри:** Коли гра закінчується, `gameStore` містить повну історію ходів (`moveHistory`) та розмір дошки.
2.  **Натискання "Переглянути запис":** Функція `startReplay` в `gameStore.js` спрацьовує.
3.  **Збереження даних:** `startReplay` серіалізує `moveHistory` та `boardSize` у JSON-рядок і зберігає його в `sessionStorage` під ключем `replayData`.
4.  **Навігація:** Відбувається перенаправлення на сторінку `/replay`.
5.  **Завантаження даних:** Компонент `/replay/+page.svelte` при монтуванні (`onMount`) читає дані з `sessionStorage`, парсить їх і передає у спеціалізований компонент `ReplayViewer.svelte`.
6.  **Відображення:** `ReplayViewer.svelte` має власний локальний стан і відповідає за логіку відображення дошки, шляху та керування кроками реплею.

Цей підхід забезпечує повну ізоляцію логіки реплею від ігрової логіки.

## 2. Вирішення конфліктів гарячих клавіш

Система дозволяє призначати кілька дій на одну клавішу і надає користувачу можливість обрати потрібну дію при першому натисканні.

### Алгоритм роботи

1.  **Натискання клавіші:** Спрацьовує обробник `handleHotkey` у `GameBoard.svelte`.
2.  **Пошук збігів:** Функція шукає **всі** дії, прив'язані до натиснутої клавіші (`event.code`) у сторі `settingsStore.keybindings`.
3.  **Аналіз:**
    *   Якщо знайдено 0 або 1 дію, вона виконується негайно.
    *   Якщо знайдено 2+ дії, це конфлікт.
4.  **Перевірка збереженого рішення:** Система перевіряє `settingsStore.keyConflictResolution`. Якщо для цієї клавіші вже є збережене рішення, виконується відповідна дія.
5.  **Показ модального вікна:** Якщо рішення не знайдено, викликається `modalStore.showModal` з динамічно згенерованим списком кнопок, що відповідають конфліктуючим діям.
6.  **Вибір користувача:** При натисканні на кнопку у модальному вікні:
    *   Виконується відповідна дія (`executeAction`).
    *   Вибір користувача зберігається у `settingsStore` за допомогою методу `resolveKeyConflict`.
    *   Модальне вікно закривається.

При наступних натисканнях цієї ж клавіші система буде використовувати збережене рішення, не показуючи модальне вікно знову. 