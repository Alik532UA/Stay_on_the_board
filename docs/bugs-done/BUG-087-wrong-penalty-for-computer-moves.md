---
status: done
---

# BUG-087: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–µ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ —Ö–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∞ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –∑–∞ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞, —Ö–æ—á–∞ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –ø–æ–≤–∏–Ω–Ω—ñ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ —Ö–æ–¥–∏ –≥—Ä–∞–≤—Ü—è.

### –ê–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∏—Å—è –∑–∞ —Ö–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞
- –õ–æ–≥ –ø–æ–∫–∞–∑—É–≤–∞–≤: `üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 2 —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª–∏ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ penaltyPoints (single player game)`
- –¶–µ –≤—ñ–¥–±—É–≤–∞–ª–æ—Å—è –∫–æ–ª–∏ –∫–æ–º–ø'—é—Ç–µ—Ä —Ä–æ–±–∏–≤ —Ö–æ–¥–∏ –≤ —Ç–æ–º—É –∂ –Ω–∞–ø—Ä—è–º–∫—É –∑ —Ä—ñ–∑–Ω–æ—é –≤—ñ–¥—Å—Ç–∞–Ω–Ω—é

### –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ —Ö–æ–¥–∏ –≥—Ä–∞–≤—Ü—è
- –•–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏—Å—è –Ω–∞ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ—Å—Ç—å"
- –õ–æ–≥ –ø–æ–≤–∏–Ω–µ–Ω –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏: `üîç calculateMoveScore: –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ" —Ö–æ–¥—É –¥–ª—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞`

## –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏

### –ü—Ä–∏—á–∏–Ω–∞
–õ–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤ –≤–∏–∫–ª–∏–∫–∞–ª–∞—Å—è –¥–ª—è –≤—Å—ñ—Ö —Ö–æ–¥—ñ–≤ –±–µ–∑ —Ä–æ–∑—Ä—ñ–∑–Ω–µ–Ω–Ω—è –º—ñ–∂ –≥—Ä–∞–≤—Ü–µ–º —Ç–∞ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º. –ó–≥—ñ–¥–Ω–æ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é, —à—Ç—Ä–∞—Ñ –∑–∞ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∫–æ–ª–∏:

> –ì—Ä–∞–≤–µ—Ü—å —Ä–æ–±–∏—Ç—å —Ö—ñ–¥ —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É –ø—ñ—Å–ª—è —Ö–æ–¥—É –∫–æ–º–ø'—é—Ç–µ—Ä–∞

–ê–ª–µ —Å–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è–ª–∞ –≤—Å—ñ —Ö–æ–¥–∏, –≤–∫–ª—é—á–∞—é—á–∏ —Ö–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞.

### –ü—Ä–∏–∫–ª–∞–¥ –∑ –ª–æ–≥—É
```
[gameOrchestrator] _triggerComputerMove: performMove –¥–ª—è –∫–æ–º–ø º—é—Ç–µ—Ä–∞ up-left 1
[gameOrchestrator] _triggerComputerMove: performMove –¥–ª—è –∫–æ–º–ø º—é—Ç–µ—Ä–∞ up-left 2
üîç calculateMoveScore: –ø–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π" —Ö—ñ–¥: Object
üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 2 —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª–∏ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ penaltyPoints (single player game)
```

## –†—ñ—à–µ–Ω–Ω—è

### 1. –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∏–ø—É –≥—Ä–∞–≤—Ü—è –≤ `calculateMoveScore`

–î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `isHumanMove` –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª—ñ–∑–æ–º "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤:

```typescript
const currentPlayer = currentState.players[playerIndex];
const isHumanMove = currentPlayer?.type === 'human';

console.log(`üîç calculateMoveScore: humanPlayersCount = ${humanPlayersCount}, playerIndex = ${playerIndex}, isHumanMove = ${isHumanMove}`);

// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π" —Ö—ñ–¥ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ö–æ–¥—ñ–≤ –≥—Ä–∞–≤—Ü—è (–Ω–µ –∫–æ–º–ø'—é—Ç–µ—Ä–∞)
if (isHumanMove && currentState.moveHistory.length >= 2) {
  // ... –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ" —Ö–æ–¥—É
} else if (!isHumanMove) {
  console.log(`üîç calculateMoveScore: –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ" —Ö–æ–¥—É –¥–ª—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞`);
}
```

### 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —Ç–∏–ø—É –≥—Ä–∞–≤—Ü—è –≤ `performMove`

–î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ç–∏–ø—É –≥—Ä–∞–≤—Ü—è –≤ –ª–æ–≥—ñ–∫—É –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –≥—Ä–∏:

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ö–æ–¥—ñ–≤ –≥—Ä–∞–≤—Ü—è (–Ω–µ –∫–æ–º–ø'—é—Ç–µ—Ä–∞)
if (currentPlayer.type === 'human' && currentState.moveHistory.length >= 2) {
  // ... –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ" —Ö–æ–¥—É
} else if (currentPlayer.type !== 'human') {
  console.log(`üîç performMove: –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ" —Ö–æ–¥—É –¥–ª—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞`);
}
```

### 3. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å

–¢–∞–∫–æ–∂ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó:

```typescript
// 5. –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ —Ö–æ–¥–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1
if (distance > 1) {
  newBonusPoints += 1; // –ë–æ–Ω—É—Å = +1 –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1 (–Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤—ñ–¥—Å—Ç–∞–Ω—ñ)
  console.log(`üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 1 –±–æ–Ω—É—Å–Ω–∏–π –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å ${distance}`);
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–æ–±–ª—è—î —Ö–æ–¥–∏:

### –î–ª—è —Ö–æ–¥—ñ–≤ –∫–æ–º–ø'—é—Ç–µ—Ä–∞:
- ‚úÖ –ù–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—î "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏
- ‚úÖ –ù–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—î —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏
- ‚úÖ –õ–æ–≥—É—î: `üîç calculateMoveScore: –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–æ–≥–æ" —Ö–æ–¥—É –¥–ª—è –∫–æ–º–ø'—é—Ç–µ—Ä–∞`

### –î–ª—è —Ö–æ–¥—ñ–≤ –≥—Ä–∞–≤—Ü—è:
- ‚úÖ –ü–µ—Ä–µ–≤—ñ—Ä—è—î "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏
- ‚úÖ –ù–∞—Ä–∞—Ö–æ–≤—É—î —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –∑–∞ —Ö–æ–¥–∏ —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É –ø—ñ—Å–ª—è —Ö–æ–¥—É –∫–æ–º–ø'—é—Ç–µ—Ä–∞
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Ä–∞—Ö–æ–≤—É—î –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å (+1 –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å > 1)

## –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- `src/lib/services/gameLogicService.ts` - –¥–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —Ç–∏–ø—É –≥—Ä–∞–≤—Ü—è –≤ `calculateMoveScore` —Ç–∞ `performMove`

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ:
- ‚úÖ –•–æ–¥–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞ –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏
- ‚úÖ –•–æ–¥–∏ –≥—Ä–∞–≤—Ü—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –Ω–∞ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ—Å—Ç—å"
- ‚úÖ –ë–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ (+1 –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å > 1)
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É—î –ø—Ä–∞–≤–∏–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é

## –°—Ç–∞—Ç—É—Å

‚úÖ **–í–ò–ü–†–ê–í–õ–ï–ù–û** - 2025-01-30 