---
status: done
---

# BUG-084: –î–µ—Ç–∞–ª—å–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

–ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ `bonus-display` –ø–æ–∫–∞–∑—É–≤–∞–ª–∞—Å—è –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏, –∞ –Ω–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Ç–µ, —Å–∫—ñ–ª—å–∫–∏ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –æ—Ç—Ä–∏–º–∞–≤ —Ü–µ–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –≥—Ä–∞–≤–µ—Ü—å —ñ –∑–∞ —è–∫—ñ –¥—ñ—ó.

### –ê–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ `bonus-display` –ø–æ–∫–∞–∑—É–≤–∞–ª–∞—Å—è –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏
- –ù–µ –±—É–ª–æ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –ø–æ–±–∞—á–∏—Ç–∏ –¥–µ—Ç–∞–ª—å–Ω—É —ñ—Å—Ç–æ—Ä—ñ—é –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è

### –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ `bonus-display` –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- –í–∫–ª—é—á–∞—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –∫–æ–∂–µ–Ω –≤–∏–ø–∞–¥–æ–∫ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑ –ø—Ä–∏—á–∏–Ω–æ—é —Ç–∞ —á–∞—Å–æ–º
- –ü–æ–∫–∞–∑—É—î –∑–∞–≥–∞–ª—å–Ω—É —Å—É–º—É –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –≥—Ä–∞–≤—Ü—è

## –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏

### –ü—Ä–∏—á–∏–Ω–∞
–í `localGameStore` –∑–±–µ—Ä—ñ–≥–∞–ª–∞—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è, –∞–ª–µ –Ω–µ –±—É–ª–æ —ñ—Å—Ç–æ—Ä—ñ—ó —Ç–æ–≥–æ, –∑–∞ —è–∫—ñ —Å–∞–º–µ –¥—ñ—ó —Ü—ñ –±–∞–ª–∏ –±—É–ª–∏ –Ω–∞—Ä–∞—Ö–æ–≤–∞–Ω—ñ.

### –ù–µ–æ–±—Ö—ñ–¥–Ω—ñ –∑–º—ñ–Ω–∏
1. –î–æ–¥–∞—Ç–∏ –ø–æ–ª–µ `bonusHistory` –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≥—Ä–∞–≤—Ü—è
2. –û–Ω–æ–≤–∏—Ç–∏ –º–µ—Ç–æ–¥ `addPlayerBonusPoints` –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –ø–æ–∫–∞–∑—É –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è

## –†—ñ—à–µ–Ω–Ω—è

### 1. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≥—Ä–∞–≤—Ü—è –≤ `localGameStore.js`

–î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `bonusHistory` –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≥—Ä–∞–≤—Ü—è:

```javascript
// –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω
const createInitialState = () => {
  return {
    players: [
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 1', color: player1Color, score: 0, penaltyPoints: 0, bonusPoints: 0, bonusHistory: [] },
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 2', color: player2Color, score: 0, penaltyPoints: 0, bonusPoints: 0, bonusHistory: [] },
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 3', color: player3Color, score: 0, penaltyPoints: 0, bonusPoints: 0, bonusHistory: [] },
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 4', color: player4Color, score: 0, penaltyPoints: 0, bonusPoints: 0, bonusHistory: [] }
    ],
    // ...
  };
};
```

### 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ—Ç–æ–¥—É `addPlayerBonusPoints`

–î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `reason` —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ—Å—Ç–æ—Ä—ñ—ó:

```javascript
addPlayerBonusPoints: (playerId, bonusPointsToAdd, reason = '') => {
  console.log(`üéØ localGameStore.addPlayerBonusPoints: –¥–æ–¥–∞—î–º–æ ${bonusPointsToAdd} –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –≥—Ä–∞–≤—Ü—é –∑ ID ${playerId} –∑–∞: ${reason}`);
  update(state => {
    const updatedState = {
      ...state,
      players: state.players.map(p => 
        p.id === playerId ? { 
          ...p, 
          bonusPoints: p.bonusPoints + bonusPointsToAdd,
          bonusHistory: [...p.bonusHistory, {
            points: bonusPointsToAdd,
            reason: reason,
            timestamp: Date.now()
          }]
        } : p
      )
    };
    // ...
    return updatedState;
  });
}
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–∫–ª–∏–∫—ñ–≤ –≤ `gameLogicService.ts`

–î–æ–¥–∞–Ω–æ —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –æ–ø–∏—Å—É –ø—Ä–∏—á–∏–Ω–∏ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤:

```typescript
// –§–æ—Ä–º—É—î–º–æ –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤
let bonusReason = '';
if (distance > 1 && scoreChanges.jumpedBlockedCells > 0) {
  bonusReason = `—Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å ${distance} (1 –±–∞–ª) + –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è ${scoreChanges.jumpedBlockedCells} –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ (${scoreChanges.jumpedBlockedCells} –±–∞–ª—ñ–≤)`;
} else if (distance > 1) {
  bonusReason = `—Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å ${distance} (1 –±–∞–ª)`;
} else if (scoreChanges.jumpedBlockedCells > 0) {
  bonusReason = `–ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è ${scoreChanges.jumpedBlockedCells} –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ (${scoreChanges.jumpedBlockedCells} –±–∞–ª—ñ–≤)`;
}

localGameStore.addPlayerBonusPoints(localPlayer.id, scoreChanges.bonusPoints, bonusReason);
```

### 4. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `showPlayerBonusInfo` –≤ `ScorePanelWidget.svelte`

–î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –ø–æ–∫–∞–∑—É –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è:

```javascript
function showPlayerBonusInfo(player) {
  if (player.bonusHistory && player.bonusHistory.length > 0) {
    // –§–æ—Ä–º—É—î–º–æ –¥–µ—Ç–∞–ª—å–Ω–∏–π –æ–ø–∏—Å –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –≥—Ä–∞–≤—Ü—è
    let bonusDetails = `–ë–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –≥—Ä–∞–≤—Ü—è ${player.name}:\n\n`;
    
    player.bonusHistory.forEach((bonus, index) => {
      const time = new Date(bonus.timestamp).toLocaleTimeString();
      bonusDetails += `${index + 1}. +${bonus.points} –±–∞–ª—ñ–≤ - ${bonus.reason} (${time})\n`;
    });
    
    bonusDetails += `\n–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤: ${player.bonusPoints}`;
    
    modalStore.showModal({
      titleKey: 'gameBoard.bonusInfoTitle',
      content: bonusDetails,
      buttons: [{ textKey: 'modal.ok', primary: true, isHot: true }]
    });
  } else {
    // –Ø–∫—â–æ –Ω–µ–º–∞—î –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤, –ø–æ–∫–∞–∑—É—î–º–æ –∑–∞–≥–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é
    modalStore.showModal({
      titleKey: 'gameBoard.bonusInfoTitle',
      contentKey: 'gameBoard.bonusHint',
      buttons: [{ textKey: 'modal.ok', primary: true, isHot: true }]
    });
  }
}
```

### 5. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–ª—ñ–∫—É –Ω–∞ `bonus-display`

–ó–º—ñ–Ω–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫ –∫–ª—ñ–∫—É –¥–ª—è –ø–æ–∫–∞–∑—É –¥–µ—Ç–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è:

```svelte
<span 
  class="bonus-display" 
  on:click={() => showPlayerBonusInfo(player)}
  on:keydown={e => (e.key === 'Enter' || e.key === ' ') && showPlayerBonusInfo(player)}
  title="–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –¥–µ—Ç–∞–ª–µ–π –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤"
  role="button"
  tabindex="0"
>+{player.bonusPoints}</span>
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä –ø—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ `bonus-display` –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å:

### –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –≤–∫–ª—é—á–∞—î:
1. **–ó–∞–≥–æ–ª–æ–≤–æ–∫**: "–ë–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –≥—Ä–∞–≤—Ü—è [–Ü–º'—è]"
2. **–°–ø–∏—Å–æ–∫ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤**: –∫–æ–∂–µ–Ω –≤–∏–ø–∞–¥–æ–∫ –∑ –ø—Ä–∏—á–∏–Ω–æ—é —Ç–∞ —á–∞—Å–æ–º
3. **–ó–∞–≥–∞–ª—å–Ω—É —Å—É–º—É**: –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –≥—Ä–∞–≤—Ü—è

### –ü—Ä–∏–∫–ª–∞–¥ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è:
```
–ë–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –≥—Ä–∞–≤—Ü—è –ì—Ä–∞–≤–µ—Ü—å 1:

1. +1 –±–∞–ª—ñ–≤ - —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å 2 (1 –±–∞–ª) (14:25:30)
2. +2 –±–∞–ª—ñ–≤ - —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å 3 (1 –±–∞–ª) + –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è 1 –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ (1 –±–∞–ª—ñ–≤) (14:26:15)
3. +1 –±–∞–ª—ñ–≤ - –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è 1 –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ (1 –±–∞–ª—ñ–≤) (14:27:45)

–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤: 4
```

## –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- `src/lib/stores/localGameStore.js` - –¥–æ–¥–∞–Ω–æ –ø–æ–ª–µ `bonusHistory` —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ –º–µ—Ç–æ–¥ `addPlayerBonusPoints`
- `src/lib/services/gameLogicService.ts` - –æ–Ω–æ–≤–ª–µ–Ω–æ –≤–∏–∫–ª–∏–∫–∏ `addPlayerBonusPoints` –∑ –¥–µ—Ç–∞–ª—å–Ω–∏–º –æ–ø–∏—Å–æ–º –ø—Ä–∏—á–∏–Ω
- `src/lib/components/widgets/ScorePanelWidget.svelte` - –¥–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `showPlayerBonusInfo` —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –∫–ª—ñ–∫—ñ–≤

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ:
- ‚úÖ –ü—Ä–∏ –Ω–∞—Ç–∏—Å–∫–∞–Ω–Ω—ñ –Ω–∞ `bonus-display` –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –¥–µ—Ç–∞–ª—å–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≥—Ä–∞–≤—Ü—è
- ‚úÖ –Ü—Å—Ç–æ—Ä—ñ—è –≤–∫–ª—é—á–∞—î –ø—Ä–∏—á–∏–Ω—É –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –±–æ–Ω—É—Å–Ω–æ–≥–æ –±–∞–ª—É
- ‚úÖ –ü–æ–∫–∞–∑—É—î—Ç—å—Å—è —á–∞—Å –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –∫–æ–∂–Ω–æ–≥–æ –±–æ–Ω—É—Å–Ω–æ–≥–æ –±–∞–ª—É
- ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∑–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –≥—Ä–∞–≤—Ü—è
- ‚úÖ –Ø–∫—â–æ –Ω–µ–º–∞—î –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤, –ø–æ–∫–∞–∑—É—î—Ç—å—Å—è –∑–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

## –°—Ç–∞—Ç—É—Å

‚úÖ **–í–ò–ü–†–ê–í–õ–ï–ù–û** - 2025-01-30 