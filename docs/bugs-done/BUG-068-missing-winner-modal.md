---
status: done
---

# BUG-068: Відсутність модального вікна переможця при завершенні гри

## Опис проблеми

Коли один з гравців "програє" (виходить за межі дошки або намагається перейти на заблоковану клітинку), гра показує "Гра завершена" в `game-info-content`, але не відображає модальне вікно, яке оголошує переможця.

## Актуальний результат

- `game-info-content` показує "Гра завершена"
- Модальне вікно з переможцем не з'являється
- Гравець не бачить детальну інформацію про результат гри

## Очікуваний результат

- `game-info-content` показує "Гра завершена"
- Модальне вікно з переможцем з'являється автоматично
- Модальне вікно містить:
  - Заголовок "Game Over!"
  - Причину завершення гри
  - Деталі рахунку
  - Кнопки "Грати знову" та "Дивитися повтор"

## Технічні деталі

### Причина проблеми

Функція `endGame` в `gameOrchestrator.ts` встановлювала `isGameOver: true` та інші дані стану, але не викликала `modalStore.showModal()` для показу модального вікна.

### Рішення

Додано виклик `modalStore.showModal()` в кінець функції `endGame` з наступними параметрами:

```typescript
modalStore.showModal({
  titleKey: 'modal.gameOverTitle',
  content: { 
    reason: get(_)(reasonKey, reasonValues ? { values: reasonValues } : undefined), 
    scoreDetails: finalScoreDetails 
  },
  buttons: [
    { 
      textKey: 'modal.playAgain', 
      primary: true, 
      onClick: () => {
        gameLogicService.resetGame();
        modalStore.closeModal();
      }, 
      isHot: true 
    },
    { 
      textKey: 'modal.watchReplay', 
      customClass: 'blue-btn', 
      onClick: () => gameOrchestrator.startReplay() 
    }
  ]
});
```

### Змінені файли

- `src/lib/gameOrchestrator.ts` - додано виклик `modalStore.showModal()` в функцію `endGame`

## Тестування

### Сценарії для перевірки

1. **Вихід за межі дошки:**
   - Зробіть хід, який виводить ферзя за межі дошки
   - Перевірте, що з'являється модальне вікно з переможцем

2. **Хід на заблоковану клітинку:**
   - Увімкніть block mode
   - Зробіть хід на заблоковану клітинку
   - Перевірте, що з'являється модальне вікно з переможцем

3. **Кнопка "Завершити гру":**
   - Натисніть кнопку "Завершити гру" в панелі рахунку
   - Перевірте, що з'являється модальне вікно з переможцем

### Очікувана поведінка

- Модальне вікно з'являється автоматично після завершення гри
- Відображається правильна причина завершення гри
- Показуються деталі рахунку
- Кнопки "Грати знову" та "Дивитися повтор" працюють коректно

## Статус

✅ **ВИРІШЕНО**

## Дата вирішення

2025-01-27 