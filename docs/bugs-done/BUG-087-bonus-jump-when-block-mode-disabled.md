---
status: done
---

# BUG-087: –ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ "–†–µ–∂–∏–º –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫" –≤–∏–º–∫–Ω–µ–Ω–∏–π

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

–ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∏—Å—è –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `blockModeEnabled` –±—É–ª–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –≤ `false`. –¶–µ –ø—Ä–∏–∑–≤–æ–¥–∏–ª–æ –¥–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–∞–ª—ñ–≤ —É –≥—Ä—ñ.

## –°–∏–º–ø—Ç–æ–º–∏

- –ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∏—Å—è –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Å—Ç–∞–Ω—É `blockModeEnabled`
- –£ –ª–æ–∑—ñ –≥—Ä–∏ –∑'—è–≤–ª—è–ª–∏—Å—è –∑–∞–ø–∏—Å–∏ —Ç–∏–ø—É: `–¥–æ–¥–∞—î–º–æ 1 –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è 1 –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫` –Ω–∞–≤—ñ—Ç—å –∫–æ–ª–∏ —Ä–µ–∂–∏–º –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –±—É–≤ –≤–∏–º–∫–Ω–µ–Ω–∏–π
- –§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫ –º—ñ–≥ –º—ñ—Å—Ç–∏—Ç–∏ –±–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è, —è–∫—ñ –Ω–µ –ø–æ–≤–∏–Ω–Ω—ñ –±—É–ª–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏—Å—è

## –ü—Ä–∏—á–∏–Ω–∞

–§—É–Ω–∫—Ü—ñ—è `countJumpedCells` –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è–ª–∞ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è `blockModeEnabled` —ñ –∑–∞–≤–∂–¥–∏ —Ä–∞—Ö—É–≤–∞–ª–∞ –∫–ª—ñ—Ç–∏–Ω–∫–∏, —è–∫—ñ –≤—ñ–¥–≤—ñ–¥–∞–Ω—ñ –±—ñ–ª—å—à–µ —Ä–∞–∑—ñ–≤, –Ω—ñ–∂ `blockOnVisitCount`, —è–∫ "–∑–∞–±–ª–æ–∫–æ–≤–∞–Ω—ñ".

–ö–æ–¥ –≤ `calculateMoveScore` —Ç–∞–∫–æ–∂ –Ω–µ –ø–µ—Ä–µ–≤—ñ—Ä—è–≤ `blockModeEnabled` –ø–µ—Ä–µ–¥ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è–º –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è:

```typescript
// 6. –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫
if (jumpedCount > 0) { // ‚Üê –ù–ï –ø–µ—Ä–µ–≤—ñ—Ä—è–≤—Å—è blockModeEnabled!
  newBonusPoints += jumpedCount;
}
```

## –†—ñ—à–µ–Ω–Ω—è

### 1. –û–Ω–æ–≤–ª–µ–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `countJumpedCells`

–î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `blockModeEnabled` —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É:

```typescript
export function countJumpedCells(
  startRow: number,
  startCol: number,
  endRow: number,
  endCol: number,
  cellVisitCounts: Record<string, number>,
  blockOnVisitCount: number,
  blockModeEnabled: boolean = false
): number {
  // –Ø–∫—â–æ —Ä–µ–∂–∏–º –±–ª–æ–∫—É–≤–∞–Ω–Ω—è –≤–∏–º–∫–Ω–µ–Ω–∏–π, –Ω–µ —Ä–∞—Ö—É—î–º–æ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±–Ω—É—Ç—ñ –∫–ª—ñ—Ç–∏–Ω–∫–∏
  if (!blockModeEnabled) {
    return 0;
  }
  
  // ... —ñ—Å–Ω—É—é—á–∞ –ª–æ–≥—ñ–∫–∞ ...
}
```

### 2. –û–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å—ñ–≤

–î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `blockModeEnabled` –≤ `calculateMoveScore`:

```typescript
// 6. –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫
// –ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ blockModeEnabled = true
if (jumpedCount > 0 && settings.blockModeEnabled) {
  newBonusPoints += jumpedCount;
  console.log(`üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ ${jumpedCount} –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è ${jumpedCount} –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫`);
} else if (jumpedCount > 0 && !settings.blockModeEnabled) {
  console.log(`üéØ calculateMoveScore: –ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –±–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è (blockModeEnabled = false)`);
}
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–æ –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó

–ü–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `blockModeEnabled`:

```typescript
const jumpedCount = countJumpedCells(
  currentState.playerRow,
  currentState.playerCol,
  newPosition.row,
  newPosition.col,
  currentState.cellVisitCounts,
  settings.blockOnVisitCount,
  settings.blockModeEnabled // ‚Üê –î–æ–¥–∞–Ω–æ —Ü–µ–π –ø–∞—Ä–∞–º–µ—Ç—Ä
);
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: blockModeEnabled = false
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è
- **–õ–æ–≥**: `–ø—Ä–æ–ø—É—Å–∫–∞—î–º–æ –±–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è (blockModeEnabled = false)`
- **–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫**: –ù–µ –º—ñ—Å—Ç–∏—Ç—å –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: blockModeEnabled = true
- **–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ
- **–õ–æ–≥**: `–¥–æ–¥–∞—î–º–æ X –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è X –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–∏—Ö –∫–ª—ñ—Ç–∏–Ω–æ–∫`
- **–§—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫**: –ú—ñ—Å—Ç–∏—Ç—å –±–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è

–û–Ω–æ–≤–ª–µ–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é –≤ `docs/logic/BONUS_SCORING.md`:

- –î–æ–¥–∞–Ω–æ —É–º–æ–≤—É –ø—Ä–æ `blockModeEnabled` –¥–ª—è –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è
- –û–Ω–æ–≤–ª–µ–Ω–æ –ø—Ä–∏–∫–ª–∞–¥–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- –î–æ–¥–∞–Ω–æ –ø—Ä–∏–∫–ª–∞–¥–∏ –¥–ª—è –≤–∏–ø–∞–¥–∫—ñ–≤ –∑ —É–≤—ñ–º–∫–Ω–µ–Ω–∏–º —Ç–∞ –≤–∏–º–∫–Ω–µ–Ω–∏–º —Ä–µ–∂–∏–º–æ–º –±–ª–æ–∫—É–≤–∞–Ω–Ω—è

## –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- `src/lib/services/gameLogicService.ts` - –æ—Å–Ω–æ–≤–Ω–∞ –ª–æ–≥—ñ–∫–∞ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- `docs/logic/BONUS_SCORING.md` - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó

## –°—Ç–∞—Ç—É—Å

‚úÖ **–í–ò–†–Ü–®–ï–ù–û**: –ë–æ–Ω—É—Å–∏ –∑–∞ –ø–µ—Ä–µ—Å—Ç—Ä–∏–±—É–≤–∞–Ω–Ω—è —Ç–µ–ø–µ—Ä –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∫–æ–ª–∏ `blockModeEnabled = true` 