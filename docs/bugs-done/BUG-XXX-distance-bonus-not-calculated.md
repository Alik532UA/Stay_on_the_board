---
status: done
---

# BUG-XXX: –ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –≤ –≥—Ä—ñ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º

**–¢–∏–ø:** –ë–∞–≥
**–°—Ç–∞—Ç—É—Å:** –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ
**–ù–∞–∑–≤–∞:** –ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –≤ –≥—Ä—ñ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º

---

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

–£ –≥—Ä—ñ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –∑–∞ —Ö–æ–¥–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1 –Ω–µ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∏—Å—è –≤ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä–∞—Ö—É–Ω–∫—É. –•–æ—á–∞ –ª–æ–≥—ñ–∫–∞ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—É–ª–∞ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –≤ `calculateMoveScore`, —Ü—ñ –±–∞–ª–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—è –≤ `GameState` —ñ –Ω–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∏—Å—è –≤ `calculateFinalScore`.

---

## –ö—Ä–æ–∫–∏ –¥–ª—è –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–Ω—è

1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –≥—Ä—É –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º
2. –ó—Ä–æ–±–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ö–æ–¥—ñ–≤ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1 (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, —Ö–æ–¥–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å 2, 3, 4)
3. –ó–∞–≤–µ—Ä—à–∏—Ç–∏ –≥—Ä—É –∫–Ω–æ–ø–∫–æ—é "–ó–∞–≤–µ—Ä—à–∏—Ç–∏"
4. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫

---

## –ê–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å **–Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–≤—Å—è** –≤ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä–∞—Ö—É–Ω–∫—É, —Ö–æ—á–∞ –ª–æ–≥ –ø–æ–∫–∞–∑—É–≤–∞–≤ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤:
```
üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 1 –±–æ–Ω—É—Å–Ω–∏–π –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å 2
üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 1 –±–æ–Ω—É—Å–Ω–∏–π –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å 3
```

---

## –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –ø–æ–≤–∏–Ω–µ–Ω –≤—ñ–¥–æ–±—Ä–∞–∂–∞—Ç–∏—Å—è –≤ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä–∞—Ö—É–Ω–∫—É —è–∫ –æ–∫—Ä–µ–º–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç "–ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å: +X".

---

## –ü—Ä–∏—á–∏–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∏

1. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–æ–ª—è `distanceBonus` –≤ `GameState`**: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å `GameState` –Ω–µ –º—ñ—Å—Ç–∏–≤ –ø–æ–ª–µ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å
2. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –ø–æ–ª—è `distanceBonus` –≤ `FinalScore`**: –Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å `FinalScore` –Ω–µ –º—ñ—Å—Ç–∏–≤ –ø–æ–ª–µ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –≤ `calculateFinalScore`**: –§—É–Ω–∫—Ü—ñ—è –Ω–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∞ –±–æ–Ω—É—Å–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –ø—Ä–∏ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Ñ—ñ–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É
4. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ `performMove`**: –î–ª—è –≥—Ä–∏ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º –±–æ–Ω—É—Å–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –Ω–µ –∑–±–µ—Ä—ñ–≥–∞–ª–∏—Å—è –≤ `GameState`

---

## –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–æ–ª—è `distanceBonus` –¥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤

**–§–∞–π–ª:** `src/lib/services/gameLogicService.ts`
```typescript
export interface GameState {
  // ... existing fields ...
  distanceBonus: number; // –ë–æ–Ω—É—Å –∑–∞ —Ö–æ–¥–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1
}

export interface FinalScore {
  // ... existing fields ...
  distanceBonus: number; // –ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å
  totalScore: number;
}
```

**–§–∞–π–ª:** `src/lib/stores/gameState.ts`
```typescript
export interface GameState {
  // ... existing fields ...
  /** –ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å (—Ö–æ–¥–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1). */
  distanceBonus?: number;
}
```

### 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `calculateFinalScore`

**–§–∞–π–ª:** `src/lib/services/gameLogicService.ts`
```typescript
export function calculateFinalScore(state: GameState): FinalScore {
  const { score, penaltyPoints, boardSize, movesInBlockMode, jumpedBlockedCells, finishedByFinishButton, noMovesBonus, distanceBonus } = state;
  
  // ... existing calculations ...
  
  const totalScore = baseScore + sizeBonus + blockModeBonus + jumpBonus + (distanceBonus || 0) - totalPenalty + (noMovesBonus || 0) + finishBonus;
  
  return {
    // ... existing fields ...
    distanceBonus: distanceBonus || 0,
    totalScore
  };
}
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `calculateMoveScore`

**–§–∞–π–ª:** `src/lib/services/gameLogicService.ts`
```typescript
function calculateMoveScore(
  // ... existing parameters ...
): { score: number; penaltyPoints: number; movesInBlockMode: number; jumpedBlockedCells: number; bonusPoints: number; distanceBonus: number } {
  
  let newDistanceBonus = currentState.distanceBonus || 0; // –î–æ–¥–∞—î–º–æ –∑–º—ñ–Ω–Ω—É –¥–ª—è –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å
  
  // 5. –ü—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ —Ö–æ–¥–∏ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1
  if (distance > 1) {
    newDistanceBonus += 1; // –ë–æ–Ω—É—Å = +1 –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1 (–Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ –≤—ñ–¥—Å—Ç–∞–Ω—ñ)
    newBonusPoints += 1; // –¢–∞–∫–æ–∂ –¥–æ–¥–∞—î–º–æ –¥–æ –∑–∞–≥–∞–ª—å–Ω–∏—Ö –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –≥—Ä–∏
    console.log(`üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 1 –±–æ–Ω—É—Å–Ω–∏–π –±–∞–ª –∑–∞ —Ö—ñ–¥ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å ${distance}`);
  }
  
  return {
    // ... existing fields ...
    distanceBonus: newDistanceBonus
  };
}
```

### 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `createInitialState`

**–§–∞–π–ª:** `src/lib/stores/gameState.ts`
```typescript
export function createInitialState(config: GameStateConfig = {}): GameState {
  // ... existing code ...
  
  return {
    // ... existing fields ...
    distanceBonus: 0,
    // ... existing fields ...
  };
}
```

### 5. –î–æ–¥–∞–≤–∞–Ω–Ω—è –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ `performMove`

**–§–∞–π–ª:** `src/lib/services/gameLogicService.ts`
```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π" —Ö—ñ–¥ –¥–ª—è single player –≥—Ä–∏ (–≥—Ä–∞ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º)
if (humanPlayersCount <= 1 && playerIndex === 0) { // –ì—Ä–∞–≤–µ—Ü—å (–Ω–µ –∫–æ–º–ø'—é—Ç–µ—Ä)
  // –î–æ–¥–∞—î–º–æ –±–æ–Ω—É—Å–Ω—ñ –±–∞–ª–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –¥–æ GameState –¥–ª—è –≥—Ä–∏ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º
  if (scoreChanges.distanceBonus > 0) {
    console.log(`üéØ performMove (single player): –¥–æ–¥–∞—î–º–æ ${scoreChanges.distanceBonus} –±–æ–Ω—É—Å–Ω–∏—Ö –±–∞–ª—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –¥–æ GameState`);
  }
  
  // ... existing code ...
}
```

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

‚úÖ **–ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å —Ç–µ–ø–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è** –≤ –≥—Ä—ñ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º
‚úÖ **–ë–æ–Ω—É—Å –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è** –≤ —Ñ—ñ–Ω–∞–ª—å–Ω–æ–º—É —Ä–∞—Ö—É–Ω–∫—É
‚úÖ **–ó–±–µ—Ä–µ–∂–µ–Ω–∞ —Å—É–º—ñ—Å–Ω—ñ—Å—Ç—å** –∑ –ª–æ–∫–∞–ª—å–Ω–æ—é –≥—Ä–æ—é (–±–æ–Ω—É—Å–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —ñ —Ç–∞–º)
‚úÖ **–î–æ–¥–∞–Ω–æ –ª–æ–≥—É–≤–∞–Ω–Ω—è** –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å—ñ–≤

---

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. **–ì—Ä–∞ –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º**: –ó—Ä–æ–±–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ö–æ–¥—ñ–≤ –Ω–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –±—ñ–ª—å—à–µ 1, –∑–∞–≤–µ—Ä—à–∏—Ç–∏ –≥—Ä—É, –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ñ—ñ–Ω–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫
2. **–õ–æ–∫–∞–ª—å–Ω–∞ –≥—Ä–∞**: –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ –±–æ–Ω—É—Å–∏ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —è–∫ —ñ —Ä–∞–Ω—ñ—à–µ
3. **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ –≤ –ª–æ–≥–∞—Ö –∑'—è–≤–ª—è—é—Ç—å—Å—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è –±–æ–Ω—É—Å—ñ–≤ –∑–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å

---

## –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- `src/lib/services/gameLogicService.ts` - –¥–æ–¥–∞–Ω–æ –ø–æ–ª–µ `distanceBonus` –¥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ–≤ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤
- `src/lib/stores/gameState.ts` - –¥–æ–¥–∞–Ω–æ –ø–æ–ª–µ `distanceBonus` –¥–æ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É —Ç–∞ —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó 