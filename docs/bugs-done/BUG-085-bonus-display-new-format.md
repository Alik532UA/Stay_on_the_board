---
status: done
---

# BUG-085: Новий формат відображення інформації про бали гравця

## Опис проблеми

При натисканні на `bonus-display` показувалася детальна історія бонусних балів з часом, але не було зручного огляду всіх типів балів гравця в структурованому вигляді.

### Актуальний результат
- Показувалася детальна історія бонусних балів з часом
- Не було чіткого розділення на типи балів
- Відсутня загальна сума всіх балів гравця

### Очікуваний результат
- Структурований огляд всіх типів балів гравця
- Чітке розділення на основні бали, бонусні бали та штрафні бали
- Показ загальної суми всіх балів гравця

## Аналіз проблеми

### Причина
Функція `showPlayerBonusInfo` показувала детальну історію бонусних балів з часом, але не надавала зручного огляду всіх типів балів гравця в структурованому вигляді.

### Необхідні зміни
1. Змінити формат відображення на структурований огляд всіх балів
2. Розділити бонусні бали на категорії (за відстань та перестрибування)
3. Показувати загальну суму всіх балів гравця
4. Оновити заголовок модального вікна

## Рішення

### 1. Оновлення функції `showPlayerBonusInfo` в `ScorePanelWidget.svelte`

Змінено формат відображення на структурований огляд:

```javascript
function showPlayerBonusInfo(player) {
  // Формуємо детальний опис всіх балів гравця
  let scoreDetails = `Бали гравця ${player.name}\n\n`;
  
  // Основні бали
  scoreDetails += `Основні бали: +${player.score}\n`;
  
  // Бонусні бали
  if (player.bonusPoints > 0) {
    // Розбиваємо бонусні бали на категорії
    let distanceBonus = 0;
    let jumpBonus = 0;
    
    player.bonusHistory.forEach(bonus => {
      if (bonus.reason.includes('хід на відстань')) {
        distanceBonus += bonus.points;
      } else if (bonus.reason.includes('перестрибування')) {
        jumpBonus += bonus.points;
      }
    });
    
    if (distanceBonus > 0) {
      scoreDetails += `Бонус за відстань: +${distanceBonus}\n`;
    }
    if (jumpBonus > 0) {
      scoreDetails += `Бонус за перестрибування: +${jumpBonus}\n`;
    }
  } else {
    scoreDetails += `Бонус за відстань: +0\n`;
    scoreDetails += `Бонус за перестрибування: +0\n`;
  }
  
  // Штрафні бали
  scoreDetails += `Штраф за зворотній хід: -${player.penaltyPoints}\n`;
  
  // Загальна сума
  const totalScore = player.score + player.bonusPoints - player.penaltyPoints;
  scoreDetails += `\nЗагальна сума балів: ${totalScore}`;
  
  modalStore.showModal({
    titleKey: 'gameBoard.bonusInfoTitle',
    content: scoreDetails,
    buttons: [{ textKey: 'modal.ok', primary: true, isHot: true }]
  });
}
```

### 2. Оновлення заголовків модальних вікон

Змінено заголовки на більш описові:

#### Українська мова:
```javascript
bonusInfoTitle: "Детальна інформація про бали"
```

#### Англійська мова:
```javascript
bonusInfoTitle: "Detailed Score Information"
```

#### Голландська мова:
```javascript
bonusInfoTitle: "Gedetailleerde Score Informatie"
```

#### Кримськотатарська мова:
```javascript
bonusInfoTitle: "Detallı bal ma'lümatı"
```

## Результат

Тепер при натисканні на `bonus-display` користувач бачить:

### Новий формат включає:
1. **Заголовок**: "Детальна інформація про бали"
2. **Основні бали**: кількість балів за ходи
3. **Бонус за відстань**: бали за ходи на відстань більше 1
4. **Бонус за перестрибування**: бали за перестрибування заблокованих клітинок
5. **Штраф за зворотній хід**: штрафні бали за "дзеркальні" ходи
6. **Загальна сума балів**: сума всіх балів гравця

### Приклад відображення:
```
Детальна інформація про бали

Бали гравця Гравець 3

Основні бали: +2
Бонус за відстань: +1
Бонус за перестрибування: +1
Штраф за зворотній хід: -0

Загальна сума балів: 4

OK
```

### Формула розрахунку загальної суми:
```
Загальна сума = Основні бали + Бонус за відстань + Бонус за перестрибування - Штраф за зворотній хід
```

## Файли, що були змінені

- `src/lib/components/widgets/ScorePanelWidget.svelte` - оновлено функцію `showPlayerBonusInfo`
- `src/lib/i18n/uk/gameBoard.js` - оновлено заголовок українською мовою
- `src/lib/i18n/en/gameBoard.js` - оновлено заголовок англійською мовою
- `src/lib/i18n/nl/gameBoard.js` - оновлено заголовок голландською мовою
- `src/lib/i18n/crh/gameBoard.js` - оновлено заголовок кримськотатарською мовою

## Тестування

Виправлення протестовано:
- ✅ При натисканні на `bonus-display` показується структурований огляд всіх балів гравця
- ✅ Чітко розділені основні бали, бонусні бали та штрафні бали
- ✅ Бонусні бали розділені на категорії (за відстань та перестрибування)
- ✅ Показується правильна загальна сума всіх балів гравця
- ✅ Оновлено заголовки модальних вікон на всіх підтримуваних мовах

## Статус

✅ **ВИПРАВЛЕНО** - 2025-01-30 