---
status: done
---

# BUG-086: Виправлення розділення бонусних балів на категорії

## Опис проблеми

При натисканні на `bonus-display` бонусні бали за комбіновані дії (відстань + перестрибування) не розділялися правильно на категорії, що призводило до відсутності окремих рядків для "Бонус за відстань" та "Бонус за перестрибування".

### Актуальний результат
- При комбінованих бонусах (відстань + перестрибування) показувався тільки один рядок
- Відсутній рядок "Бонус за перестрибування +1"
- Неправильне розділення бонусних балів на категорії

### Очікуваний результат
- Правильне розділення комбінованих бонусних балів на категорії
- Окремі рядки для "Бонус за відстань" та "Бонус за перестрибування"
- Коректне відображення всіх типів бонусних балів

## Аналіз проблеми

### Причина
Логіка розділення бонусних балів на категорії не враховувала комбіновані бонуси, коли один хід дає бали як за відстань, так і за перестрибування. Коли `bonus.reason` містить обидві причини, він не розділявся на окремі категорії.

### Приклад проблеми:
```
bonus.reason = "хід на відстань 2 (1 бал) + перестрибування 1 заблокованих клітинок (1 балів)"
```
Такий бонус не розділявся на окремі категорії.

## Рішення

### 1. Оновлення логіки розділення бонусних балів

Змінено логіку в функції `showPlayerBonusInfo` для правильного розділення комбінованих бонусів:

```javascript
player.bonusHistory.forEach(bonus => {
  // Перевіряємо чи це комбінований бонус (відстань + перестрибування)
  if (bonus.reason.includes('хід на відстань') && bonus.reason.includes('перестрибування')) {
    // Розбиваємо комбінований бонус на частини
    const parts = bonus.reason.split(' + ');
    parts.forEach(part => {
      if (part.includes('хід на відстань')) {
        const match = part.match(/\((\d+) бал\)/);
        if (match) {
          distanceBonus += parseInt(match[1]);
        }
      } else if (part.includes('перестрибування')) {
        const match = part.match(/\((\d+) балів?\)/);
        if (match) {
          jumpBonus += parseInt(match[1]);
        }
      }
    });
  } else if (bonus.reason.includes('хід на відстань')) {
    const match = bonus.reason.match(/\((\d+) бал\)/);
    if (match) {
      distanceBonus += parseInt(match[1]);
    }
  } else if (bonus.reason.includes('перестрибування')) {
    const match = bonus.reason.match(/\((\d+) балів?\)/);
    if (match) {
      jumpBonus += parseInt(match[1]);
    }
  }
});
```

### 2. Оновлення заголовків модальних вікон

Змінено заголовки на більш точні:

#### Українська мова:
```javascript
bonusInfoTitle: "Поточні бали гравця"
```

#### Англійська мова:
```javascript
bonusInfoTitle: "Current Player Score"
```

#### Голландська мова:
```javascript
bonusInfoTitle: "Huidige Speler Score"
```

#### Кримськотатарська мова:
```javascript
bonusInfoTitle: "Mevcut Oyuncu Skoru"
```

### 3. Оновлення тексту заголовка

Змінено текст заголовка в модальному вікні:
```javascript
let scoreDetails = `Поточні бали гравця ${player.name}\n\n`;
```

## Результат

Тепер при натисканні на `bonus-display` користувач бачить:

### Правильне розділення бонусних балів:
1. **Комбіновані бонуси** правильно розділяються на категорії
2. **Окремі рядки** для "Бонус за відстань" та "Бонус за перестрибування"
3. **Коректне відображення** всіх типів бонусних балів

### Приклад відображення:
```
Поточні бали гравця Гравець N

Основні бали: +1
Бонус за відстань: +1
Бонус за перестрибування: +1
Штраф за зворотній хід: -0

Загальна сума балів: 3

OK
```

### Логіка розділення:
- **Комбінований бонус**: "хід на відстань 2 (1 бал) + перестрибування 1 заблокованих клітинок (1 балів)" → розділяється на дві категорії
- **Окремий бонус за відстань**: "хід на відстань 2 (1 бал)" → тільки категорія "Бонус за відстань"
- **Окремий бонус за перестрибування**: "перестрибування 1 заблокованих клітинок (1 балів)" → тільки категорія "Бонус за перестрибування"

## Файли, що були змінені

- `src/lib/components/widgets/ScorePanelWidget.svelte` - оновлено логіку розділення бонусних балів на категорії
- `src/lib/i18n/uk/gameBoard.js` - оновлено заголовок українською мовою
- `src/lib/i18n/en/gameBoard.js` - оновлено заголовок англійською мовою
- `src/lib/i18n/nl/gameBoard.js` - оновлено заголовок голландською мовою
- `src/lib/i18n/crh/gameBoard.js` - оновлено заголовок кримськотатарською мовою

## Тестування

Виправлення протестовано:
- ✅ Комбіновані бонусні бали правильно розділяються на категорії
- ✅ Показуються окремі рядки для "Бонус за відстань" та "Бонус за перестрибування"
- ✅ Коректне відображення всіх типів бонусних балів
- ✅ Оновлено заголовки модальних вікон на всіх підтримуваних мовах
- ✅ Правильний розрахунок загальної суми балів

## Статус

✅ **ВИПРАВЛЕНО** - 2025-01-30 