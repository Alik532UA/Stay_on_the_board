---
status: done
---

# BUG-079: –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤ –≤ –ª–æ–∫–∞–ª—å–Ω–∏—Ö —ñ–≥—Ä–∞—Ö

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

**–®–ª—è—Ö:** `/game/local`

**–ê–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –ù–ï –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –±—ñ–ª—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤ –≤ score-row

**–û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –±—ñ–ª—è –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤ –≤ score-row

## –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏

### –ü—Ä–∏—á–∏–Ω–∞
–®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–ª–∏—Å—è –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Ö—É–Ω–∫—É –≥—Ä–∞–≤—Ü—è (`player.score`) —á–µ—Ä–µ–∑ `localGameStore.addPlayerScore()`, —Ç–æ–º—É –≤–æ–Ω–∏ –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∏—Å—è –æ–∫—Ä–µ–º–æ –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ñ. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏–≤ —Ç—ñ–ª—å–∫–∏ –∑–∞–≥–∞–ª—å–Ω–∏–π —Ä–∞—Ö—É–Ω–æ–∫, –∞–ª–µ –Ω–µ –º—ñ–≥ —Ä–æ–∑—Ä—ñ–∑–Ω–∏—Ç–∏ –æ—Å–Ω–æ–≤–Ω—ñ –±–∞–ª–∏ —Ç–∞ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏.

### –î–æ–¥–∞—Ç–∫–æ–≤–∞ –ø—Ä–æ–±–ª–µ–º–∞
–í `ScorePanelWidget.svelte` –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö —ñ–≥–æ—Ä –Ω–µ –±—É–ª–æ –ª–æ–≥—ñ–∫–∏ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤ –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤, –Ω–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥ —ñ–≥–æ—Ä –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º, –¥–µ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞–ª–∏—Å—è –æ–∫—Ä–µ–º–æ.

## –†—ñ—à–µ–Ω–Ω—è

### 1. –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≥—Ä–∞–≤—Ü—è
–î–æ–¥–∞–Ω–æ –ø–æ–ª–µ `penaltyPoints` –¥–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≥—Ä–∞–≤—Ü—è –≤ `localGameStore.js`:

```javascript
// –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω (Single Source of Truth)
const createInitialState = () => {
  const player1Color = getRandomColor();
  const player2Color = getRandomUnusedColor([player1Color]);
  const player3Color = getRandomUnusedColor([player1Color, player2Color]);
  const player4Color = getRandomUnusedColor([player1Color, player2Color, player3Color]);
  
  return {
    players: [
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 1', color: player1Color, score: 0, penaltyPoints: 0 },
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 2', color: player2Color, score: 0, penaltyPoints: 0 },
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 3', color: player3Color, score: 0, penaltyPoints: 0 },
      { id: generateId(), name: '–ì—Ä–∞–≤–µ—Ü—å 4', color: player4Color, score: 0, penaltyPoints: 0 }
    ],
    // ...
  };
};
```

### 2. –î–æ–¥–∞–≤–∞–Ω–Ω—è –º–µ—Ç–æ–¥—É –¥–ª—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤
–°—Ç–≤–æ—Ä–µ–Ω–æ –Ω–æ–≤–∏–π –º–µ—Ç–æ–¥ `addPlayerPenaltyPoints` –≤ `localGameStore.js`:

```javascript
/** –î–æ–¥–∞—î —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –¥–æ —Ä–∞—Ö—É–Ω–∫—É –≥—Ä–∞–≤—Ü—è */
addPlayerPenaltyPoints: (playerId, penaltyPointsToAdd) => {
  console.log(`üéØ localGameStore.addPlayerPenaltyPoints: –¥–æ–¥–∞—î–º–æ ${penaltyPointsToAdd} —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤ –≥—Ä–∞–≤—Ü—é –∑ ID ${playerId}`);
  update(state => {
    const updatedState = {
      ...state,
      players: state.players.map(p => 
        p.id === playerId ? { ...p, penaltyPoints: p.penaltyPoints + penaltyPointsToAdd } : p
      )
    };
    const updatedPlayer = updatedState.players.find(p => p.id === playerId);
    console.log(`‚úÖ localGameStore.addPlayerPenaltyPoints: —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –≥—Ä–∞–≤—Ü—è ${updatedPlayer?.name} –æ–Ω–æ–≤–ª–µ–Ω–æ –¥–æ ${updatedPlayer?.penaltyPoints}`);
    return updatedState;
  });
},
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤
–ó–º—ñ–Ω–µ–Ω–æ `gameLogicService.ts` –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥—É:

```typescript
if (newPosition.row === computerRow && newPosition.col === computerCol) {
  console.log(`üéØ performMove: –¥–æ–¥–∞—î–º–æ 2 —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª–∏ –≥—Ä–∞–≤—Ü—é ${currentPlayer.name} –∑–∞ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π" —Ö—ñ–¥`);
  localGameStore.addPlayerPenaltyPoints(localPlayer.id, 2);
  console.log(`‚úÖ performMove: —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –¥–æ–¥–∞–Ω–æ –≥—Ä–∞–≤—Ü—é ${currentPlayer.name}`);
}
```

### 4. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ ScorePanelWidget
–î–æ–¥–∞–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤ –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤:

```svelte
{#each localGamePlayers as player}
  <div class="score-row">
    <span style={getPlayerNameStyle(player.name)}>{player.name}:</span>
    <span
      class="score-value-clickable"
      class:positive-score={player.score > 0}
      on:click={showScoreInfo}
      on:keydown={e => (e.key === 'Enter' || e.key === ' ') && showScoreInfo()}
      role="button"
      tabindex="0"
      title={$_('modal.scoreInfoTitle')}
    >{player.score}</span>
    {#if player.penaltyPoints > 0}
      <span 
        class="penalty-display" 
        on:click={showPenaltyInfo}
        on:keydown={e => (e.key === 'Enter' || e.key === ' ') && showPenaltyInfo()}
        title={$_('gameBoard.penaltyHint')}
        role="button"
        tabindex="0"
      >+{player.penaltyPoints}</span>
    {/if}
  </div>
{/each}
```

### 5. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –º–µ—Ç–æ–¥—É —Å–∫–∏–¥–∞–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—ñ–≤
–û–Ω–æ–≤–ª–µ–Ω–æ `resetScores` –¥–ª—è —Å–∫–∏–¥–∞–Ω–Ω—è —Ç–∞–∫–æ–∂ —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤:

```javascript
/** –°–∫–∏–¥–∞—î —Ä–∞—Ö—É–Ω–∫–∏ –≤—Å—ñ—Ö –≥—Ä–∞–≤—Ü—ñ–≤ */
resetScores: () => {
  update(state => {
    return {
      ...state,
      players: state.players.map(p => ({ ...p, score: 0, penaltyPoints: 0 }))
    };
  });
},
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è
1. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—É –≥—Ä—É –≤ `/game/local`
2. –ó—Ä–æ–±–∏—Ç–∏ –∫—ñ–ª—å–∫–∞ —Ö–æ–¥—ñ–≤, –≤–∫–ª—é—á–∞—é—á–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏
3. –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Ä–∞—Ö—É–Ω–∫—ñ–≤ –≤ `score-panel`
4. –ü–µ—Ä–µ–∫–æ–Ω–∞—Ç–∏—Å—è, —â–æ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤

### –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –û—Å–Ω–æ–≤–Ω—ñ –±–∞–ª–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è —è–∫ –∑–≤–∏—á–∞–π–Ω–æ
- –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –∑—ñ –∑–Ω–∞–∫–æ–º "+" —Ç–∞ —á–µ—Ä–≤–æ–Ω–∏–º –∫–æ–ª—å–æ—Ä–æ–º
- –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –∑'—è–≤–ª—è—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —ó—Ö –∫—ñ–ª—å–∫—ñ—Å—Ç—å > 0
- –ö–ª—ñ–∫ –Ω–∞ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –ø–æ–∫–∞–∑—É—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —à—Ç—Ä–∞—Ñ–∏

## –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- `src/lib/stores/localGameStore.js` - –¥–æ–¥–∞–Ω–æ –ø–æ–ª–µ `penaltyPoints` —Ç–∞ –º–µ—Ç–æ–¥ `addPlayerPenaltyPoints`
- `src/lib/services/gameLogicService.ts` - –æ–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –Ω–∞—Ä–∞—Ö—É–≤–∞–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤
- `src/lib/components/widgets/ScorePanelWidget.svelte` - –¥–æ–¥–∞–Ω–æ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤

## –°—Ç–∞—Ç—É—Å

‚úÖ **–í–ò–ü–†–ê–í–õ–ï–ù–û**

## –ü—Ä–∏–º—ñ—Ç–∫–∏

- –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ —Ç–µ–ø–µ—Ä –≤—ñ–¥—Å—Ç–µ–∂—É—é—Ç—å—Å—è –æ–∫—Ä–µ–º–æ –≤—ñ–¥ –æ—Å–Ω–æ–≤–Ω–∏—Ö –±–∞–ª—ñ–≤
- –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª—ñ–≤ —É–∑–≥–æ–¥–∂–µ–Ω–æ –∑ –¥–∏–∑–∞–π–Ω–æ–º –¥–ª—è —ñ–≥–æ—Ä –∑ –∫–æ–º–ø'—é—Ç–µ—Ä–æ–º
- –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –ø–æ–∫–∞–∑—É—é—Ç—å—Å—è –∑—ñ –∑–Ω–∞–∫–æ–º "+" –¥–ª—è –≤–∫–∞–∑—ñ–≤–∫–∏ –Ω–∞ —Ç–µ, —â–æ —Ü–µ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –±–∞–ª–∏
- –ó–±–µ—Ä–µ–∂–µ–Ω–æ –≤—Å—é —ñ—Å–Ω—É—é—á—É —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å (–∫–ª—ñ–∫–∏, –ø—ñ–¥–∫–∞–∑–∫–∏, —Ç–æ—â–æ) 