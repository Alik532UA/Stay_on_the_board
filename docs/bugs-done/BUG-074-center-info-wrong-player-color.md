---
status: done
---

# Тип: BUG
# Статус: Виконано
# Назва: Center-info показує хід гравця на фоні неправильного гравця в локальній грі
# Мета: Забезпечити, щоб center-info показував хід гравця на фоні кольору гравця, який зробив цей хід
# Опис: В локальній грі після ходу гравця center-info показує останній хід на фоні кольору гравця, який буде робити наступний хід, а має показувати на фоні кольору гравця, який тільки що зробив цей хід.

---

## Кроки для відтворення
1. Запустити локальну гру з кількома гравцями з різними кольорами
2. Зробити хід першим гравцем
3. Подивитися на center-info

## Актуальний результат
- center-info показує останній хід гравця на фоні кольору гравця, який буде робити наступний хід

## Очікуваний результат
- center-info показує останній хід гравця на фоні кольору гравця, який тільки що зробив цей хід

---

## Аналіз проблеми

### Причина
В `centerInfoUtil.ts` для відображення останнього ходу гравця використовувався `currentPlayerColor` (колір поточного гравця), але це неправильно, оскільки поточний гравець - це той, хто буде робити наступний хід. Потрібно використовувати колір попереднього гравця, який тільки що зробив хід.

### Рішення
Створити новий derived store `previousPlayerColor` та змінити логіку:

1. **Додати derived store `previousPlayerColor`** для отримання кольору попереднього гравця
2. **Змінити параметр** в `centerInfoUtil.ts` з `currentPlayerColor` на `previousPlayerColor`
3. **Оновити компоненти** для передачі правильного кольору гравця

---

## Зміни в коді

### src/lib/stores/derivedState.ts
- Додано derived store `previousPlayerColor` для отримання кольору попереднього гравця
- Логіка: `(currentPlayerIndex + players.length - 1) % players.length`

### src/lib/utils/centerInfoUtil.ts
- Змінено параметр з `currentPlayerColor` на `previousPlayerColor`
- Оновлено інтерфейс функції `getCenterInfoState`
- Змінено використання кольору фону для ходів гравців

### src/lib/components/widgets/ControlsPanelWidget.svelte
- Змінено імпорт з `currentPlayerColor` на `previousPlayerColor`
- Оновлено передачу параметра в `getCenterInfoState`

### src/components/GameControls.svelte
- Змінено імпорт з `currentPlayerColor` на `previousPlayerColor`
- Оновлено передачу параметра в `getCenterInfoState`

---

## Тестування

### Тест 1: Локальна гра з різними кольорами
1. Запустити локальну гру з 2+ гравцями з різними кольорами
2. Зробити хід першим гравцем (наприклад, червоним)
3. **Очікуваний результат:** center-info показує хід на червоному фоні
4. Зробити хід другим гравцем (наприклад, синім)
5. **Очікуваний результат:** center-info показує хід на синьому фоні

### Тест 2: Гра проти комп'ютера
1. Запустити гру проти комп'ютера
2. Зробити хід гравцем
3. **Очікуваний результат:** center-info показує хід комп'ютера на помаранчевому фоні (як і раніше)

---

## Додаткові завдання
- [x] Перевірити, що зміни не впливають на гру проти комп'ютера
- [x] Перевірити, що колір фону відповідає гравцю, який зробив хід
- [x] Додати відповідну документацію
- [x] Забезпечити, що логіка працює коректно для всіх гравців 