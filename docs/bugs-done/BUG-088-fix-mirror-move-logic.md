---
status: done
---

# BUG-088: –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤

## –û–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏

–õ–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤ –±—É–ª–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—é. –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è–ª–∞ —Ç—ñ–ª—å–∫–∏ —Ç–æ—á–Ω–µ —Å–ø—ñ–≤–ø–∞–¥—ñ–Ω–Ω—è –ø–æ–∑–∏—Ü—ñ–π, –∞–ª–µ –ø–æ–≤–∏–Ω–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫ —Ç–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å.

### –ê–∫—Ç—É–∞–ª—å–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°–∏—Å—Ç–µ–º–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è–ª–∞: `newPosition.row === computerRow && newPosition.col === computerCol`
- –¶–µ –æ–∑–Ω–∞—á–∞–ª–æ, —â–æ —à—Ç—Ä–∞—Ñ –Ω–∞—Ä–∞—Ö–æ–≤—É–≤–∞–≤—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ —Ç–æ—á–Ω–æ–º—É –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—ñ –Ω–∞ —Ç—É —Å–∞–º—É –ø–æ–∑–∏—Ü—ñ—é
- –ù–µ –≤—Ä–∞—Ö–æ–≤—É–≤–∞–≤—Å—è –Ω–∞–ø—Ä—è–º–æ–∫ —Ç–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å —Ö–æ–¥—É

### –û—á—ñ–∫—É–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–≤–∏–Ω–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –Ω–∞–ø—Ä—è–º–æ–∫ —Ç–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å
- –®—Ç—Ä–∞—Ñ –Ω–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –∫–æ–ª–∏ –≥—Ä–∞–≤–µ—Ü—å —Ä–æ–±–∏—Ç—å —Ö—ñ–¥ —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É –Ω–∞ N –∞–±–æ –º–µ–Ω—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª—ñ—Ç–∏–Ω–æ–∫ –ø—ñ—Å–ª—è —Ö–æ–¥—É –∫–æ–º–ø'—é—Ç–µ—Ä–∞ –Ω–∞ N –∫–ª—ñ—Ç–∏–Ω–æ–∫

## –ê–Ω–∞–ª—ñ–∑ –ø—Ä–æ–±–ª–µ–º–∏

### –ü—Ä–∏—á–∏–Ω–∞
–õ–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤ –±–∞–∑—É–≤–∞–ª–∞—Å—è –Ω–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—ñ –ø–æ–∑–∏—Ü—ñ–π, –∞ –Ω–µ –Ω–∞ –∞–Ω–∞–ª—ñ–∑—ñ –Ω–∞–ø—Ä—è–º–∫—É —Ç–∞ –≤—ñ–¥—Å—Ç–∞–Ω—ñ —Ö–æ–¥—ñ–≤. –ó–≥—ñ–¥–Ω–æ –∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—î—é:

> –ö–æ–º–ø'—é—Ç–µ—Ä –∑—Ä–æ–±–∏–≤ —Ö—ñ–¥ –Ω–∞ N –∫–ª—ñ—Ç–∏–Ω–æ–∫ —É –ø–µ–≤–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É
> –ì—Ä–∞–≤–µ—Ü—å –æ–¥—Ä–∞–∑—É –ø—ñ—Å–ª—è —Ü—å–æ–≥–æ —Ä–æ–±–∏—Ç—å —Ö—ñ–¥ —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É –Ω–∞ N –∞–±–æ –º–µ–Ω—à—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–ª—ñ—Ç–∏–Ω–æ–∫

### –ü—Ä–∏–∫–ª–∞–¥–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ—ó —Ä–æ–±–æ—Ç–∏
- –ö–æ–º–ø'—é—Ç–µ—Ä: `up-left 2` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `down-right 1` (–Ω–µ —à—Ç—Ä–∞—Ñ—É–≤–∞–ª–æ—Å—è, —Ö–æ—á–∞ –ø–æ–≤–∏–Ω–Ω–æ)
- –ö–æ–º–ø'—é—Ç–µ—Ä: `up 3` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `down 2` (–Ω–µ —à—Ç—Ä–∞—Ñ—É–≤–∞–ª–æ—Å—è, —Ö–æ—á–∞ –ø–æ–≤–∏–Ω–Ω–æ)

## –†—ñ—à–µ–Ω–Ω—è

### 1. –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó `isMirrorMove`

–î–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤:

```typescript
function isMirrorMove(
  currentDirection: string,
  currentDistance: number,
  computerDirection: string,
  computerDistance: number
): boolean {
  // –í–∏–∑–Ω–∞—á–∞—î–º–æ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω—ñ –Ω–∞–ø—Ä—è–º–∫–∏
  const oppositeDirections: Record<string, string> = {
    'up': 'down',
    'down': 'up',
    'left': 'right',
    'right': 'left',
    'up-left': 'down-right',
    'up-right': 'down-left',
    'down-left': 'up-right',
    'down-right': 'up-left'
  };

  const oppositeDirection = oppositeDirections[computerDirection];
  
  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Ö—ñ–¥ —É –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–æ–º—É –Ω–∞–ø—Ä—è–º–∫—É
  if (currentDirection !== oppositeDirection) {
    return false;
  }

  // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –≤—ñ–¥—Å—Ç–∞–Ω—å –≥—Ä–∞–≤—Ü—è –º–µ–Ω—à–∞ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é—î –≤—ñ–¥—Å—Ç–∞–Ω—ñ –∫–æ–º–ø'—é—Ç–µ—Ä–∞
  return currentDistance <= computerDistance;
}
```

### 2. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –≤ `calculateMoveScore`

–ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤:

```typescript
// –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π" —Ö—ñ–¥ —Ç—ñ–ª—å–∫–∏ –¥–ª—è —Ö–æ–¥—ñ–≤ –≥—Ä–∞–≤—Ü—è (–Ω–µ –∫–æ–º–ø'—é—Ç–µ—Ä–∞)
if (isHumanMove && direction && currentState.moveQueue.length >= 1) {
  const lastComputerMove = currentState.moveQueue[currentState.moveQueue.length - 1];
  
  if (lastComputerMove && lastComputerMove.player !== 0) {
    const isMirror = isMirrorMove(
      direction,
      distance,
      lastComputerMove.direction,
      lastComputerMove.distance
    );
    
    if (isMirror) {
      if (humanPlayersCount <= 1) {
        console.log(`üéØ calculateMoveScore: –¥–æ–¥–∞—î–º–æ 2 —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª–∏ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ penaltyPoints (single player game)`);
        newPenaltyPoints += 2;
      } else {
        console.log(`üéØ calculateMoveScore: –ù–ï –¥–æ–¥–∞—î–º–æ —à—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ–≥–æ penaltyPoints (local game), –±—É–¥—É—Ç—å –¥–æ–¥–∞–Ω—ñ –¥–æ –≥—Ä–∞–≤—Ü—è –≤ performMove`);
      }
    }
  }
}
```

### 3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è –ª–æ–≥—ñ–∫–∏ –≤ `performMove`

–ó–º—ñ–Ω–µ–Ω–æ –ª–æ–≥—ñ–∫—É –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ—ó –≥—Ä–∏:

```typescript
if (currentPlayer.type === 'human' && currentState.moveQueue.length >= 1) {
  const lastComputerMove = currentState.moveQueue[currentState.moveQueue.length - 1];
  
  if (lastComputerMove && lastComputerMove.player !== 0) {
    const isMirror = isMirrorMove(
      direction,
      distance,
      lastComputerMove.direction,
      lastComputerMove.distance
    );
    
    if (isMirror) {
      console.log(`üéØ performMove: –¥–æ–¥–∞—î–º–æ 2 —à—Ç—Ä–∞—Ñ–Ω–∏—Ö –±–∞–ª–∏ –≥—Ä–∞–≤—Ü—é ${currentPlayer.name} –∑–∞ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏–π" —Ö—ñ–¥`);
      localGameStore.addPlayerPenaltyPoints(localPlayer.id, 2);
    }
  }
}
```

### 4. –î–æ–¥–∞–≤–∞–Ω–Ω—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ –¥–æ `calculateMoveScore`

–î–æ–¥–∞–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `direction` –¥–æ —Ñ—É–Ω–∫—Ü—ñ—ó `calculateMoveScore`:

```typescript
function calculateMoveScore(
  currentState: any,
  newPosition: { row: number; col: number },
  playerIndex: number,
  settings: any,
  distance: number = 1,
  direction?: string // –î–æ–¥–∞–Ω–æ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤
): { score: number; penaltyPoints: number; movesInBlockMode: number; jumpedBlockedCells: number; bonusPoints: number }
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏:

### –ü—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ —à—Ç—Ä–∞—Ñ—É–≤–∞–Ω–Ω—è:
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `up-left 2` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `down-right 1` (—à—Ç—Ä–∞—Ñ)
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `up-left 2` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `down-right 2` (—à—Ç—Ä–∞—Ñ)
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `up 3` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `down 2` (—à—Ç—Ä–∞—Ñ)
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `right 1` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `left 1` (—à—Ç—Ä–∞—Ñ)

### –ü—Ä–∞–≤–∏–ª—å–Ω—ñ –ø—Ä–∏–∫–ª–∞–¥–∏ –±–µ–∑ —à—Ç—Ä–∞—Ñ—É:
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `up-left 2` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `down-right 3` (–Ω–µ–º–∞—î —à—Ç—Ä–∞—Ñ—É - –±—ñ–ª—å—à–∞ –≤—ñ–¥—Å—Ç–∞–Ω—å)
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `up 2` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `up 1` (–Ω–µ–º–∞—î —à—Ç—Ä–∞—Ñ—É - —Ç–æ–π —Å–∞–º–∏–π –Ω–∞–ø—Ä—è–º–æ–∫)
- ‚úÖ –ö–æ–º–ø'—é—Ç–µ—Ä: `up-left 2` ‚Üí –ì—Ä–∞–≤–µ—Ü—å: `up-right 1` (–Ω–µ–º–∞—î —à—Ç—Ä–∞—Ñ—É - –Ω–µ –ø—Ä–æ—Ç–∏–ª–µ–∂–Ω–∏–π –Ω–∞–ø—Ä—è–º–æ–∫)

## –§–∞–π–ª–∏, —â–æ –±—É–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- `src/lib/services/gameLogicService.ts` - –¥–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—é `isMirrorMove` —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ "–¥–∑–µ—Ä–∫–∞–ª—å–Ω–∏—Ö" —Ö–æ–¥—ñ–≤

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –ø—Ä–æ—Ç–µ—Å—Ç–æ–≤–∞–Ω–æ:
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è "–¥–∑–µ—Ä–∫–∞–ª—å–Ω—ñ" —Ö–æ–¥–∏ –∑–∞ –Ω–∞–ø—Ä—è–º–∫–æ–º
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –≤—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –≤—ñ–¥—Å—Ç–∞–Ω—å (–º–µ–Ω—à–∞ –∞–±–æ –¥–æ—Ä—ñ–≤–Ω—é—î)
- ‚úÖ –®—Ç—Ä–∞—Ñ–Ω—ñ –±–∞–ª–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –∑–∞ —Ö–æ–¥–∏ –≥—Ä–∞–≤—Ü—è
- ‚úÖ –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–∫–∞–∑—É—î –ø—Ä–∞–≤–∏–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É

## –°—Ç–∞—Ç—É—Å

‚úÖ **–í–ò–ü–†–ê–í–õ–ï–ù–û** - 2025-01-30 