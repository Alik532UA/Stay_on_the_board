# План покращення архітектури (SoC) - v21

**Дата:** 2025-08-25

## Частина 1: Комплексний аудит та оцінка

### Критерій: SoC (Separation of Concerns)

**Опис:** Аналіз того, наскільки добре в проєкті розділені відповідальності між модулями, що відповідають за **стан** (State), **логіку** (Logic) та **відображення** (UI).

**Аналіз:**
- **Стан (State):** Архітектура демонструє зразкове управління станом. `gameState` служить єдиним джерелом правди (SSoT), а всі мутації проводяться виключно через централізований сервіс `gameStateMutator`. Це повністю виключає непередбачувані зміни стану і робить потік даних прозорим.
- **Логіка (Logic):** Бізнес-логіка чітко відокремлена від UI. Класи режимів гри (`/gameModes`) інкапсулюють логіку конкретного режиму, а чисті функції (`/services`) реалізують правила гри. Це дозволяє легко тестувати та модифікувати логіку, не зачіпаючи візуальну частину.
- **UI (View):** Компоненти Svelte є "тупими" і лише реагують на зміни у сторах. Використання `derivedState` для обчислення похідних даних мінімізує логіку в компонентах, що відповідає найкращим практикам.

**Вимоги щодо ізоляції `game-board` та `center-info`:**
Вимога повністю виконується. `BoardWrapperWidget` залежить від `animationStore` для візуалізації, а `ControlsPanelWidget` (де знаходиться `center-info`) залежить від `derivedState`. Обидва стори читають дані з `gameState`, але не знають один про одного, що забезпечує їх повну незалежність.

### **Загальна оцінка поточного стану: 90/100**

Проєкт має чудову архітектуру, яка є гарною основою для майбутнього масштабування.

---

## Частина 2: План покращень та пріоритезація

Мета цього плану — підготувати кодову базу до реалізації нових функцій: редагування логіки режимів/таймера, онлайн-режиму та системи нагород.

### Пункти для покращення

- [ ] **Рефакторинг `GameState`:** Розглянути можливість декомпозиції великого об'єкта `GameState` на менші, більш спеціалізовані стори.
- [x] **Декомпозиція логіки режимів гри:** Винести спільну логіку з класів режимів гри (`/gameModes`) у базовий клас або сервіси-хелпери, щоб уникнути дублювання коду при додаванні нових режимів.
- [x] **Створення `TimeService`:** Інкапсулювати всю логіку, пов'язану з таймерами (загальний час на гру, час на хід), в окремий сервіс `TimeService`.
- [x] **Уніфікація обробки вводу:** Забезпечити, щоб абсолютно всі дії користувача з UI проходили через єдину точку входу (наприклад, `userActionService`), щоб відповідати діаграмі UDF.
- [x] **Виділення логіки ШІ:** Винести логіку прийняття рішень комп'ютером з `TrainingGameMode` в `aiService`, щоб `TrainingGameMode` лише викликав метод `aiService.getComputerMove()`.

### Список проблем та пріоритезація

| Пріоритет (0-100) | Проблема/Задача                                                                                             | Опис та мета                                                                                                                                                             |
| :---------------- | :---------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **100**           | `[x]` **Створити `TimeService` для керування таймерами**                                                     | **Без цього неможливо реалізувати нові режими.** Потрібно централізувати логіку запуску, зупинки та обробки таймерів для режимів "Гра на час", "Локальна гра" та "Онлайн-гра". |
| **95**            | `[x]` **Декомпозиція логіки режимів гри**                                                                   | **Надважливо для масштабування.** Спростить додавання нових режимів ("Гра на час", "Онлайн-гра") та зменшить кількість дубльованого коду.                                  |
| **80**            | `[x]` **Рефакторинг `GameState` для інтеграції таймерів**                                                    | **Важливо для чистоти стану.** Додати в `gameState` поля для таймерів (`remainingTime`, `turnTimeLimit`), можливо, виділивши їх в окремий під-об'єкт `modeState`.          |
| **70**            | `[x]` **Винести логіку ШІ повністю в `aiService`**                                                           | **Покращення SoC.** `TrainingGameMode` не повинен знати, *як* комп'ютер обирає хід. Це спростить тестування та модифікацію логіки ШІ в майбутньому.                     |
| **60**            | `[x]` **Уніфікувати обробку вводу гравця**                                                                   | **Покращення консистентності архітектури.** Зробить потік даних ще більш передбачуваним і спростить відстеження дій користувача.                                      |
| **40**            | `[ ]` **Розглянути декомпозицію `GameState`**                                                               | **Опціональне покращення.** На даному етапі не критично, але може стати корисним у далекому майбутньому, коли стан гри значно ускладниться.                               |
