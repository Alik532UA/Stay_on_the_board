---
type: improvement-plan
status: виконано
title: "Міграція drag-and-drop на svelte-drag-and-drop-actions"
id: PLAN-003
date: "2025-07-13"
author: ""
---

## Опис

Перехід з svelte-dnd-action на svelte-drag-and-drop-actions для повністю контрольованого drag-and-drop у Svelte з підтримкою Svelte store, без race condition та "костилів".

---

## 1. Аналіз поточної інтеграції
- [ ] Визначити всі компоненти, які використовують `svelte-dnd-action` (наприклад, DynamicLayout.svelte).
- [ ] Задокументувати, які саме сценарії drag-and-drop потрібні (один список, кілька колонок, вкладені списки тощо).
- [ ] Виписати, які саме дані мають бути "single source of truth" (Svelte store).

---

## 2. Вивчення API нової бібліотеки
- [ ] Ознайомитися з [документацією svelte-drag-and-drop-actions](https://github.com/rozek/svelte-drag-and-drop-actions).
- [ ] Зрозуміти, як працюють дії `use:asDraggable`, `use:asDroppable`, `use:asDropZone`.
- [ ] Перевірити, як передавати і оновлювати дані через Svelte store (повністю контрольований режим).

---

## 3. Підготовка до міграції
- [ ] Додати нову бібліотеку у проект: `npm install svelte-drag-and-drop-actions`
- [ ] Створити тестовий компонент з мінімальним drag-and-drop (1 список, 1 draggable) для перевірки роботи бібліотеки у вашому стеку.
- [ ] Переконатися, що бібліотека працює з Svelte 4+ та вашим білдом.

---

## 4. Міграція основної логіки
- [ ] Замінити імпорт та використання `dndzone` на відповідні дії з нової бібліотеки (`asDraggable`, `asDroppable`, `asDropZone`).
- [ ] Переписати розмітку: додати `use:asDraggable` на draggable-елементи, `use:asDropZone` на контейнер.
- [ ] Оновити логіку оновлення Svelte store: тепер store оновлюється тільки у ваших обробниках (наприклад, onDrop), без race condition.
- [ ] Додати/адаптувати анімації (за потреби — через Svelte animate:flip або transition).

---

## 5. Тестування та відлов багів
- [ ] Перевірити всі сценарії drag-and-drop (перетягування, reorder, переміщення між колонками, edge cases).
- [ ] Переконатися, що стан завжди відповідає DOM (single source of truth).
- [ ] Додати логування для швидкої діагностики проблем.
- [ ] Перевірити роботу на різних пристроях/браузерах.

---

## 6. Рефакторинг і чистка коду
- [ ] Видалити всі залежності та залишки коду від `svelte-dnd-action`.
- [ ] Оновити документацію, README, коментарі у коді.
- [ ] Оновити тести (unit, e2e), якщо вони є.

---

## 7. Ризики та рекомендації
- **Ризик:** Деякі edge cases можуть поводитися інакше (наприклад, вкладені списки, кастомні drag images).
  - **Рекомендація:** Тестувати всі сценарії, які важливі для вашого UI.
- **Ризик:** Можливі відмінності у стилях/анімаціях.
  - **Рекомендація:** Використовувати Svelte transitions/animate для плавності.
- **Ризик:** Інший API для обробників подій.
  - **Рекомендація:** Переписати обробники під нову бібліотеку, не намагаючись зберегти стару архітектуру 1:1.

---

## 8. Чекліст для завершення міграції
- [ ] Весь drag-and-drop працює через нову бібліотеку
- [ ] Весь стан контролюється через Svelte store
- [ ] Відсутні race condition, баги з DOM, дублікати ключів
- [ ] Код чистий, без "костилів" і залишків старої бібліотеки
- [ ] Оновлена документація для команди

---

**Готовий допомогти з конкретними прикладами коду під ваш UI!** 