# План впровадження режиму "Локальна гра"

**Мета:** Створити повноцінну сторінку налаштувань для локальної гри (кілька гравців за одним пристроєм) та інтегрувати її з існуючою ігровою логікою, дотримуючись встановлених архітектурних принципів.

---

### Фаза 1: Створення UI та управління станом для налаштувань

- [x] **Створити новий маршрут (route) для сторінки налаштувань:**
    -   [x] Створити папку `src/routes/local-setup/`.
    -   [x] Створити файл `src/routes/local-setup/+page.svelte` для розмітки сторінки.

- [x] **Оновити головне меню:**
    -   [x] У файлі `src/lib/components/MainMenu.svelte` знайти кнопку "Локальна гра".
    -   [x] Прибрати клас `pseudo-disabled` та обробник `onclick`, що показує модальне вікно "В розробці".
    -   [x] Додати навігацію на новий маршрут `/local-setup` при натисканні на кнопку.

- [x] **Створити сховище (store) для налаштувань локальної гри:**
    -   [x] Створити файл `src/lib/stores/localGameStore.js`.
    -   [x] Визначити початковий стан (SSoT):
        ```javascript
        {
          players: [
            { id: 1, name: 'Гравець 1', color: '#ff0000' },
            { id: 2, name: 'Гравець 2', color: '#0000ff' }
          ],
          settings: {
            boardSize: 4,
            blockModeEnabled: true,
            autoHideBoard: true,
            lockSettings: true
          }
        }
        ```
    -   [x] Реалізувати функції для додавання, видалення та оновлення гравців.
    -   [x] Реалізувати функцію для оновлення налаштувань гри.

- [x] **Створити компонент "Менеджер гравців":**
    -   [x] Створити файл `src/lib/components/local-setup/PlayerManager.svelte`.
    -   [x] Компонент повинен підписатися на `localGameStore` для отримання списку гравців.
    -   [x] Реалізувати відображення списку гравців за допомогою циклу `{#each}`.
    -   [x] Кожен рядок гравця повинен містити поле вводу для імені (`<input type="text">`) та вибору кольору (`<input type="color">`), прив'язані до даних у `localGameStore`.
    -   [x] Додати кнопку "Додати гравця", яка викликає відповідну функцію в `localGameStore`.
    -   [x] Додати кнопку "Почати гру" під списком.

- [x] **Створити компонент "Налаштування локальної гри":**
    -   [x] Створити файл `src/lib/components/local-setup/LocalGameSettings.svelte`.
    -   [x] Компонент повинен підписатися на `localGameStore` для отримання налаштувань.
    -   [x] Реалізувати елементи керування (чекбокси, вибір розміру дошки), прив'язані до стану в `localGameStore`.
    -   [x] Для вибору розміру дошки перевикористати або адаптувати існуючий компонент, щоб уникнути дублювання коду (DRY).

- [x] **Зібрати сторінку налаштувань:**
    -   [x] У файлі `src/routes/local-setup/+page.svelte` імпортувати `PlayerManager` та `LocalGameSettings`.
    -   [x] Створити двоколонкову розмітку та розмістити в ній компоненти.

### Фаза 2: Адаптація ігрової логіки

- [x] **Оновити `gameState` для підтримки кількох гравців:**
    -   [x] Переконатися, що `gameState` може прийняти масив `players` з кількома гравцями типу `human`.
    -   [x] Логіка `currentPlayerIndex` повинна коректно перемикатися між усіма гравцями в масиві.

- [x] **Адаптувати `gameOrchestrator`:**
    -   [x] Модифікувати логіку, яка відповідає за хід комп'ютера (`_triggerComputerMove`). Вона не повинна спрацьовувати, якщо наступний гравець — `human`.
    -   [x] Створити нову логіку для перемикання ходу, яка просто збільшує `currentPlayerIndex` і передає керування наступному гравцеві-людині.

- [x] **Оновити UI на ігровій сторінці:**
    -   [x] Компоненти, що відображають інформацію про хід (наприклад, `ScorePanelWidget`, `GameInfoWidget`), повинні показувати, чий зараз хід (наприклад, "Хід Гравця 2").

### Фаза 3: Інтеграція та запуск гри

- [x] **Реалізувати логіку кнопки "Почати гру":**
    -   [x] У компоненті `PlayerManager.svelte` додати обробник `onclick` для кнопки "Почати гру".
    -   [x] Функція повинна:
        1.  Отримати поточний стан з `localGameStore`.
        2.  Оновити `gameState`, передавши в нього список гравців та налаштування.
        3.  Перенаправити користувача на сторінку гри (`/game`).

- [x] **Реалізувати блокування налаштувань під час гри:**
    -   [x] На сторінці гри (`/game`) перевіряти налаштування `lockSettings` з `gameState`.
    -   [x] Якщо `lockSettings` має значення `true`, компонент `SettingsExpanderWidget` повинен бути неактивним (disabled).

### Фаза 4: Тестування та фіналізація

- [ ] **Провести повне тестування:**
    -   [ ] Перевірити перехід з головного меню на сторінку налаштувань.
    -   [ ] Перевірити додавання та видалення гравців (більше 2, менше 2).
    -   [ ] Перевірити коректну роботу всіх налаштувань на сторінці.
    -   [ ] Перевірити запуск гри та правильну ініціалізацію `gameState`.
    -   [ ] Перевірити коректне перемикання ходів між гравцями.
    -   [ ] Перевірити, що логіка перемоги/поразки працює для кількох гравців.
    -   [ ] Перевірити, що блокування налаштувань під час гри працює.

- [ ] **Покращити UI/UX:**
    -   [ ] Переконатися, що сторінка налаштувань адаптивна.
    -   [ ] Додати візуальні відгуки на дії користувача (наприклад, при додаванні гравця).

- [ ] **Додати коментарі:**
    -   [ ] Додати коментарі до нової логіки в `gameOrchestrator` та `localGameStore`, пояснюючи, *навіщо* були зроблені зміни.
