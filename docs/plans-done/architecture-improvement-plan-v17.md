# Архітектурний план покращення v17

## Частина 1: Комплексний аудит коду

| Критерій | Оцінка (0-100) | Коментар |
| :--- | :--- | :--- |
| **Архітектура та Структура** | | |
| 1. **SSoT (Single Source of Truth)** | 90 | Добре реалізовано через Svelte stores (`gameState`, `appSettingsStore`). Стан централізований та передбачуваний. |
| 2. **UDF (Unidirectional Data Flow)** | 85 | Потік даних (UI -> Action -> Mutator -> Store -> UI) є здебільшого односпрямованим. Є невеликі відхилення, де логіка режимів гри може напряму впливати на UI через `gameEventBus`. |
| 3. **SoC (Separation of Concerns)** | 75 | Гарний поділ між чистою логікою (`gameLogicService`), керуванням станом (`gameStateMutator`) та режимами гри (`BaseGameMode`). Проте, логіка обробки "немає ходів" та деякі побічні ефекти дублюються в режимах гри. |
| 4. **Композиція** | 80 | Архітектура на основі сервісів та режимів гри дозволяє гнучко комбінувати логіку. |
| 5. **Чистота та Побічні ефекти** | 70 | `gameLogicService` є переважно чистим, що є великим плюсом. Побічні ефекти (модальні вікна, анімації) керуються в режимах гри, але їх можна було б ізолювати ще краще (наприклад, через `sideEffectService`). |
| **Якість Коду та Реалізації** | | |
| 6. **DRY (Don't Repeat Yourself)** | 60 | Є дублювання коду, особливо в логіці `handleNoMoves` та `continueAfterNoMoves` у `VsComputerGameMode` та `LocalGameMode`. Логіка створення модальних вікон також повторюється. |
| 7. **Простота та Читабельність (KISS)** | 85 | Код добре структурований, імена змінних та функцій зрозумілі. Використання окремих сервісів для різних завдань значно покращує читабельність. |
| 8. **Продуктивність** | 80 | На даному етапі немає очевидних проблем з продуктивністю. Реактивність Svelte добре справляється з оновленнями стану. |
| 9. **Документація та Коментарі** | 65 | Коментарі присутні, але не завжди пояснюють *навіщо* була прийнята та чи інша реалізація. |

---

## Частина 2: План покращень для масштабування

### Пріоритетні завдання

| Пріоритет (0-100) | Завдання | Опис |
| :--- | :--- | :--- |
| **100** | [ ] **Рефакторинг `BaseGameMode` для усунення дублювання** | Винести спільну логіку `handleNoMoves` та `continueAfterNoMoves` з `VsComputerGameMode` та `LocalGameMode` в `BaseGameMode`. Це зменшить дублювання коду та спростить додавання нових режимів. |
| **95** | [ ] **Створення `TimeService` для керування таймерами** | Створити новий сервіс (`timeService.ts`) для керування таймерами ходу гравців та загальним часом гри. Це необхідно для нових ігрових режимів з обмеженням по часу. |
| **90** | [ ] **Ізоляція побічних ефектів** | Активніше використовувати `gameEventBus` або `sideEffectService` для відокремлення логіки гри від UI-ефектів (модальні вікна, звуки, анімації). `BaseGameMode` не повинен напряму викликати `gameEventBus.dispatch('ShowModal', ...)`. |
| **85** | [ ] **Адаптація архітектури для онлайн-режиму** | Переглянути `gameState` та `gameStateMutator`, щоб переконатися, що вони готові до синхронізації з Firebase. Стан повинен бути повністю серіалізованим. |
| **80** | [ ] **Створення `TimedVsComputerGameMode`** | Створити новий режим гри `TimedVsComputerGameMode`, який успадковується від `VsComputerGameMode` і використовує `TimeService` для обмеження часу гри. |
| **75** | [ ] **Інтеграція таймера ходу в існуючі режими** | Додати опціональну інтеграцію `TimeService` в `LocalGameMode` та `VsComputerGameMode` для таймера на хід. |
| **70** | [ ] **Покращення документації та коментарів** | Додати JSDoc коментарі до ключових методів у сервісах та режимах гри, пояснюючи їх призначення та взаємодію. |

### Важливі зауваження

- **[ ] Збереження незалежності `game-board` та `center-info`:** Під час рефакторингу необхідно суворо дотримуватися принципу, що `gameLogicService` та `gameState` не повинні мати жодної інформації про візуальне представлення.
- **[ ] Увага до попереджень в коді:** Ретельно перевірити існуючі коментарі на предмет попереджень про потенційні проблеми під час рефакторингу.