# План покращення архітектури v29

## Частина 1: Аудит коду

Комплексний аудит коду проводився за ключовими архітектурними принципами.

**Архітектура та Структура:**

1.  **SSoT (Single Source of Truth) - Єдине джерело правди:**
    *   **Оцінка: 55/100**
    *   **Обґрунтування:** Хоча проект використовує Svelte stores для управління станом, сам стан гри сильно фрагментований між численними сховищами (`boardStore`, `playerStore`, `scoreStore`, `uiStateStore` тощо). Це створює ризики розсинхронізації, ускладнює управління станом як єдиним цілим і суперечить принципу SSoT. Оновлення стану вимагає координації змін у кількох незалежних сховищах.

2.  **UDF (Unidirectional Data Flow) - Односпрямований потік даних:**
    *   **Оцінка: 85/100**
    *   **Обґрунтування:** Потік даних загалом відповідає принципу UDF: Події від UI ініціюють дії в сервісах, які змінюють стан у сховищах, що, в свою чергу, реактивно оновлює UI. Цикл "view -> action -> state -> view" чітко простежується. Невелике зниження балу пов'язане з широким використанням `get()` всередині сервісів, що може ускладнити відстеження залежностей даних.

3.  **SoC (Separation of Concerns) - Розділення відповідальності:**
    *   **Оцінка: 90/100**
    *   **Обґрунтування:** Проект демонструє відмінний рівень розділення відповідальності. Є чітка межа між UI (компоненти `.svelte`), сервісами (оркестрація та бізнес-логіка), сховищами (стан) та утилітами. `gameLogicService` наближений до чистої доменної логіки. `userActionService` добре ізолює логіку обробки дій користувача.

---

## Частина 2: План покращень

### Надважливі завдання (Золоті правила)

- [x] **Ізоляція логіки та візуалізації:**
    - [x] Візуалізація дошки (`game-board`) **НІКОЛИ** не повинна впливати на `center-info` та ігрову логіку.
    - [x] Ігрова логіка та `center-info` **НІЧОГО** не знають про існування візуальної дошки.
- [x] **Врахування попереджень у коді:** Звернути особливу увагу на коментарі, що попереджають про потенційні проблеми під час рефакторингу, щоб уникнути поломки існуючої логіки.

### Список проблем та пріоритети покращень

| Пріоритет | Завдання | Опис | Статус |
| :--- | :--- | :--- | :--- |
| **100** | **Рефакторинг стану гри (усунення фрагментації)** | Об'єднати розрізнені сховища (`boardStore`, `playerStore`, `scoreStore`, `uiStateStore`) в єдине `gameStateStore`. Це відновить SSoT, спростить оновлення стану та підвищить надійність. | `[ ]` |
| **70** | **Ізоляція побічних ефектів у `gameLogicService`** | Перемістити логіку синтезу мовлення з функції `performMove` на рівень вище (ймовірно, в `userActionService` або спеціалізований `sideEffectService`). `performMove` повинна повертати лише дані та опис необхідних побічних ефектів, залишаючись чистою функцією. | `[ ]` |
| **50** | **Декомпозиція `userActionService`** | Розглянути можливість винесення частини логіки з `userActionService` у більш спеціалізовані сервіси. Наприклад, логіку, пов'язану з життєвим циклом гри (рестарт, реплей), можна винести в `gameLifecycleService`. | `[ ]` |
| **40** | **Мінімізація прямого використання `get()` в сервісах** | Провести рефакторинг сервісів для зменшення прямого доступу до store'ів через `get()`. Замість цього передавати необхідний стан як аргументи функцій. Це покращить чистоту функцій та прозорість потоків даних. | `[ ]` |
