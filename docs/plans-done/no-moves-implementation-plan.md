# План реалізації для ситуації "Ходів немає" в локальній грі

**Мета:** Реалізувати нову логіку для обробки ситуації, коли гравець у локальній грі заявляє про відсутність ходів.

## Крок 1: Модифікація `gameOrchestrator.ts`

**Завдання:** Змінити логіку, яка викликається при натисканні кнопки "Ходів немає", щоб вона відповідала новим правилам для локальної гри.

-   **Знайти функцію `claimNoMoves`** (або аналогічну).
-   **Додати перевірку режиму гри:**
    -   Якщо `gameMode === 'local'`, викликати нову функцію `_handleLocalNoMoves`.
    -   Якщо `gameMode === 'vsComputer'`, залишити поточну логіку.
-   **Створити нову приватну функцію `_handleLocalNoMoves`:**
    -   Вона повинна перевіряти наявність доступних ходів.
    -   **Якщо ходи є:** гра закінчується і це програш поточного гравця.
    -   **Якщо ходів немає:**
        -   Не нараховувати бонус.
        -   Викликати `modalStore.showModal` з новим контентом.

## Крок 2: Оновлення `modalStore` та UI

**Завдання:** Створити контент для нового модального вікна та визначити дії для його кнопок.

-   **У функції `_handleLocalNoMoves` в `gameOrchestrator.ts`:**
    -   Сформувати об'єкт для `modalStore.showModal`.
    -   **`titleKey`:** `modal.noMovesTitle`
    -   **`contentKey`:** `modal.noMovesLocalGameContent`
    -   **`buttons`:**
        -   **Кнопка "Продовжити гру":**
            -   **`textKey`:** `modal.continueGame`
            -   **`onClick`:** Має викликати нову функцію в `gameOrchestrator`, наприклад, `_continueLocalGameAfterNoMoves`. Ця функція повинна:
                -   Очистити всі заблоковані клітинки (`gameState.update(s => ({ ...s, blockedCells: [] }))`).
                -   Передати хід наступному гравцю.
                -   Закрити модальне вікно.
        -   **Кнопка "Завершити гру":**
            -   **`textKey`:** `modal.endGame`
            -   **`onClick`:** Має викликати існуючу функцію `endGame`, яка підрахує результати та визначить переможця.
        -   **Кнопка "Переглянути запис":**
            -   **`textKey`:** `modal.reviewRecord`
            -   **`onClick`:** Має перенаправляти на сторінку перегляду запису гри.

## Крок 3: Оновлення локалізації

**Завдання:** Додати нові текстові рядки для модального вікна.

-   **Відкрити файли локалізації (наприклад, `src/lib/i18n/uk/modal.js`):**
-   **Додати нові ключі:**
    -   `noMovesLocalGameContent`: "У гравця {playerName} немає доступних ходів. Ви можете очистити дошку і продовжити гру, або завершити її зараз."
    -   `continueGame`: "Продовжити гру"
    -   `reviewRecord`: "Переглянути запис"

## Крок 4: Видалення логіки нарахування бонусу в локальній грі

**Завдання:** Переконатися, що бонус за "немає ходів" більше не нараховується в локальному режимі гри.

-   **Перевірити `gameOrchestrator.ts` та `gameLogicService.ts`:**
    -   Знайти місця, де нараховується `noMovesBonus`.
    -   Додати умову, щоб цей бонус нараховувався тільки якщо `gameMode !== 'local'`.

## Крок 5: Тестування

**Завдання:** Перевірити всі сценарії.

-   **Сценарій 1:** Гравець у локальній грі натискає "Ходів немає", коли ходи є.
    -   **Очікуваний результат:** Гра закінчується, і поточний гравець програє.
-   **Сценарій 2:** Гравець у локальній грі натискає "Ходів немає", коли ходів дійсно немає.
    -   **Очікуваний результат:** З'являється модальне вікно з двома опціями.
-   **Сценарій 3:** У модальному вікні натиснути "Продовжити гру".
    -   **Очікуваний результат:** Заблоковані клітинки зникають, хід переходить до наступного гравця.
-   **Сценарій 4:** У модальному вікні натиснути "Завершити гру".
    -   **Очікуваний результат:** Гра закінчується, з'являється модальне вікно з результатами.