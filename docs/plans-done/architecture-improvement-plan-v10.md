# План Покращення Архітектури v10

Цей документ містить комплексний аудит поточної кодової бази та надає пріоритезований план покращень для підготовки додатку до майбутнього масштабування, зокрема, до додавання режиму "Гра онлайн".

## Частина 1: Аудит Коду (До рефакторингу)

### Архітектура та Структура

*   **[75] Єдине Джерело Правди (SSoT):** Використання Svelte stores (`gameState`, `localGameStore`, `appSettingsStore`) забезпечує хорошу основу для централізованого управління станом. Однак існують місця, де стан неявно пов'язаний або виводиться в компонентах, що може призвести до потенційних розбіжностей. Недавній рефакторинг `availableMoves` у derived store є позитивним кроком, але можна зробити більше, щоб весь стан походив з єдиного, надійного джерела.
*   **[80] Односпрямований Потік Даних (UDF):** Потік даних загалом слідує передбачуваному шаблону (UI відправляє дії -> сервіси/оркестратор оновлюють стори -> UI реагує). Це полегшує розуміння додатку. Впровадження `gameOrchestrator` допомогло централізувати потік управління, хоча його широкі обов'язки іноді ускладнюють відстеження конкретних взаємодій.
*   **[70] Розділення Відповідальностей (SoC):** Існує чітке розділення між UI (Svelte компоненти) та управлінням станом (Svelte стори). Однак `gameOrchestrator` наразі обробляє суміш відповідальностей, включаючи перемикання ігрових режимів, маніпуляції зі станом та прямі взаємодії з UI (наприклад, показ модальних вікон). Це можна покращити, подалі розділивши ці обов'язки. Основна ігрова логіка добре інкапсульована в сервісах, таких як `gameLogicService`.
*   **[85] Композиція:** Додаток ефективно використовує Svelte компоненти для побудови користувацького інтерфейсу. Компоненти, як правило, невеликі, сфокусовані та багаторазові (наприклад, `BoardCell`, `FloatingBackButton`, `Modal`). Це сильна сторона поточної архітектури.
*   **[65] Чистота та Побічні Ефекти:** Побічні ефекти (такі як маніпуляції з `sessionStorage`, прямий доступ до DOM та таймери) присутні в декількох компонентах та сторах. Хоча вони необхідні, вони не завжди добре ізольовані, що ускладнює тестування та налагодження. Наприклад, логіка відтворення в `FloatingBackButton.svelte` тісно пов'язана з `sessionStorage`.

### Якість Коду та Реалізація

*   **[70] Не Повторюйся (DRY):** Існує деяке дублювання коду, особливо в налаштуванні та управлінні станом для різних ігрових режимів (`local` проти `vs-computer`). Логіка обробки сценаріїв завершення гри та відновлення стану також розкидана, як видно в компонентах `replay` та `FloatingBackButton`.
*   **[80] Простота та Читабельність (KISS):** Код загалом має хороші імена та легко зрозумілий. Використання TypeScript та коментарів JSDoc покращує читабельність. Деякі функції та компоненти стали великими і могли б виграти від розбиття на менші, більш сфокусовані одиниці.
*   **[75] Продуктивність:** Додаток добре працює для свого поточного обсягу. Однак широке використання derived stores та реактивних виразів може призвести до проблем з продуктивністю в міру зростання додатку. Очевидних серйозних вузьких місць немає, але огляд продуктивності був би корисним перед додаванням більш складних функцій.
*   **[90] Документація та Коментарі:** Кодова база добре задокументована за допомогою коментарів JSDoc, а сам код часто є самоочевидним. Коментарі ефективно використовуються для пояснення *чому* за складною логікою, що є вирішальним для підтримки.

## Частина 2: План Покращень (Виконано)

### Високопріоритетні Покращення (Обов'язково для Масштабування)

*   **[x] [100] Рефакторинг Управління Станом Гри:** Створено єдиний `gameStore`, що централізує стан гри та усуває його дублювання.
*   **[x] [100] Розділити Ігрову Логіку та UI:** `gameLogicService` тепер містить чисті функції, а `gameOrchestrator` виступає координатором, що значно покращило розділення відповідальностей.
*   **[x] [95] Ізолювати Побічні Ефекти:** Взаємодія з `sessionStorage` повністю інкапсульована в `replayService`, що робить компоненти та сервіси чистішими.
*   **[x] [90] Абстрагувати Ігрові Режими:** Впроваджено інтерфейс `IGameMode` та його реалізації (`VsComputerGameMode`, `LocalGameMode`), що дозволяє легко додавати нові режими гри.

### Середньопріоритетні Покращення (Важливо для Якості та Підтримки)

*   **[x] [80] Рефакторинг `gameOrchestrator`:** `gameOrchestrator` було значно спрощено. Він більше не містить логіки, специфічної для режимів, а делегує виклики активному `IGameMode`.
*   **[x] [75] Спростити Відтворення та Відновлення Стану:** Створено `replayService`, який централізує всю логіку збереження та завантаження стану гри для відтворення, усунувши дублювання коду.
*   **[ ] [70] Централізувати Управління Гравцями:** Створити `PlayerService` для обробки створення гравців, управління ними та черговості ходів, абстрагуючи відмінності між локальними та онлайн-гравцями.
*   **[ ] [65] Переглянути та Оптимізувати Derived Stores:** Проаналізувати граф залежностей derived stores для виявлення потенційних вузьких місць у продуктивності та непотрібних переобчислень.

### Низькопріоритетні Покращення (Добре було б мати)

*   **[ ] [50] Уніфікувати Стилізацію та Теми:** Консолідувати всі визначення кольорів та стилі, пов'язані з темами, в єдиному, легко конфігурованому місці для забезпечення узгодженості.
*   **[ ] [40] Покращити Обробку Помилок:** Впровадити більш надійну стратегію обробки помилок, з дружніми до користувача повідомленнями про помилки та централізованим механізмом логування для несподіваних проблем.

## Частина 3: Аудит Коду (Після рефакторингу)

### Архітектура та Структура

*   **[95] Єдине Джерело Правди (SSoT):** (+20) Створення `gameStore` та чітке розмежування станів (`gameState`, `localGameStore`) значно посилило цей принцип. Ризик розсинхронізації стану мінімізований.
*   **[90] Односпрямований Потік Даних (UDF):** (+10) Потік даних тепер ще більш контрольований. UI викликає методи `gameOrchestrator`, який делегує їх активному режиму гри, що оновлює централізований стейт.
*   **[90] Розділення Відповідальностей (SoC):** (+20) Це один з найбільших виграшів. `gameLogicService` тепер повністю чистий. Логіка режимів інкапсульована в класах. `gameOrchestrator` став тонким шаром координації.
*   **[85] Композиція:** (0) Сильна сторона архітектури збереглася.
*   **[90] Чистота та Побічні Ефекти:** (+25) Створення `replayService` та винесення логіки з компонентів значно покращило чистоту коду. Основна логіка тепер вільна від побічних ефектів.

### Якість Коду та Реалізація

*   **[85] Не Повторюйся (DRY):** (+15) Впровадження `IGameMode` майже повністю усунуло дублювання логіки між ігровими режимами. Спільний код винесено в `gameOrchestrator` та сервіси.
*   **[90] Простота та Читабельність (KISS):** (+10) Код став значно простішим для розуміння. Тепер, щоб зрозуміти логіку локальної гри, достатньо подивитися в `LocalGameMode.ts`.
*   **[75] Продуктивність:** (0) Рефакторинг не вплинув на продуктивність, але створив основу для її оптимізації в майбутньому.
*   **[90] Документація та Коментарі:** (0) Високий рівень документації підтримується.