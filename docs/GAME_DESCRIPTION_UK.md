# Stay on the Board: Повний посібник з гри

## 1. Основна концепція

**"Stay on the Board"** - це стратегічна гра, де головна мета - якомога довше утримувати спільну фігуру на дошці, уникаючи її виходу за межі дошки або потрапляння на заблоковані клітинки.

## 2. Основні правила

### Початкові умови
1.  **Початкова позиція**: Одна фігура (♛) розміщується випадковим чином на дошці.
2.  **Черги**: Гравці ходять по черзі, рухаючи *ту саму* фігуру.
3.  **Хід**: Гравець обирає напрямок (8 варіантів) та відстань (від 1 до N-1, де N - розмір дошки).
4.  **Перемога**: Гравець, який найдовше залишається на дошці, перемагає.

### Умови поразки
Гравець програє, якщо він:
-   **Вихід за межі дошки**: Робить хід, який виводить фігуру за межі дошки.
-   **Заблокована клітинка**: Потрапляє на заблоковану клітинку (у режимі "Заблоковані клітинки").
-   **Неправильна заява "Ходів немає"**: Натискає кнопку "Ходів немає", коли доступні ходи ще є.

### Умови перемоги
Гравець перемагає, якщо:
-   **Правильна заява "Ходів немає"**: Він натискає кнопку "Ходів немає", і ходів справді не залишилося.
-   **Помилка суперника**: Суперник робить недійсний хід.

## 3. Механіка руху

Фігура рухається як ферзь у шахах: на будь-яку кількість клітинок по горизонталі, вертикалі або діагоналі. На відміну від звичайного ферзя, ця фігура може **перестрибувати** через заблоковані клітинки, але не може на них приземлятися.

### Напрямки руху
Фігура може рухатися у 8 напрямках, відповідно до розкладки цифрової клавіатури:
```
7 8 9
4 ♛ 6
1 2 3
```
-   **7**: Вгору-вліво (↖)
-   **8**: Вгору (↑)
-   **9**: Вгору-вправо (↗)
-   **4**: Вліво (←)
-   **6**: Вправо (→)
-   **1**: Вниз-вліво (↙)
-   **2**: Вниз (↓)
-   **3**: Вниз-вправо (↘)

### Відстань руху
-   **Мінімальна**: 1 клітинка
-   **Максимальна**: N-1 клітинок (де N - розмір дошки). Наприклад, на дошці 5x5 максимальна відстань ходу - 4 клітинки.

### Дійсність ходу
Хід є дійсним, якщо нова позиція:
1.  Знаходиться в межах дошки.
2.  Не є заблокованою клітинкою (у режимі "Заблоковані клітинки").

## 4. Режими гри

### Звичайний режим
-   Усі клітинки залишаються доступними протягом гри.
-   Гра закінчується, тільки коли гравець виводить фігуру за межі дошки.
-   Рекомендовано для початківців.

### Режим заблокованих клітинок
-   Клітинка, з якої було зроблено хід, стає заблокованою та недоступною для майбутніх ходів.
-   Заблоковані клітинки позначаються червоним ✗.
-   Гра закінчується, якщо гравець виходить за межі дошки або потрапляє на заблоковану клітинку.
-   Пропонує більш стратегічний та складний досвід.

## 5. Система підрахунку очок

### Базові очки
-   **+1 до +3 очок** нараховуються за кожен успішний хід, залежно від налаштувань видимості (наприклад, гра з прихованою дошкою дає більше очок).
-   **Бонусні очки** нараховуються за різні дії в грі.
-   **Штрафні очки** даються за "дзеркальні" ходи в режимі "Проти комп'ютера".
-   **Фінальний рахунок** = (Сума всіх очок та бонусів) - Штрафи.

### Бонусні очки
-   **Бонус за відстань (+1)**: За будь-який хід довший за 1 клітинку.
-   **Бонус за розмір дошки**: Відсоток від базового рахунку, розраховується як `(розмір_дошки * розмір_дошки) / 100 * базовий_рахунок`.
-   **Бонус за режим блокування (+1)**: За кожен хід, зроблений у режимі "Заблоковані клітинки".
-   **Бонус за перестрибування (+1)**: За кожну перестрибнуту заблоковану клітинку під час ходу.
-   **Бонус "Ходів немає"**: Дорівнює розміру дошки (наприклад, +5 очок на дошці 5x5) за правильну заяву.
-   **Бонус за завершення гри**: Дорівнює розміру дошки за вибір завершити гру після ситуації "Ходів немає".

### Штрафні очки
-   **Штраф за дзеркальний хід (-2)**: У режимі "Проти комп'ютера", якщо комп'ютер рухається на N клітинок в одному напрямку, а гравець негайно рухається на N або менше клітинок у протилежному напрямку, застосовується штраф. Це запобігає повторюваним ходам туди-сюди. Цей штраф не застосовується в режимі "Заблоковані клітинки".

## 6. Кнопка "Ходів немає"

### Логіка
1.  **Перевірка**: Коли гравець натискає "Ходів немає", система перевіряє, чи існують дійсні ходи з поточної позиції.
2.  **Результат**:
    -   **Ходів немає**: Гравець перемагає.
    -   **Ходи є**: Гравець програє за неправильну заяву.

### Стратегічне використання
Цю кнопку слід використовувати, коли гравець вважає, що фігура заблокована. Це хід з високим ризиком та високою винагородою, який може вирішити гру.

## 7. Розміри дошки

-   **Мінімальний**: 2x2
-   **Максимальний**: 9x9
-   **За замовчуванням**: 3x3
-   **Рекомендований для балансу**: 5x5 пропонує гарне поєднання стратегії та тривалості гри.

## 8. Типи гри

### Проти комп'ютера
-   Гравець змагається проти комп'ютерного ШІ.
-   Ходи комп'ютера визначаються випадковим алгоритмом, що робить його непередбачуваним.
-   Існує 1-секундна затримка перед ходом комп'ютера.

### Локальна гра
-   Два гравці змагаються на одному пристрої, ходячи по черзі.
-   Імена гравців можна налаштувати.

### Онлайн-гра
-   Гравці змагаються через Інтернет.
-   Один гравець створює кімнату, а інший приєднується за допомогою ID кімнати.

## 9. Інтерфейс та візуальні підказки

### Відображення доступних ходів
-   Прапорець у налаштуваннях ("Показувати доступні ходи") вмикає/вимикає видимість усіх можливих ходів.
-   Доступні клітинки для приземлення позначаються крапкою (●), що допомагає у стратегічному плануванні.

### Центральна кнопка керування
-   Відображає поточний вибраний напрямок та відстань.
-   Перетворюється на кнопку підтвердження після вибору повного ходу.
-   Показує останній хід комп'ютера для довідки гравця.

## 10. Стани гри та потік

Гра проходить через кілька станів:
1.  **Початковий стан**: Гра знаходиться в головному меню.
2.  **Вибір режиму гри**: З'являється модальне вікно для вибору між звичайним режимом або режимом "Заблоковані клітинки" (для гри проти комп'ютера).
3.  **Розміщення фігури**: Фігура розміщується випадковим чином на дошці.
4.  **Хід гравця**: Гравець обирає напрямок та відстань.
5.  **Виконання ходу**: Фігура переміщується на нову позицію.
6.  **Перевірка кінця гри**: Система перевіряє умови перемоги/поразки.
7.  **Хід комп'ютера** (якщо застосовно): ШІ обирає та виконує свій хід.
8.  **Стан перемоги/поразки**: З'являється модальне вікно з фінальним рахунком та опціями почати нову гру або повернутися в меню.

## 11. Гарячі клавіші

Гра підтримує повне керування з клавіатури для доступності та швидшої гри.

### Рух
-   **NumPad 7, 8, 9, 4, 6, 1, 2, 3** або **Q, W, E, A, D, Z, X, C** для напрямків.
-   Повторне натискання клавіші напрямку циклічно змінює відстань (1, 2, 3...).

### Дії
-   **Підтвердити хід**: [NumPad 5], [Enter] або [Пробіл].
-   **Заявити "Ходів немає"**: [NumPad .] або [Backspace].

### Налаштування
-   **Перемкнути режим блокування**: [NumPad *] або [B].
-   **Перемкнути видимість дошки**: [NumPad /] або [H].
-   **Збільшити/зменшити розмір дошки**: [NumPad +]/[-] або [=]/[-].

## 12. Технічні деталі для розробників

### Структура даних
-   `board`: Двовимірний масив, що представляє ігрову дошку.
-   `blockedCells`: Масив, що зберігає координати заблокованих клітинок.
-   `currentPlayer`: Вказує на поточного гравця (1 або 2).

### Основні функції
-   `getAllValidMoves()`: Повертає всі можливі ходи з поточної позиції.
-   `hasValidMoves()`: Перевіряє, чи існують дійсні ходи.
-   `processPlayerMove()`: Обробляє введення гравця та переходить до наступного стану.
-   `makeComputerMove()`: Виконує хід ШІ.

### Архітектурні принципи
-   Візуалізація ігрової дошки (компонент `game-board`) є асинхронною та відокремленою від ігрової логіки.
-   Ігрова логіка є самодостатньою і не залежить від DOM або стану рендерингу. Це критично важливо для анімацій та масштабованості.