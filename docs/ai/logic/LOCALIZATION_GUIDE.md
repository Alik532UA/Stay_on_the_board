# Локалізація (i18n) у Stay on the Board

## Як це працює

- Всі тексти інтерфейсу винесені у словники у `svelte-app/src/lib/i18n/uk.js`, `en.js`, `crh.js`, `nl.js`.
- Для перекладу використовується [svelte-i18n](https://github.com/kaisermann/svelte-i18n).
- Зміна мови здійснюється через компонент LanguageSwitcher (кнопки з прапорцями), який доступний у MainMenu, Header, Settings.

## Озвучування ходів (Web Speech API)

- Озвучуються **лише ходи суперника (комп'ютера)**, щоб не відволікати гравця під час його власного ходу.
- Сервіс озвучування інкапсулює логіку роботи з Web Speech API, включаючи асинхронне завантаження списку системних голосів та їх фільтрацію за мовою.
- Доступні голоси автоматично фільтруються за мовою, обраною у налаштуваннях гри (наприклад, для української — лише голоси з lang: 'uk-UA').
- Поруч із перемикачем "Озвучування ходів" є кнопка ⚙️, яка відкриває модальне вікно для вибору голосу.
- У модальному вікні (VoiceSettingsModal.svelte) гравець може прослухати та вибрати будь-який з доступних для даної мови голосів. Вибір зберігається у localStorage.
- Якщо збережений голос недоступний для поточної мови, вибір скидається.
- Явно вказуючи voice для utterance, система гарантує коректне озвучування саме обраним голосом (вирішує проблему "англійського" голосу для українського тексту).

### Ключові компоненти системи

- **A. settingsStore.js** — зберігає обраний голос (selectedVoiceURI) та інші налаштування, синхронізує з localStorage.
- **B. speech.js** — сервіс для роботи з Web Speech API, асинхронно завантажує голоси, фільтрує їх за мовою, озвучує ходи суперника.
- **C. GameControls.svelte** — містить перемикач "Озвучування ходів" та кнопку ⚙️ для відкриття модального вікна вибору голосу.
- **D. VoiceSettingsModal.svelte** — модальне вікно для вибору голосу, дозволяє прослухати кожен голос перед вибором.
- **E. gameStore.js** — викликає speakMove лише для ходів комп'ютера, передаючи обраний голос.

### Керування голосом

- **Автоматичний вибір мови:** система автоматично фільтрує голоси за мовою, обраною у налаштуваннях гри.
- **Вибір голосу:** користувач може вибрати голос для озвучування ходів суперника через модальне вікно.
- **Збереження вибору:** обраний голос зберігається у localStorage та використовується для всіх наступних ігор.
- **Вирішення проблеми з неправильним голосом:** якщо браузер за замовчуванням використовує неправильний голос, явний вибір гарантує коректне озвучування.

## Додавання/оновлення перекладів

1. **Додати новий ключ:**
   - Додайте ключ у всі словники (наприклад, `mainMenu.newFeature: "Новий функціонал"`).
   - Використовуйте у Svelte-компоненті: `{$_('mainMenu.newFeature')}`.

2. **Додати нову мову:**
   - Створіть файл, наприклад, `pl.js` у `svelte-app/src/lib/i18n/`.
   - Скопіюйте структуру з існуючого словника, перекладіть значення.
   - Додайте реєстрацію мови у `svelte-app/src/lib/i18n/index.js`:
     ```js
     import pl from './pl.js';
     register('pl', () => Promise.resolve(pl));
     ```
   - Додайте прапорець і назву у LanguageSwitcher.

3. **Використання у компонентах:**
   - Імпортуйте `{ _ }` з `svelte-i18n`.
   - Використовуйте `{$_('section.key')}` для перекладу.

4. **Додавання нових секцій:**
   - Додавайте секції за аналогією: `mainMenu`, `settings`, `header`, `gameBoard`, `gameControls`, `modal`, тощо.

## Важливо

- Не залишайте статичних текстів у компонентах — все через словники.
- Для accessibility використовуйте локалізовані aria-label.
- LanguageSwitcher — єдиний спосіб зміни мови для користувача. 