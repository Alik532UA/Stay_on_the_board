# Система бонусних балів та фінальний рахунок

## Опис

Після завершення гри фінальний рахунок гравця складається з базових балів за ходи, штрафів та чотирьох типів бонусів. Всі бонуси і штрафи підраховуються лише після завершення гри та відображаються у фінальному екрані.

---

## Типи бонусів і штрафів

1. **Базовий рахунок**
   - Кожен валідний хід = +1 бал.

2. **Бонус за розмір дошки**
   - Формула: `sizeBonus = ceil(baseScore * ((boardSize - 2) * 10%) )`, де boardSize — розмір дошки (наприклад, 3, 4, 5...).
   - Наприклад:
     - 3x3: +10% до базового рахунку
     - 4x4: +20%
     - 5x5: +30%
     - ...
   - Для 2x2 бонусу немає.

3. **Бонус за режим заблокованих клітинок**
   - За кожен хід у режимі "заблокованих клітинок" — +1 бал.

4. **Бонус за кнопку "Ходів немає"**
   - Якщо гравець завершує гру через цю кнопку, додається бонус, що дорівнює розміру дошки (наприклад, 6x6 — +6).

5. **Бонус за перестрибування заблокованих клітин**
   - За кожну заблоковану клітину, яку гравець перестрибнув за один хід, +1 бал.

6. **Штраф за зворотний хід**
   - **-2 бали** нараховується (тобто, віднімається від загального рахунку) за кожен хід, який є точною протилежністю до останнього ходу комп'ютера. Наприклад, якщо комп'ютер походив "вниз на 2", а гравець одразу ж ходить "вгору на 2", він отримує штраф. Цей механізм стимулює гравців шукати нетривіальні шляхи та уникати простих "дзеркальних" відповідей. Загальна сума штрафів відображається на фінальному екрані.

---

## Формула фінального рахунку

```
finalScore = baseScore + sizeBonus + blockModeBonus + noMovesBonus + jumpBonus
// Штрафи вже враховано у baseScore (score)
```

- **baseScore** — кількість валідних ходів з урахуванням штрафів
- **totalPenalty** — сума штрафів за зворотні ходи (відображається окремо)
- **sizeBonus** — бонус за розмір дошки
- **blockModeBonus** — бонус за ходи у режимі блокування
- **noMovesBonus** — бонус за завершення через "Ходів немає"
- **jumpBonus** — бонус за перестрибування заблокованих клітин

---

## Відображення у UI

- Після завершення гри у модальному вікні показується деталізований розрахунок:
  - Базовий рахунок
  - Кожен тип бонусу (якщо він > 0)
  - Сума штрафів (якщо > 0)
  - Підсумковий рахунок

---

## Приклад

Гравець зробив 12 ходів на дошці 4x4, 3 з них у режимі блокування, 1 раз завершив через "Ходів немає", перестрибнув 2 заблоковані клітини, і отримав 2 штрафи за зворотні ходи:

- baseScore = 12 - 4 = 8 (12 ходів, 2 зворотних = -4)
- totalPenalty = 4
- sizeBonus = ceil(8 * 0.2) = 2
- blockModeBonus = 3
- noMovesBonus = 4
- jumpBonus = 2
- **finalScore = 8 + 2 + 3 + 4 + 2 = 19**

---

## Технічна реалізація

- Всі метрики зберігаються у appState (Svelte store):
  - score, movesInBlockMode, jumpedBlockedCells, finishedByNoMovesButton, penaltyPoints
- Фінальний підрахунок виконує функція `calculateFinalScore(state)` у `gameStore.js`.
- Деталізація передається у модальне вікно через поле `scoreDetails`. 