# Архітектурний План Покращення: Separation of Concerns (SoC) - v20

## Частина 1: Комплексний Аудит Коду

### Критерій: SoC (Separation of Concerns)

Аналіз кодової бази показав, наскільки добре розділені відповідальності між станом (State), логікою (Logic) та користувацьким інтерфейсом (UI).

- **Стан (State):**
  - **Сильні сторони:** Архітектура використовує Svelte stores (`gameState`, `appSettingsStore`) як єдине джерело правди (SSoT), що є передовою практикою. Це забезпечує централізоване та передбачуване управління станом. Існування `gameStateMutator` створює чіткий та єдиний API для внесення змін, що запобігає хаотичним мутаціям стану з різних частин додатку.
  - **Слабкі сторони:** На даному етапі значних слабких сторін не виявлено.

- **Логіка (Logic):**
  - **Сильні сторони:** Ігрова логіка інкапсульована в сервісах, таких як `gameLogicService`, що містять чисті функції. Ці функції приймають стан як вхідні дані та повертають результат, не маючи побічних ефектів і не залежачи від UI. Це ідеально для тестування, підтримки та розширення.
  - **Слабкі сторони:** Не виявлено.

- **UI (Користувацький інтерфейс):**
  - **Сильні сторони:** Компоненти Svelte (`BoardWrapperWidget.svelte`) є переважно "дурними", тобто вони лише відображають дані зі сторів і делегують дії користувача сервісам. Використання `derived` сторів (`derivedState.ts`) для обчислення похідних даних (наприклад, `visualPosition`) ще більше ізолює UI від складної бізнес-логіки. Коментарі в коді чітко підкреслюють важливість дотримання цього принципу.
  - **Слабкі сторони:** Не виявлено.

### Загальна Оцінка Поточного Стану Проєкту

**Оцінка: 90/100**

Проєкт має міцну та добре продуману архітектуру з чітким розділенням відповідальностей. Ця оцінка відображає високий рівень зрілості кодової бази та її готовність до масштабування. Існуюча структура є чудовим фундаментом для реалізації нових ігрових режимів, таймерів та системи нагород.

---

## Частина 2: План Покращень для Масштабування

Мета цього плану — підготувати код до майбутніх розширень, мінімізуючи ризики та зберігаючи високу якість архітектури.

### Пріоритезований Список Завдань

| Пріоритет (0-100) | Завдання | Опис    - | ------- |  |
| **100**  | [x] **Створити `gameModeService` для управління логікою режимів**    | **Проблема:** Зараз логіка, специфічна для режимів (Тренування, Локальна гра), може бути розпорошена. **Рішення:** Створити `gameModeService`, який буде відповідати за ініціалізацію та управління станом для кожного режиму гри. Це ізолює логіку режимів і спростить додавання нових (Гра на час, Онлайн-гра). - |
| **95**   | [x] **Винести логіку таймера в окремий `timerService`**| **Проблема:** Логіка таймерів (загальний час на гру, час на хід) буде потрібна в кількох режимах. **Рішення:** Створити `timerService`, який буде керувати створенням, запуском, зупинкою та скиданням таймерів. `gameModeService` буде використовувати цей сервіс для налаштування таймерів згідно з правилами поточного режиму.- |
| **90**   | [x] **Формалізувати структуру стану для ігрових режимів у `gameState`**   | **Проблема:** Потрібно чітко визначити, які поля в `gameState` є специфічними для режимів. **Рішення:** Додати в `gameState` об'єкт `modeState`, де буде зберігатися вся інформація, що стосується поточного режиму (наприклад, `remainingTime`, `turnTimeLimit`). Це уникне забруднення глобального стану.   - |
| **80**   | [x] **Створити `rewardsService` для управління нагородами**| **Проблема:** Логіка перевірки та видачі нагород може стати складною. **Рішення:** Створити `rewardsService`, який буде підписуватися на зміни `gameState` і перевіряти, чи виконані умови для отримання нагород. Це повністю ізолює систему нагород від ігрової логіки.    - |
| **70**   | [x] **Переглянути та задокументументувати події, що впливають на таймер**  | **Проблема:** Таймер повинен зупинятися під час показу модальних вікон. **Рішення:** Провести аудит всіх подій (показ модального вікна, пауза гри) та створити централізований механізм у `timerService`, який буде реагувати на ці події, щоб коректно зупиняти та відновлювати відлік часу.- |
| **50**   | [x] **Провести ревізію існуючих коментарів-попереджень у коді** | **Проблема:** У коді є коментарі, що попереджають про можливі проблеми при рефакторингу. **Рішення:** Систематично переглянути всі такі коментарі. Для кожного з них або провести рефакторинг, щоб усунути ризик, або додати автоматизовані тести, які будуть перевіряти, що логіка не зламалася.- |