# План рефакторингу Modal.svelte

## Мета

Основна мета — провести рефакторинг компонента `Modal.svelte`, щоб він відповідав принципам SOLID, зокрема Принципу єдиної відповідальності (SRP). Наразі `Modal.svelte` є "Божественним компонентом", який відповідає за відображення всіх можливих типів модальних вікон. Рефакторинг перетворить його на універсальну "рамку" (каркас), а специфічний контент буде винесено в окремі компоненти.

## Аналіз існуючих модальних вікон

Пошук виявив наступні компоненти модальних вікон:

- `src/lib/components/Modal.svelte`: Основний, але перевантажений компонент.
- `src/lib/components/GameModeModal.svelte`: Вже є окремим компонентом. Це хороший приклад для наслідування.
- `src/lib/components/FAQModal.svelte`: Також окремий компонент.
- `src/lib/components/VoiceSettingsModal.svelte`: Має власну реалізацію модального вікна, яку потрібно уніфікувати.

## План рефакторингу

### Фаза 1: Створення спеціалізованих компонентів контенту

На цьому етапі ми виносимо весь унікальний контент з `Modal.svelte` в окремі, сфокусовані компоненти.

- [ ] **Створити `ScoreDetailsModal.svelte`**:
    - Перенести всю розмітку та логіку для відображення деталей рахунку (базові очки, бонуси, штрафи, фінальний рахунок) з `Modal.svelte`.
    - Компонент буде отримувати об'єкт `scoreDetails` як пропс.

- [ ] **Створити `ExpertModeModal.svelte`**:
    - Перенести повзунок гучності та пов'язану з ним логіку з `Modal.svelte`.
    - Компонент буде напряму взаємодіяти з `audioService`.

- [ ] **Створити `KeyConflictModal.svelte`**:
    - Перенести контент для вирішення конфліктів гарячих клавіш.

- [ ] **Провести рефакторинг `VoiceSettingsModal.svelte`**:
    - Видалити з компонента розмітку "рамки" модального вікна (`modal-overlay`, `modal-window`, `modal-header`, `modal-footer`).
    - Компонент має містити лише контент налаштувань голосу.
    - Пропс `close` більше не буде потрібен, оскільки закриттям буде керувати основний `Modal.svelte`.

### Фаза 2: Спрощення `modalStore.js`

- [ ] **Оновити стан та функції `modalStore`**:
    - Основна функція `showModal` повинна приймати `component` та `props` для відображення контенту.
    - **Приклад**: `modalStore.showModal({ component: ScoreDetailsModal, props: { scoreDetails: ... }, titleKey: '...' })`
    - Параметри, що стосуються "рамки" (`titleKey`, `buttons`, `closable`), залишаються.

### Фаза 3: Рефакторинг `Modal.svelte` (компонент-рамка)

- [ ] **Видалити специфічний контент з шаблону**:
    - Прибрати всі блоки `{#if $modalState.titleKey === '...'}` та іншу умовну логіку, що відповідає за відображення різних типів контенту.

- [ ] **Використовувати `<svelte:component>` як єдине джерело контенту**:
    - Спростити центральну частину модального вікна до такого вигляду:
      ```svelte
      {#if $modalState.component}
        <svelte:component this={$modalState.component} {...$modalState.props} />
      {:else if $modalState.contentKey}
        <p>{$_($modalState.contentKey, { values: $modalState.content as any })}</p>
      {:else if typeof $modalState.content === 'string'}
        <p>{@html $modalState.content}</p>
      {/if}
      ```

- [ ] **Видалити специфічну логіку зі скрипта**:
    - Перенести логіку `expertVolume`, `isCompactScoreMode` і т.д. у відповідні спеціалізовані компоненти.
    - Скрипт `Modal.svelte` має містити лише логіку, що стосується самої "рамки": відкриття/закриття, керування фокусом, обробка контексту гарячих клавіш.

### Фаза 4: Оновлення місць виклику модальних вікон

- [ ] **Знайти всі виклики `modalStore.showModal`** у проекті.
- [ ] **Оновити кожен виклик** для використання нового, компонентного підходу.
- [ ] **Провести рефакторинг виклику `VoiceSettingsModal.svelte`**:
    - Знайти місця, де використовується `VoiceSettingsModal.svelte` (наприклад, `src/routes/game/+layout.svelte` та `VoiceSettingsModalWrapper.svelte`).
    - Замінити поточну логіку на виклик `modalStore.showModal({ component: VoiceSettingsModal, ... })`.
    - Видалити старий стор `uiStore.js` та `VoiceSettingsModalWrapper.svelte`, якщо вони більше не потрібні.

### Фаза 5: Фіналізація

- [ ] **Переглянути та видалити** будь-який невикористовуваний код, що залишився після рефакторингу.
- [ ] **Переконатися, що всі існуючі тести проходять**.
- [ ] **Запустити `npm run check`** і виправити всі можливі помилки та попередження.
