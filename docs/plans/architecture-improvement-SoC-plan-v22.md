# План покращення архітектури: Separation of Concerns (SoC) - v22

**Дата:** 2025-08-25

## Частина 1: Комплексний аудит коду

### Критерій: SoC (Separation of Concerns)

Наскільки добре розділені відповідальності (стан, логіка, UI)?

**Аналіз:**

Проєкт демонструє зрілу та добре продуману архітектуру, що базується на ключових принципах, таких як Єдине Джерело Правди (SSoT) та Односпрямований Потік Даних (UDF).

1.  **Стан (State):** Відповідальність за стан чітко визначена. `gameState` є центральним сховищем для всієї ігрової логіки, тоді як `settingsStore` та `uiStore` керують відповідними частинами стану. Це мінімізує дублювання та забезпечує передбачуваність.
2.  **Логіка (Logic):** Ігрова логіка ізольована в сервісах, зокрема в `gameLogicService`, який містить чисті функції. Це робить логіку легкою для тестування та незалежною від UI. `GameOrchestrator` слугує координатором, що є правильним підходом, хоча він має потенціал до розростання.
3.  **UI (Components):** Компоненти є "тонкими" і переважно відповідають за візуалізацію стану, отриманого зі сторів. Важливим архітектурним рішенням є використання `animationStore` як проміжної ланки між логікою гри (`gameState.moveQueue`) та візуалізацією на дошці. Це повністю відповідає вимозі, щоб логіка не залежала від візуалізації.

**Поточний стан відповідає надважливим завданням:**
- Візуалізація дошки (`game-board`) повністю відокремлена від логіки та `center-info` завдяки `animationStore`.
- `center-info` та ігрова логіка не мають жодної інформації про візуалізацію.

### Оцінка: 90/100

**Обґрунтування:** Архітектура є міцною, добре документованою та готовою до масштабування. 10 балів знято за потенційні ризики, пов'язані з централізацією логіки в `GameOrchestrator` та зростаючою складністю `gameState`, що може ускладнити додавання нових функцій у майбутньому.

---

## Частина 2: План покращення

Мета цього плану — проактивно вирішити потенційні проблеми та підготувати кодову базу до запланованого розширення функціоналу.

### Проблеми та завдання для покращення

| Пріоритет (0-100) | Проблема | Завдання для покращення |
| :--- | :--- | :--- |
| **95** | **Централізація в `GameOrchestrator`** | `GameOrchestrator` може стати монолітом при додаванні нової логіки режимів та таймерів. |
| **85** | **Монолітний `gameState`** | Додавання нових сутностей (таймери, нагороди, онлайн-сесії) перевантажить існуючий стор стану. |
| **75** | **Неявне керування побічними ефектами** | Побічні ефекти (аудіо, навігація) зараз керуються в `GameOrchestrator`, що ускладнює його. |
| **60** | **Неявні залежності в сервісах** | Деякі чисті функції в `gameLogicService` мають залежність від `settingsStore` через `get()`, що трохи порушує їх чистоту. |

### Детальний план дій

- [x] **1. Декомпозиція `GameOrchestrator` (Пріоритет: 95)**
    - [x] Створити `GameModeService`, який буде відповідати за логіку, специфічну для кожного режиму гри (Тренування, Гра на час, Локальна гра).
    - [x] Створити `TimerService` для інкапсуляції всієї логіки керування таймерами (загальний таймер, таймер ходу).
    - [x] `GameOrchestrator` має делегувати виклики відповідним сервісам, залишаючись лише координатором верхнього рівня.

- [x] **2. Грануляція `gameState` (Пріоритет: 85)**
    - [x] Створити окремий `timerStore` для зберігання стану таймерів (наприклад, `remainingTime`, `turnTimeLeft`).
    - [ ] Створити `gameModeStore` для зберігання стану, специфічного для поточного режиму гри. (Не виконано в рамках цього завдання)
    - [ ] В майбутньому, створити `rewardsStore` та `onlineSessionStore` для відповідних функцій. (Завдання на майбутнє)
    - [x] `gameState` повинен містити лише базовий стан гри (дошка, позиція гравця, рахунок).

- [x] **3. Ізоляція побічних ефектів (Пріоритет: 75)**
    - [x] Створити `SideEffectService` (або використати існуючі `audioService`, `navigationService` більш явно).
    - [ ] Перенести всю логіку, що не стосується стану гри (відтворення звуків, переходи між сторінками), з `GameOrchestrator` у відповідні сервіси. (Частково виконано створенням сервісу)

- [x] **4. Підвищення чистоти функцій (Пріоритет: 60)**
    - [x] Провести рефакторинг функцій в `gameLogicService`, щоб вони отримували необхідні налаштування як параметри, а не через `get(settingsStore)`. Це покращить їхню передбачуваність та полегшить тестування.