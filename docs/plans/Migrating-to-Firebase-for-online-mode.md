# –ü–ª–∞–Ω: –ú—ñ–≥—Ä–∞—Ü—ñ—è –Ω–∞ Firebase –¥–ª—è –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º—É

**–°—Ç–∞—Ç—É—Å:** –î–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è
**–î–∞—Ç–∞:** 2025-08-10

## üéØ –ú–µ—Ç–∞

–ü–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–∏—Ç–∏ –∑–∞—Å—Ç–∞—Ä—ñ–ª—É –ª–æ–≥—ñ–∫—É –æ–Ω–ª–∞–π–Ω-–≥—Ä–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ P2P (Y.js, WebRTC) —Ç–∞ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –Ω–æ–≤–µ, –Ω–∞–¥—ñ–π–Ω–µ —Ä—ñ—à–µ–Ω–Ω—è –Ω–∞ –±–∞–∑—ñ Firebase (Firestore) –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó —ñ–≥—Ä–æ–≤–∏—Ö —Å–µ—Å—ñ–π —Ç–∞ –≤–µ–¥–µ–Ω–Ω—è –≥–ª–æ–±–∞–ª—å–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤.

---

### –§–∞–∑–∞ 1: –û—á–∏—â–µ–Ω–Ω—è –≤—ñ–¥ –∑–∞—Å—Ç–∞—Ä—ñ–ª–æ—ó –ª–æ–≥—ñ–∫–∏ P2P

**–ú–µ—Ç–∞:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —á–∏—Å—Ç—É –∫–æ–¥–æ–≤—É –±–∞–∑—É –ø–µ—Ä–µ–¥ –≤–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è–º –Ω–æ–≤–æ—ó –ª–æ–≥—ñ–∫–∏, —â–æ–± —É–Ω–∏–∫–Ω—É—Ç–∏ –ø–ª—É—Ç–∞–Ω–∏–Ω–∏ —Ç–∞ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—ñ–≤.

-   [x] **–í–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π:**
    -   [x] –í–∏–∫–æ–Ω–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –¥–ª—è –≤–∏–¥–∞–ª–µ–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ P2P, –∑ –≤–∞—à–æ–≥–æ `package.json`.
        ```bash
        npm uninstall yjs y-webrtc socket.io-client
        ```

-   [x] **–í–∏–¥–∞–ª–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤:**
    -   [x] –í–∏–¥–∞–ª—ñ—Ç—å —Ñ–∞–π–ª `src/lib/online/yjs.js`.
    -   [x] –í–∏–¥–∞–ª—ñ—Ç—å —Ñ–∞–π–ª `src/lib/online/socket.js`.
    -   [x] –í–∏–¥–∞–ª—ñ—Ç—å —Ñ–∞–π–ª `src/lib/stores/yjsGameStore.js`.

-   [x] **–ü–æ—à—É–∫ —Ç–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –∑–∞–ª–∏—à–∫—ñ–≤:**
    -   [x] –í–∏–∫–æ–Ω–∞–π—Ç–µ –≥–ª–æ–±–∞–ª—å–Ω–∏–π –ø–æ—à—É–∫ –ø–æ –ø—Ä–æ—î–∫—Ç—É –∑–∞ –∫–ª—é—á–æ–≤–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ `yjs`, `y-webrtc`, `socket.io`, `WebRTC`, `PeerJS`.
    -   [x] –í–∏–¥–∞–ª—ñ—Ç—å —É—Å—ñ —ñ–º–ø–æ—Ä—Ç–∏ —Ç–∞ –∑–≥–∞–¥–∫–∏ —Ü–∏—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥—ñ–π –∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∑ `OnlineMenu.svelte` –∞–±–æ `JoinRoom.svelte`, —è–∫—â–æ –≤–æ–Ω–∏ —Ç–∞–º –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—è).

---

### –§–∞–∑–∞ 2: –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è Firebase

**–ú–µ—Ç–∞:** –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –ø—Ä–æ—î–∫—Ç Firebase —Ç–∞ —ñ–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –π–æ–≥–æ —É SvelteKit –¥–æ–¥–∞—Ç–æ–∫.

-   [ ] **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø—Ä–æ—î–∫—Ç—É Firebase:**
    -   [ ] –ü–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ [–∫–æ–Ω—Å–æ–ª—ñ Firebase](https://console.firebase.google.com/).
    -   [ ] –°—Ç–≤–æ—Ä—ñ—Ç—å –Ω–æ–≤–∏–π –ø—Ä–æ—î–∫—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, "Stay on the Board").
    -   [ ] –£ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –ø—Ä–æ—î–∫—Ç—É –¥–æ–¥–∞–π—Ç–µ –Ω–æ–≤–∏–π –≤–µ–±-–¥–æ–¥–∞—Ç–æ–∫ —Ç–∞ —Å–∫–æ–ø—ñ—é–π—Ç–µ –æ–±'—î–∫—Ç –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó (`firebaseConfig`).

-   [ ] **–í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π:**
    -   [ ] –í—Å—Ç–∞–Ω–æ–≤—ñ—Ç—å –æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π SDK Firebase:
        ```bash
        npm install firebase
        ```

-   [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ (–¥–ª—è –±–µ–∑–ø–µ–∫–∏):**
    -   [ ] –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env` —É –∫–æ—Ä–µ–Ω—ñ –ø—Ä–æ—î–∫—Ç—É (—è–∫—â–æ –π–æ–≥–æ –Ω–µ–º–∞—î).
    -   [ ] –î–æ–¥–∞–π—Ç–µ –≤–∞—à—ñ –∫–ª—é—á—ñ –∑ `firebaseConfig` —É `.env` –∑ –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º `VITE_`:
        ```env
        VITE_FIREBASE_API_KEY="AIza..."
        VITE_FIREBASE_AUTH_DOMAIN="your-project.firebaseapp.com"
        VITE_FIREBASE_PROJECT_ID="your-project-id"
        VITE_FIREBASE_STORAGE_BUCKET="your-project.appspot.com"
        VITE_FIREBASE_MESSAGING_SENDER_ID="..."
        VITE_FIREBASE_APP_ID="..."
        ```

-   [ ] **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Firebase:**
    -   [ ] –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `src/lib/services/firebaseService.ts`.
    -   [ ] –î–æ–¥–∞–π—Ç–µ –∫–æ–¥ –¥–ª—è —ñ–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó Firebase, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞:
        ```typescript
        // src/lib/services/firebaseService.ts
        import { initializeApp } from 'firebase/app';
        import { getFirestore } from 'firebase/firestore';

        const firebaseConfig = {
          apiKey: import.meta.env.VITE_FIREBASE_API_KEY,
          authDomain: import.meta.env.VITE_FIREBASE_AUTH_DOMAIN,
          projectId: import.meta.env.VITE_FIREBASE_PROJECT_ID,
          storageBucket: import.meta.env.VITE_FIREBASE_STORAGE_BUCKET,
          messagingSenderId: import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID,
          appId: import.meta.env.VITE_FIREBASE_APP_ID,
        };

        const app = initializeApp(firebaseConfig);
        export const db = getFirestore(app);
        ```

-   [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö —Ç–∞ –ø—Ä–∞–≤–∏–ª –±–µ–∑–ø–µ–∫–∏:**
    -   [ ] –£ –∫–æ–Ω—Å–æ–ª—ñ Firebase –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ —Ä–æ–∑–¥—ñ–ª—É **Firestore Database** —Ç–∞ —Å—Ç–≤–æ—Ä—ñ—Ç—å –±–∞–∑—É –¥–∞–Ω–∏—Ö.
    -   [ ] –ü–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É **Rules** —Ç–∞ –∑–∞–º—ñ–Ω—ñ—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –Ω–∞ –Ω–∞—Å—Ç—É–ø–Ω—ñ (–¥–ª—è –ø–æ—á–∞—Ç–∫—É):
        ```
        rules_version = '2';
        service cloud.firestore {
          match /databases/{database}/documents {
            // –Ü–≥—Ä–æ–≤—ñ —Å–µ—Å—ñ—ó: –±—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏, –∞–ª–µ —á–∏—Ç–∞—Ç–∏/–ø–∏—Å–∞—Ç–∏ –º–æ–∂–µ –ª–∏—à–µ —É—á–∞—Å–Ω–∏–∫
            match /game_sessions/{sessionId} {
              allow read, write: if request.auth != null; // TODO: –î–æ–¥–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –Ω–∞ —É—á–∞—Å–Ω–∏–∫–∞ –≥—Ä–∏
            }
            // –¢–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤: –±—É–¥—å-—Ö—Ç–æ –º–æ–∂–µ —á–∏—Ç–∞—Ç–∏, –∞–ª–µ –ø–∏—Å–∞—Ç–∏ –º–æ–∂–µ –ª–∏—à–µ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á
            match /leaderboard/{scoreId} {
              allow read: if true;
              allow write: if request.auth != null;
            }
          }
        }
        ```

---

### –§–∞–∑–∞ 3: –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª–æ–≥—ñ–∫–∏ –æ–Ω–ª–∞–π–Ω-–≥—Ä–∏

**–ú–µ—Ç–∞:** –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–µ—Ä–≤—ñ—Å–∏ –¥–ª—è –∫–µ—Ä—É–≤–∞–Ω–Ω—è —ñ–≥—Ä–æ–≤–∏–º–∏ —Å–µ—Å—ñ—è–º–∏ —Ç–∞ —Ç–∞–±–ª–∏—Ü–µ—é –ª—ñ–¥–µ—Ä—ñ–≤.

-   [ ] **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É –¥–ª—è –æ–Ω–ª–∞–π–Ω-–≥—Ä–∏:**
    -   [ ] –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `src/lib/services/onlineGameService.ts`.
    -   [ ] –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –≤ –Ω—å–æ–º—É –Ω–∞—Å—Ç—É–ø–Ω—ñ –º–µ—Ç–æ–¥–∏:
        ```typescript
        import { doc, setDoc, onSnapshot, updateDoc } from 'firebase/firestore';
        import { db } from './firebaseService';
        import { gameState } from '$lib/stores/gameState'; // –ü—Ä–∏–∫–ª–∞–¥

        export const onlineGameService = {
          /** –°—Ç–≤–æ—Ä—é—î –Ω–æ–≤—É —ñ–≥—Ä–æ–≤—É –∫—ñ–º–Ω–∞—Ç—É –≤ Firestore */
          createRoom: async (roomId: string) => {
            const gameSessionRef = doc(db, 'game_sessions', roomId);
            await setDoc(gameSessionRef, {
              // –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Å—Ç–∞–Ω –≥—Ä–∏
              ...get(gameState),
              players: [], // –ì—Ä–∞–≤—Ü—ñ –±—É–¥—É—Ç—å –¥–æ–¥–∞–≤–∞—Ç–∏—Å—è –ø—Ä–∏ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—ñ
              createdAt: new Date(),
            });
          },

          /** –ü—ñ–¥–ø–∏—Å—É—î—Ç—å—Å—è –Ω–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–≥—Ä–æ–≤–æ—ó —Å–µ—Å—ñ—ó */
          listenForUpdates: (roomId: string, callback: (data: any) => void) => {
            const gameSessionRef = doc(db, 'game_sessions', roomId);
            return onSnapshot(gameSessionRef, (doc) => {
              callback(doc.data());
            });
          },

          /** –ù–∞–¥—Å–∏–ª–∞—î —Ö—ñ–¥ –≥—Ä–∞–≤—Ü—è –≤ Firestore */
          sendMove: async (roomId: string, moveData: any) => {
            const gameSessionRef = doc(db, 'game_sessions', roomId);
            await updateDoc(gameSessionRef, {
              // –û–Ω–æ–≤–ª—é—î–º–æ –ª–∏—à–µ —Ç—ñ –ø–æ–ª—è, —â–æ –∑–º—ñ–Ω–∏–ª–∏—Å—è
              ...moveData
            });
          },
        };
        ```

-   [ ] **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Å–µ—Ä–≤—ñ—Å—É –¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ –ª—ñ–¥–µ—Ä—ñ–≤:**
    -   [ ] –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `src/lib/services/leaderboardService.ts`.
    -   [ ] –†–µ–∞–ª—ñ–∑—É–π—Ç–µ –º–µ—Ç–æ–¥–∏ –¥–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –ª—ñ–¥–µ—Ä—ñ–≤.

-   [ ] **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ UI:**
    -   [ ] –û–Ω–æ–≤—ñ—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ `OnlineMenu.svelte`, `JoinRoom.svelte` —Ç–∞ `WaitingForPlayer.svelte`, —â–æ–± –≤–æ–Ω–∏ –≤–∏–∫–ª–∏–∫–∞–ª–∏ –º–µ—Ç–æ–¥–∏ –∑ `onlineGameService`.
    -   [ ] –£ `gameOrchestrator` –∞–±–æ –≤ –Ω–æ–≤–æ–º—É `OnlineGameMode` –¥–æ–¥–∞–π—Ç–µ –ª–æ–≥—ñ–∫—É, —è–∫–∞ –±—É–¥–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `onlineGameService.listenForUpdates` –ø—Ä–∏ –≤—Ö–æ–¥—ñ –≤ –∫—ñ–º–Ω–∞—Ç—É —Ç–∞ –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–∏–π `gameState` –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–Ω–∏—Ö –∑ Firestore.
    -   [ ] –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ñ –æ–Ω–ª–∞–π–Ω-–≥—Ä–∏ –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ `leaderboardService.addScore()`.

---

### –§–∞–∑–∞ 4: –î–µ–ø–ª–æ–π —Ç–∞ —Ñ—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è

-   [ ] **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è GitHub Secrets:**
    -   [ ] –£ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö –≤–∞—à–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—é –Ω–∞ GitHub –ø–µ—Ä–µ–π–¥—ñ—Ç—å –¥–æ `Secrets and variables` -> `Actions`.
    -   [ ] –î–æ–¥–∞–π—Ç–µ –≤—Å—ñ –≤–∞—à—ñ –∑–º—ñ–Ω–Ω—ñ –∑ —Ñ–∞–π–ª—É `.env` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `VITE_FIREBASE_API_KEY`) —è–∫ —Å–µ–∫—Ä–µ—Ç–∏.

-   [ ] **–û–Ω–æ–≤–ª–µ–Ω–Ω—è GitHub Actions Workflow:**
    -   [ ] –£ –≤–∞—à–æ–º—É —Ñ–∞–π–ª—ñ `.github/workflows/deploy.yml` (–∞–±–æ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–æ–º—É), –ø–µ—Ä–µ–¥ –∫—Ä–æ–∫–æ–º `npm run build`, –¥–æ–¥–∞–π—Ç–µ –∫—Ä–æ–∫ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ñ–∞–π–ª—É `.env` –∑ —Å–µ–∫—Ä–µ—Ç—ñ–≤:
        ```yaml
        - name: Create .env file
          run: |
            echo VITE_FIREBASE_API_KEY=${{ secrets.VITE_FIREBASE_API_KEY }} >> .env
            echo VITE_FIREBASE_AUTH_DOMAIN=${{ secrets.VITE_FIREBASE_AUTH_DOMAIN }} >> .env
            # ... —ñ —Ç–∞–∫ –¥–∞–ª—ñ –¥–ª—è –≤—Å—ñ—Ö –∫–ª—é—á—ñ–≤
        ```

-   [ ] **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è:**
    -   [ ] –ü—Ä–æ–≤–µ–¥—ñ—Ç—å –ø–æ–≤–Ω–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º—É, –≤—ñ–¥–∫—Ä–∏–≤—à–∏ –≥—Ä—É —É –¥–≤–æ—Ö —Ä—ñ–∑–Ω–∏—Ö –±—Ä–∞—É–∑–µ—Ä–∞—Ö.
    -   [ ] –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Ç–∞–±–ª–∏—Ü—è –ª—ñ–¥–µ—Ä—ñ–≤ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è.
    -   [ ] –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∞ –Ω–∞ GitHub Pages –≤–µ—Ä—Å—ñ—è –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ.