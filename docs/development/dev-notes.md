---
last-reviewed: 2025-01-27
---

# Тип: Нотатки
# Статус: Актуально
# Назва: Нотатки для розробників Stay on the Board
# Мета: Зібрати ключові технічні рішення, патерни, поради та best practices для розробників проєкту.
# Опис: Документ містить важливі нотатки щодо анімацій, асинхронності, SVG-іконок, утиліт для розробки та особливостей роботи з SvelteKit у Stay on the Board.

**Пов'язані документи:**
- [Архітектура проєкту](../ARCHITECTURE.md)
- [AI Assistant Guidelines](../project/ai-assistant-guidelines.md)
- [Onboarding для розробників](../ONBOARDING.md)

# Нотатки для розробників

Цей документ містить важливі нотатки щодо особливостей розробки проєкту "Stay on the Board".

## Архітектурні рішення та патерни

### 1. Анімація руху ферзя (`animate:flip`)

**Проблема:** Необхідно було реалізувати плавну анімацію руху фігури по дошці.

**Рішення:** Використано вбудовану директиву Svelte `animate:flip`.

**Ключові вимоги для правильної роботи:**
1.  Елемент, до якого застосовується `animate:flip`, має бути **єдиним прямим нащадком** ключованого блоку `{#each ...}`.
2.  Анімація відбувається, коли елементи всередині `{#each}` змінюють свою позицію або порядок.

**Фінальна реалізація (`GameBoard.svelte`):**
Фігура рендериться **всередині** клітинки `.board-cell`. Щоб задовольнити вимоги `animate:flip`, ми обертаємо SVG фігури в `div`, який, у свою чергу, обернутий в `{#each}` з одного елемента:

```html
<!-- Всередині циклу, що рендерить клітинки -->
{#if rowIdx === playerRow && colIdx === playerCol}
  {#each [{ id: 'piece' }] as item (item.id)}
     <div animate:flip={{ duration: 600, easing: quintOut }}>
       <SvgIcons name="piece" />
     </div>
  {/each}
{/if}
```
**Чому цей підхід працює:**
*   Ферзь залишається частиною клітинки, що вирішує проблеми з позиціонуванням та видимістю.
*   Структура `{#each}` з єдиним дочірнім `div` повністю відповідає вимогам Svelte для `animate:flip`.

### 2. Покрокова анімація (Гравець -> VirtualPlayer)

**Проблема:** При швидкому оновленні стану (хід гравця, потім одразу хід VirtualPlayer) Svelte рендерив лише кінцевий результат, пропускаючи анімацію ходу гравця.

**Рішення:** Введено асинхронність між логічним ходом гравця та логічним ходом VirtualPlayer.

**Фінальна реалізація (`gameStore.js`):**
Функція `confirmMove` є асинхронною. Після оновлення стану для ходу гравця ми робимо мікро-паузу за допомогою `await`, щоб дати Svelte час на рендеринг проміжного стану.

```javascript
// svelte-app/src/lib/stores/gameStore.js

export async function confirmMove() {
  // ... логіка перевірки ходу ...

  // 1. Оновлюємо стан для ходу гравця
  appState.update(s => {
    // ...
    return { ...s, currentPlayer: 2 };
  });

  // 2. Чекаємо наступного "тіку" event loop, щоб Svelte відрендерив хід гравця
  await new Promise(resolve => setTimeout(resolve, 10));

  // 3. Викликаємо хід VirtualPlayer
  if (state.gameMode === 'vsVirtualPlayer') {
    makeVirtualPlayerMove();
  }
}
```

### 3. Централізація SVG-іконок

**Проблема:** Іконки були вбудовані (inline) у різних компонентах, що ускладнювало їх підтримку та зміну стилів.

**Рішення:** Усі статичні SVG-іконки винесено в єдиний компонент `SvgIcons.svelte`.

**Правила використання:**
*   Для додавання нової іконки, її слід додати в `SvgIcons.svelte` під унікальним ім'ям.
*   Усі іконки повинні використовувати `fill="currentColor"`, щоб їх колір залежав від CSS-властивості `color` батьківського елемента і реагував на зміну теми.
*   Розмір іконки задається через CSS для батьківського елемента або безпосередньо для `svg` всередині нього.

## Утиліти для розробки

### Кнопка "Очистити кеш"

- **Розташування:** Верхня панель на ігровому екрані, поруч із кнопкою "Головне меню".
- **Призначення:** Кнопка дозволяє швидко очистити `localStorage`, `sessionStorage` та `cookies`, а потім перезавантажити сторінку. Це корисно для тестування "чистого" старту гри або скидання збережених налаштувань.
- **Умова видимості:** Ця кнопка є **виключно інструментом для розробки**. Вона огорнута в умовний блок `{#if import.meta.env.DEV}` у компоненті `GameBoard.svelte` і **не буде включена у фінальну production-збірку**. 