commit ee637ba2fb19151dbfee3018950f913829958cb7
Author: Alik Zapolnov <174180213+Alik532UA@users.noreply.github.com>
Date:   Tue Dec 9 22:01:18 2025 +0200

    feat: Architecture v31 - Phase 5 (Firebase), Phase 8 (Timers) & TS Fixes
    
    - Phase 5: Added FirebaseService & FirebaseGameStateSync
    
    - Phase 8: Consolidated timers, removed dead TimerService.ts
    
    - Phase 7: Analyzed UI stores (no merge needed)
    
    - TS Fixes: Fixed 36 errors (WidgetId, ColumnStyleMode, BoardState)
    
    - Verified: npm run check passes with 0 errors

diff --git a/docs/plans/architecture-improvement-plan-v31.md b/docs/plans/architecture-improvement-plan-v31.md
index 269878b..de9b619 100644
--- a/docs/plans/architecture-improvement-plan-v31.md
+++ b/docs/plans/architecture-improvement-plan-v31.md
@@ -331,30 +331,38 @@ NOTE: We do NOT update playerToUpdate.score here anymore.
 
 ---
 
-### –§–∞–∑–∞ 7: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (–Ω–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)
+### –§–∞–∑–∞ 7: –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ (—á–∞—Å—Ç–∫–æ–≤–æ ‚úÖ)
 
-- [ ] **7.1. –†–æ–∑–±–∏—Ç—Ç—è `Modal.svelte` (29KB)**
+> [!NOTE]
+> –ó–∞–≤–¥–∞–Ω–Ω—è 7.1 —Ç–∞ 7.2 –≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ —è–∫ —Ç–µ—Ö–Ω—ñ—á–Ω–∏–π –±–æ—Ä–≥ ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è –≤–µ–ª–∏–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ —î —Ä–∏–∑–∏–∫–æ–≤–∞–Ω–∏–º —ñ –ø–æ—Ç—Ä–µ–±—É—î –æ–∫—Ä–µ–º–æ–≥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è.
+
+- [ ] **7.1. –†–æ–∑–±–∏—Ç—Ç—è `Modal.svelte` (991 —Ä—è–¥–∫—ñ–≤)** ‚Äî *–≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ*
   - [ ] –í–∏–¥—ñ–ª–∏—Ç–∏ `ModalHeader.svelte`
   - [ ] –í–∏–¥—ñ–ª–∏—Ç–∏ `ModalFooter.svelte`
   - [ ] –í–∏–¥—ñ–ª–∏—Ç–∏ –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω—ñ –ø—ñ–¥–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
 
-- [ ] **7.2. –†–æ–∑–±–∏—Ç—Ç—è `MainMenu.svelte` (19KB)**
+- [ ] **7.2. –†–æ–∑–±–∏—Ç—Ç—è `MainMenu.svelte` (465 —Ä—è–¥–∫—ñ–≤)** ‚Äî *–≤—ñ–¥–∫–ª–∞–¥–µ–Ω–æ*
   - [ ] –í–∏–¥—ñ–ª–∏—Ç–∏ `MenuSection.svelte`
   - [ ] –í–∏–¥—ñ–ª–∏—Ç–∏ `MenuButton.svelte`
 
-- [ ] **7.3. –ö–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è UI stores**
-  - [ ] –û–±'—î–¥–Ω–∞—Ç–∏ `uiStateStore` —Ç–∞ `uiEffectsStore` (—è–∫—â–æ –¥–æ—Ä–µ—á–Ω–æ)
+- [x] **7.3. –ö–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è UI stores** ‚úÖ
+  - [x] –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ `uiStateStore.ts` (68 —Ä—è–¥–∫—ñ–≤) ‚Äî —á–∏—Å—Ç–∏–π store –¥–∞–Ω–∏—Ö
+  - [x] –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ `uiEffectsStore.ts` (48 —Ä—è–¥–∫—ñ–≤) ‚Äî –ø–æ–±—ñ—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏ (—Ç–∞–π–º–µ—Ä–∏)
+  - [x] **–í–∏—Å–Ω–æ–≤–æ–∫: –æ–±'—î–¥–Ω–∞–Ω–Ω—è –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–µ** ‚Äî stores –º–∞—é—Ç—å —á—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª–µ–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ (SSoT + SoC)
 
 ---
 
-### –§–∞–∑–∞ 8: –ö–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞–π–º–µ—Ä—ñ–≤ (–Ω–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç)
-
-- [ ] **8.1. –ê–Ω–∞–ª—ñ–∑ —Ç–∞–π–º–µ—Ä—ñ–≤**
-  - [ ] –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ `timeService.ts`, `TimerService.ts`, `timerStore.ts`
-  - [ ] –í–∏–∑–Ω–∞—á–∏—Ç–∏ —á–∏ —î –¥—É–±–ª—é–≤–∞–Ω–Ω—è
-
-- [ ] **8.2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)**
-  - [ ] –û–±'—î–¥–Ω–∞—Ç–∏ –∞–±–æ —á—ñ—Ç–∫–æ —Ä–æ–∑–¥—ñ–ª–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–æ—Å—Ç—ñ
+### –§–∞–∑–∞ 8: –ö–æ–Ω—Å–æ–ª—ñ–¥–∞—Ü—ñ—è —Ç–∞–π–º–µ—Ä—ñ–≤ ‚úÖ
+- [x] –í–∏–¥–∞–ª–∏—Ç–∏ `TimerService.ts` (dead code) ‚úÖ
+- [x] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —â–æ `timeService.ts` –ø—Ä–∞—Ü—é—î –∫–æ—Ä–µ–∫—Ç–Ω–æ ‚úÖ
+
+### –î–æ–¥–∞—Ç–∫–æ–≤–æ: –û—á–∏—â–µ–Ω–Ω—è —Ç–µ—Ö–Ω—ñ—á–Ω–æ–≥–æ –±–æ—Ä–≥—É ‚úÖ
+- [x] **–í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ 36 —ñ—Å–Ω—É—é—á–∏—Ö TypeScript –ø–æ–º–∏–ª–æ–∫**
+  - [x] –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—é `WidgetId` —É –≤—Å—ñ—Ö —Ñ–∞–π–ª–∞—Ö page.svelte (local, timed, training, virtual-player)
+  - [x] –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ –∑–∞—Å—Ç–∞—Ä—ñ–ª–µ –∑–Ω–∞—á–µ–Ω–Ω—è `'editing'` –Ω–∞ `'flexible'` –¥–ª—è `ColumnStyleMode`
+  - [x] –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ —Ç–∏–ø `direction` —É `BoardState` –∑ `string` –Ω–∞ `MoveDirectionType`
+  - [x] –î–æ–¥–∞–Ω–æ —Å—É–≤–æ—Ä—É —Ç–∏–ø—ñ–∑–∞—Ü—ñ—é –¥–ª—è `VoiceSettingsModal`
+  - [x] **–†–µ–∑—É–ª—å—Ç–∞—Ç:** `npm run check` –ø–æ–≤–µ—Ä—Ç–∞—î **0 –ø–æ–º–∏–ª–æ–∫**! üéâ
 
 ---
 
diff --git a/src/lib/components/DraggableColumns.svelte b/src/lib/components/DraggableColumns.svelte
index a02b7b0..721e544 100644
--- a/src/lib/components/DraggableColumns.svelte
+++ b/src/lib/components/DraggableColumns.svelte
@@ -1,18 +1,22 @@
 <script lang="ts">
-  import { createEventDispatcher, onMount, tick } from 'svelte';
-  import { fade } from 'svelte/transition';
-  import { slide } from 'svelte/transition';
-  import { columnStyleMode } from '$lib/stores/columnStyleStore';
-  import { _ } from 'svelte-i18n';
-  import { layoutUpdateStore } from '$lib/stores/layoutUpdateStore';
+  import { createEventDispatcher, onMount, tick } from "svelte";
+  import { fade } from "svelte/transition";
+  import { slide } from "svelte/transition";
+  import { columnStyleMode } from "$lib/stores/columnStyleStore";
+  import { _ } from "svelte-i18n";
+  import { layoutUpdateStore } from "$lib/stores/layoutUpdateStore";
 
-  export let columns: { id: string, label: string, items: { id: string, label: string, props?: any }[] }[];
-  export let itemContent: (item: any) => any = item => item.label;
-  export let class_name = '';
+  export let columns: {
+    id: string;
+    label: string;
+    items: { id: string; label: string; props?: any }[];
+  }[];
+  export let itemContent: (item: any) => any = (item) => item.label;
+  export let class_name = "";
 
   const dispatch = createEventDispatcher();
 
-  let dragging: { id: string, label: string } | null = null;
+  let dragging: { id: string; label: string } | null = null;
   let dragSourceCol: string | null = null;
   let dragX = 0;
   let dragY = 0;
@@ -22,7 +26,7 @@
   let colRefs: HTMLUListElement[] = [];
   let isHorizontalLayout = true;
   let containerRef: HTMLDivElement;
-  let marginTop = '0';
+  let marginTop = "0";
 
   function updateLayoutMode() {
     isHorizontalLayout = window.innerWidth > 1270;
@@ -33,30 +37,34 @@
         if (contentHeight < windowHeight) {
           marginTop = `${(windowHeight - contentHeight) / 2}px`;
         } else {
-          marginTop = '2vh';
+          marginTop = "2vh";
         }
       } else {
-        marginTop = '0';
+        marginTop = "0";
       }
     });
   }
 
   onMount(() => {
-    window.addEventListener('resize', updateLayoutMode);
-    return () => window.removeEventListener('resize', updateLayoutMode);
+    window.addEventListener("resize", updateLayoutMode);
+    return () => window.removeEventListener("resize", updateLayoutMode);
   });
 
   $: $layoutUpdateStore, updateLayoutMode();
 
-  function handlePointerDown(e: PointerEvent, item: { id: string, label: string }, colId: string) {
+  function handlePointerDown(
+    e: PointerEvent,
+    item: { id: string; label: string },
+    colId: string,
+  ) {
     dragging = item;
     dragSourceCol = colId;
     isDragging = true;
     dragX = e.clientX;
     dragY = e.clientY;
-    document.body.style.userSelect = 'none';
-    window.addEventListener('pointermove', handlePointerMove);
-    window.addEventListener('pointerup', handlePointerUp);
+    document.body.style.userSelect = "none";
+    window.addEventListener("pointermove", handlePointerMove);
+    window.addEventListener("pointerup", handlePointerUp);
   }
 
   function handlePointerMove(e: PointerEvent) {
@@ -69,12 +77,14 @@
         if (!ul) continue;
         const ulRect = ul.getBoundingClientRect();
         if (
-          e.clientX >= ulRect.left && e.clientX <= ulRect.right &&
-          e.clientY >= ulRect.top && e.clientY <= ulRect.bottom
+          e.clientX >= ulRect.left &&
+          e.clientX <= ulRect.right &&
+          e.clientY >= ulRect.top &&
+          e.clientY <= ulRect.bottom
         ) {
           dropTargetCol = col.id;
           let found = false;
-          const liArr = Array.from(ul.querySelectorAll('li'));
+          const liArr = Array.from(ul.querySelectorAll("li"));
           for (let j = 0; j < liArr.length; j++) {
             const rect = liArr[j].getBoundingClientRect();
             if (e.clientY < rect.top + rect.height / 2) {
@@ -91,19 +101,83 @@
 
   function handlePointerUp(e: PointerEvent) {
     if (isDragging && dragging && dropTargetCol !== null) {
-      dispatch('drop', { dragging, dragSourceCol, dropTargetCol, dropIndex });
+      dispatch("drop", { dragging, dragSourceCol, dropTargetCol, dropIndex });
     }
     isDragging = false;
     dragging = null;
     dragSourceCol = null;
     dropTargetCol = null;
     dropIndex = null;
-    document.body.style.userSelect = '';
-    window.removeEventListener('pointermove', handlePointerMove);
-    window.removeEventListener('pointerup', handlePointerUp);
+    document.body.style.userSelect = "";
+    window.removeEventListener("pointermove", handlePointerMove);
+    window.removeEventListener("pointerup", handlePointerUp);
   }
 </script>
 
+<div
+  bind:this={containerRef}
+  class="dnd-columns-container {class_name}"
+  style="margin-top: {marginTop};"
+  data-testid="game-widgets-container"
+>
+  {#each columns as col, i}
+    <ul
+      bind:this={colRefs[i]}
+      class="dnd-column"
+      data-testid="dnd-column-{col.id}"
+      class:editing-column={$columnStyleMode === "flexible"}
+      style={$columnStyleMode === "flexible"
+        ? "padding: 0; background: none; border-radius: 8px; list-style: none; min-height: 80px;"
+        : "padding: 16px; background: #222; border-radius: 8px; list-style: none; min-height: 80px;"}
+      transition:slide={{ duration: 500 }}
+    >
+      {#if $columnStyleMode !== "flexible"}
+        <b class="dnd-column-header" style="color: #fff;">{col.label}</b>
+      {/if}
+      {#each col.items as item, j (item.id)}
+        <li
+          data-testid="widget-{item.id}"
+          class="dnd-item"
+          style="padding: 12px; margin: 8px 0; background: none; color: #fff; border-radius: 4px; {$columnStyleMode ===
+          'flexible'
+            ? 'cursor: grab;'
+            : 'cursor: default;'} opacity: {dragging && dragging.id === item.id
+            ? 0.5
+            : 1};"
+          on:pointerdown={$columnStyleMode === "flexible"
+            ? (e) => handlePointerDown(e, item, col.id)
+            : undefined}
+          transition:slide={{ duration: 500 }}
+        >
+          <div class="dnd-item-content">
+            {#if typeof itemContent(item) === "function"}
+              <svelte:component this={itemContent(item)} {...item.props} />
+            {:else}
+              {itemContent(item)}
+            {/if}
+          </div>
+        </li>
+      {/each}
+    </ul>
+  {/each}
+</div>
+
+{#if isDragging && dragging && $columnStyleMode === "flexible"}
+  <div
+    class="dnd-edit-instruction"
+    style="
+      position: fixed;
+      top: 0;
+      left: 0;
+      pointer-events: none;
+      z-index: 9999;
+      transform: translate({dragX}px, {dragY}px) scale(1.05);
+    "
+  >
+    {$_("ui.dndEditInstruction")}
+  </div>
+{/if}
+
 <style>
   .dnd-columns-container {
     display: flex;
@@ -111,7 +185,10 @@
     justify-content: center;
     margin-top: 0;
     flex-direction: row;
-    transition: gap 0.6s cubic-bezier(0.4,0,0.2,1), padding 0.6s cubic-bezier(0.4,0,0.2,1), margin 0.6s cubic-bezier(0.4,0,0.2,1);
+    transition:
+      gap 0.6s cubic-bezier(0.4, 0, 0.2, 1),
+      padding 0.6s cubic-bezier(0.4, 0, 0.2, 1),
+      margin 0.6s cubic-bezier(0.4, 0, 0.2, 1);
   }
   @media (max-width: 1270px) {
     .dnd-columns-container {
@@ -190,56 +267,3 @@
     pointer-events: none;
   }
 </style>
-
-<div bind:this={containerRef} class="dnd-columns-container {class_name}" style="margin-top: {marginTop};" data-testid="game-widgets-container">
-  {#each columns as col, i}
-    <ul
-      bind:this={colRefs[i]}
-      class="dnd-column"
-      data-testid="dnd-column-{col.id}"
-      class:editing-column={$columnStyleMode === 'editing'}
-      style={$columnStyleMode === 'editing'
-        ? 'padding: 0; background: none; border-radius: 8px; list-style: none; min-height: 80px;'
-        : 'padding: 16px; background: #222; border-radius: 8px; list-style: none; min-height: 80px;'}
-      transition:slide={{ duration: 500 }}
-    >
-      {#if $columnStyleMode !== 'editing'}
-        <b class="dnd-column-header" style="color: #fff;">{col.label}</b>
-      {/if}
-      {#each col.items as item, j (item.id)}
-        <li
-          data-testid="widget-{item.id}"
-          class="dnd-item"
-          style="padding: 12px; margin: 8px 0; background: none; color: #fff; border-radius: 4px; {($columnStyleMode === 'editing') ? 'cursor: grab;' : 'cursor: default;'} opacity: {dragging && dragging.id === item.id ? 0.5 : 1};"
-          on:pointerdown={($columnStyleMode === 'editing') ? (e) => handlePointerDown(e, item, col.id) : undefined}
-          transition:slide={{ duration: 500 }}
-        >
-          <div class="dnd-item-content">
-            {#if typeof itemContent(item) === 'function'}
-              <svelte:component this={itemContent(item)} {...item.props} />
-            {:else}
-              {itemContent(item)}
-            {/if}
-          </div>
-        </li>
-      {/each}
-    </ul>
-  {/each}
-</div>
-
-{#if isDragging && dragging && $columnStyleMode === 'editing'}
-  <div
-    class="dnd-edit-instruction"
-    style="
-      position: fixed;
-      top: 0;
-      left: 0;
-      pointer-events: none;
-      z-index: 9999;
-      transform: translate({dragX}px, {dragY}px) scale(1.05);
-    "
-  >
-    {$_('ui.dndEditInstruction')}
-  </div>
-{/if} 
-
diff --git a/src/lib/components/VoiceSettingsModal.svelte b/src/lib/components/VoiceSettingsModal.svelte
index c2e1d67..513a9fe 100644
--- a/src/lib/components/VoiceSettingsModal.svelte
+++ b/src/lib/components/VoiceSettingsModal.svelte
@@ -1,13 +1,13 @@
-<script>
-  import { onMount, onDestroy } from 'svelte';
-  import { _ } from 'svelte-i18n';
-  import VoiceSettings from './VoiceSettings.svelte';
-  import VoiceList from './VoiceList.svelte';
+<script lang="ts">
+  import { onMount, onDestroy } from "svelte";
+  import { _ } from "svelte-i18n";
+  import VoiceSettings from "./VoiceSettings.svelte";
+  import VoiceList from "./VoiceList.svelte";
 
   export let close = () => {};
 
   let showFade = false;
-  let voiceListContainer;
+  let voiceListContainer: HTMLDivElement | null = null;
 
   function updateFadeState() {
     if (!voiceListContainer) return;
@@ -17,8 +17,8 @@
     showFade = isScrollable && !isAtBottom;
   }
 
-  let mutationObserver;
-  let resizeObserver;
+  let mutationObserver: MutationObserver | null = null;
+  let resizeObserver: ResizeObserver | null = null;
 
   onMount(() => {
     if (voiceListContainer) {
@@ -42,34 +42,40 @@
   });
 </script>
 
-<div 
-  class="modal-overlay" 
-  on:click={close} 
-  on:keydown={(e) => { if (e.key === 'Enter' || e.key === ' ') close(); }}
+<div
+  class="modal-overlay"
+  on:click={close}
+  on:keydown={(e) => {
+    if (e.key === "Enter" || e.key === " ") close();
+  }}
   role="button"
   tabindex="0"
-  aria-label={$_('voiceSettings.close')}
+  aria-label={$_("voiceSettings.close")}
 >
-  <div 
+  <div
     class="modal-window"
     data-testid="voice-settings-modal"
     tabindex="0"
     on:click={(e) => e.stopPropagation()}
-    on:keydown={(e) => { if (e.key === 'Escape') close(); }}
+    on:keydown={(e) => {
+      if (e.key === "Escape") close();
+    }}
     role="dialog"
     aria-modal="true"
     aria-labelledby="voice-settings-title"
   >
     <div class="modal-header">
-      <h2 class="modal-title" id="voice-settings-title">{$_('voiceSettings.title')}</h2>
+      <h2 class="modal-title" id="voice-settings-title">
+        {$_("voiceSettings.title")}
+      </h2>
     </div>
     <div class="modal-body">
       <div class="voice-settings-container">
         <VoiceSettings />
       </div>
-      <hr class="divider-h"/>
+      <hr class="divider-h" />
       <div class="divider-v"></div>
-      <div 
+      <div
         class="voice-list-container"
         class:fade-bottom={showFade}
         bind:this={voiceListContainer}
@@ -79,7 +85,11 @@
       </div>
     </div>
     <div class="modal-footer">
-      <button class="modal-btn-generic primary" on:click={close} data-testid="voice-settings-save-footer-btn">{$_('common.save')}</button>
+      <button
+        class="modal-btn-generic primary"
+        on:click={close}
+        data-testid="voice-settings-save-footer-btn">{$_("common.save")}</button
+      >
     </div>
   </div>
 </div>
@@ -105,7 +115,12 @@
     color: #fff;
     animation: modalFadeIn 0.3s ease-out forwards;
   }
-  @keyframes modalFadeIn { to { transform: scale(1); opacity: 1; } }
+  @keyframes modalFadeIn {
+    to {
+      transform: scale(1);
+      opacity: 1;
+    }
+  }
   .modal-header {
     padding: 16px 24px;
     border-bottom: 1px solid rgba(255, 255, 255, 0.1);
@@ -118,7 +133,7 @@
     font-weight: 700;
     margin: 0;
   }
-  
+
   .modal-body {
     padding: 24px;
     max-height: 60vh;
diff --git a/src/lib/components/widgets/SettingsExpanderWidget.svelte b/src/lib/components/widgets/SettingsExpanderWidget.svelte
index 45532d4..26a722e 100644
--- a/src/lib/components/widgets/SettingsExpanderWidget.svelte
+++ b/src/lib/components/widgets/SettingsExpanderWidget.svelte
@@ -1,28 +1,28 @@
 <script lang="ts">
-  import { gameModeStore } from '$lib/stores/gameModeStore.js';
-  import { goto } from '$app/navigation';
-  import { base } from '$app/paths';
-  import { userActionService } from '$lib/services/userActionService.js';
-  import { modalStore } from '$lib/stores/modalStore';
-  import { _ } from 'svelte-i18n';
-  import { openVoiceSettingsModal } from '$lib/stores/uiStore';
-  import { uiStateStore } from '$lib/stores/uiStateStore.js';
-  import { gameSettingsStore } from '$lib/stores/gameSettingsStore.js';
-  import SvgIcons from '../SvgIcons.svelte';
-  import { get } from 'svelte/store';
-  import { onMount, tick } from 'svelte';
-  import { columnStyleMode } from '$lib/stores/columnStyleStore';
-  import VoiceSettingsModalWrapper from '$lib/components/VoiceSettingsModalWrapper.svelte';
-  import { slide } from 'svelte/transition';
-  import { layoutStore } from '$lib/stores/layoutStore';
-  import { logService } from '$lib/services/logService.js';
-  import ToggleButton from '../ToggleButton.svelte';
-  import { blurOnClick } from '$lib/utils/actions';
-  import { customTooltip } from '$lib/actions/customTooltip.js';
-  import { gameModeService } from '$lib/services/gameModeService';
-  import { boardStore } from '$lib/stores/boardStore';
-  import { layoutUpdateStore } from '$lib/stores/layoutUpdateStore';
-  import { dev } from '$app/environment';
+  import { gameModeStore } from "$lib/stores/gameModeStore.js";
+  import { goto } from "$app/navigation";
+  import { base } from "$app/paths";
+  import { userActionService } from "$lib/services/userActionService.js";
+  import { modalStore } from "$lib/stores/modalStore";
+  import { _ } from "svelte-i18n";
+  import { openVoiceSettingsModal } from "$lib/stores/uiStore";
+  import { uiStateStore } from "$lib/stores/uiStateStore.js";
+  import { gameSettingsStore } from "$lib/stores/gameSettingsStore.js";
+  import SvgIcons from "../SvgIcons.svelte";
+  import { get } from "svelte/store";
+  import { onMount, tick } from "svelte";
+  import { columnStyleMode } from "$lib/stores/columnStyleStore";
+  import VoiceSettingsModalWrapper from "$lib/components/VoiceSettingsModalWrapper.svelte";
+  import { slide } from "svelte/transition";
+  import { layoutStore } from "$lib/stores/layoutStore";
+  import { logService } from "$lib/services/logService.js";
+  import ToggleButton from "../ToggleButton.svelte";
+  import { blurOnClick } from "$lib/utils/actions";
+  import { customTooltip } from "$lib/actions/customTooltip.js";
+  import { gameModeService } from "$lib/services/gameModeService";
+  import { boardStore } from "$lib/stores/boardStore";
+  import { layoutUpdateStore } from "$lib/stores/layoutUpdateStore";
+  import { dev } from "$app/environment";
 
   let expanderRef: HTMLDetailsElement;
   let summaryRef: HTMLElement;
@@ -32,12 +32,14 @@
   let contentHeight = 0;
 
   // Update the global store whenever the local state changes
-  $: uiStateStore.update(s => ({ ...s, isSettingsExpanderOpen: isOpen }));
+  $: uiStateStore.update((s) => ({ ...s, isSettingsExpanderOpen: isOpen }));
 
   async function toggleExpander() {
-    logService.action('Click: "–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏/–ó–≥–æ—Ä–Ω—É—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è" (SettingsExpanderWidget)');
+    logService.action(
+      'Click: "–†–æ–∑–≥–æ—Ä–Ω—É—Ç–∏/–ó–≥–æ—Ä–Ω—É—Ç–∏ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è" (SettingsExpanderWidget)',
+    );
     isOpen = !isOpen;
-    setTimeout(() => layoutUpdateStore.update(n => n + 1), 500);
+    setTimeout(() => layoutUpdateStore.update((n) => n + 1), 500);
   }
   let isHorizontalLayout = true;
 
@@ -46,28 +48,34 @@
   }
 
   function fitTextAction(node: HTMLElement, dependency: any) {
-    const buttons = Array.from(node.querySelectorAll('.settings-expander__row-btn')) as HTMLElement[];
+    const buttons = Array.from(
+      node.querySelectorAll(".settings-expander__row-btn"),
+    ) as HTMLElement[];
 
     const fit = () => {
       if (buttons.length === 0) return;
 
-      buttons.forEach(btn => btn.style.fontSize = '');
+      buttons.forEach((btn) => (btn.style.fontSize = ""));
 
       tick().then(() => {
-        const initialFontSize = parseFloat(getComputedStyle(buttons[0]).fontSize);
+        const initialFontSize = parseFloat(
+          getComputedStyle(buttons[0]).fontSize,
+        );
         let currentFontSize = initialFontSize;
 
         const fontSizeStep = 0.5;
         while (node.scrollWidth > node.clientWidth && currentFontSize > 12) {
           currentFontSize -= fontSizeStep;
-          buttons.forEach(btn => btn.style.fontSize = `${currentFontSize}px`);
+          buttons.forEach(
+            (btn) => (btn.style.fontSize = `${currentFontSize}px`),
+          );
         }
       });
     };
 
     const observer = new ResizeObserver(fit);
     observer.observe(node);
-    
+
     tick().then(fit);
 
     return {
@@ -76,22 +84,20 @@
       },
       destroy() {
         observer.disconnect();
-      }
+      },
     };
   }
 
-  
-
   onMount(() => {
     updateLayoutMode();
-    window.addEventListener('resize', updateLayoutMode);
+    window.addEventListener("resize", updateLayoutMode);
 
     if (isOpen) {
-        setTimeout(() => layoutUpdateStore.update(n => n + 1), 500);
+      setTimeout(() => layoutUpdateStore.update((n) => n + 1), 500);
     }
 
     return () => {
-      window.removeEventListener('resize', updateLayoutMode);
+      window.removeEventListener("resize", updateLayoutMode);
     };
   });
 
@@ -107,43 +113,55 @@
     }
   }
 
-
   $: speechEnabled = $gameSettingsStore.speechEnabled;
 
   $: activeMode = $gameModeStore.activeMode;
-  $: isCompetitiveMode = ($gameModeStore.activeMode === 'timed' || ($gameModeStore.activeMode === 'local' && $gameSettingsStore.lockSettings) || $gameModeStore.activeMode === 'online') || $uiStateStore.settingsMode === 'competitive';
+  $: isCompetitiveMode =
+    $gameModeStore.activeMode === "timed" ||
+    ($gameModeStore.activeMode === "local" &&
+      $gameSettingsStore.lockSettings) ||
+    $gameModeStore.activeMode === "online" ||
+    $uiStateStore.settingsMode === "competitive";
 
   function showCompetitiveModeModal() {
     const activeMode = get(gameModeStore).activeMode;
 
     const goToTrainingOnClick = () => {
       modalStore.closeModal();
-      if (activeMode === 'virtual-player') {
-        userActionService.setGameModePreset('beginner');
-        uiStateStore.update(s => ({ ...s, settingsMode: 'default' }));
+      if (activeMode === "virtual-player") {
+        userActionService.setGameModePreset("beginner");
+        uiStateStore.update((s) => ({ ...s, settingsMode: "default" }));
       } else {
-        gameModeService.initializeGameMode('training');
+        gameModeService.initializeGameMode("training");
         goto(`${base}/game/training`);
       }
     };
 
-    logService.action('Click: on a locked setting in competitive mode (SettingsExpanderWidget)');
+    logService.action(
+      "Click: on a locked setting in competitive mode (SettingsExpanderWidget)",
+    );
     modalStore.showModal({
-      titleKey: 'modal.competitiveModeLockTitle',
-      dataTestId: 'competitive-mode-modal', // Added dataTestId
-      contentKey: 'modal.competitiveModeLockContent',
+      titleKey: "modal.competitiveModeLockTitle",
+      dataTestId: "competitive-mode-modal", // Added dataTestId
+      contentKey: "modal.competitiveModeLockContent",
       buttons: [
-        { textKey: 'modal.goToTraining', primary: true, onClick: goToTrainingOnClick },
-        { textKey: 'modal.stay', onClick: modalStore.closeModal }
+        {
+          textKey: "modal.goToTraining",
+          primary: true,
+          onClick: goToTrainingOnClick,
+        },
+        { textKey: "modal.stay", onClick: modalStore.closeModal },
       ],
       closeOnOverlayClick: true,
     });
   }
 
   function changeBoardSize(increment: number) {
-    logService.action(`Click: "–ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –¥–æ—à–∫–∏: ${increment > 0 ? '+' : ''}${increment}" (SettingsExpanderWidget)`);
+    logService.action(
+      `Click: "–ó–º—ñ–Ω–∏—Ç–∏ —Ä–æ–∑–º—ñ—Ä –¥–æ—à–∫–∏: ${increment > 0 ? "+" : ""}${increment}" (SettingsExpanderWidget)`,
+    );
     const currentSize = get(boardStore)?.boardSize;
-    if (typeof currentSize !== 'number') return;
+    if (typeof currentSize !== "number") return;
     const newSize = currentSize + increment;
     if (newSize >= 2 && newSize <= 9) {
       userActionService.changeBoardSize(newSize);
@@ -151,21 +169,34 @@
   }
 
   function selectBlockCount(count: number) {
-    logService.action(`Click: "–í–∏–±—ñ—Ä –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –±–ª–æ–∫—ñ–≤: ${count}" (SettingsExpanderWidget)`);
+    logService.action(
+      `Click: "–í–∏–±—ñ—Ä –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –±–ª–æ–∫—ñ–≤: ${count}" (SettingsExpanderWidget)`,
+    );
     if (count > 0 && get(gameSettingsStore).showDifficultyWarningModal) {
       modalStore.showModal({
-        titleKey: 'modal.expertModeTitle',
-        dataTestId: 'expert-mode-modal',
-        contentKey: 'modal.expertModeContent',
+        titleKey: "modal.expertModeTitle",
+        dataTestId: "expert-mode-modal",
+        contentKey: "modal.expertModeContent",
         buttons: [
-          { textKey: 'modal.expertModeConfirm', primary: true, isHot: true, onClick: () => { gameSettingsStore.updateSettings({ blockOnVisitCount: count }); modalStore.closeModal(); } },
-          { textKey: 'modal.expertModeCancel', onClick: modalStore.closeModal }
+          {
+            textKey: "modal.expertModeConfirm",
+            primary: true,
+            isHot: true,
+            onClick: () => {
+              gameSettingsStore.updateSettings({ blockOnVisitCount: count });
+              modalStore.closeModal();
+            },
+          },
+          { textKey: "modal.expertModeCancel", onClick: modalStore.closeModal },
         ],
         closeOnOverlayClick: true,
         props: {
           showDontShowAgain: true,
-          dontShowAgainBinding: () => gameSettingsStore.updateSettings({ showDifficultyWarningModal: false })
-        }
+          dontShowAgainBinding: () =>
+            gameSettingsStore.updateSettings({
+              showDifficultyWarningModal: false,
+            }),
+        },
       });
     } else {
       gameSettingsStore.updateSettings({ blockOnVisitCount: count });
@@ -173,14 +204,21 @@
   }
 
   function handleToggleAutoHideBoard(event: Event) {
-    logService.action('Click: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏—Ö–æ–≤—É–≤–∞—Ç–∏ –¥–æ—à–∫—É" (SettingsExpanderWidget)');
+    logService.action(
+      'Click: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏—Ö–æ–≤—É–≤–∞—Ç–∏ –¥–æ—à–∫—É" (SettingsExpanderWidget)',
+    );
     gameSettingsStore.toggleAutoHideBoard();
   }
 
-  const icons = ['visibility_off', 'grid_on', 'view_in_ar', 'rule'];
+  const icons = ["visibility_off", "grid_on", "view_in_ar", "rule"];
 
   const toggleFunctions = [
-    () => gameSettingsStore.updateSettings({ showBoard: false, showPiece: false, showMoves: false }),
+    () =>
+      gameSettingsStore.updateSettings({
+        showBoard: false,
+        showPiece: false,
+        showMoves: false,
+      }),
     () => {
       const current = get(gameSettingsStore).showBoard;
       if (!current) {
@@ -190,203 +228,282 @@
     () => {
       const current = get(gameSettingsStore).showPiece;
       if (current) {
-        gameSettingsStore.updateSettings({ showPiece: false, showMoves: false });
+        gameSettingsStore.updateSettings({
+          showPiece: false,
+          showMoves: false,
+        });
       } else {
-     gameSettingsStore.updateSettings({ showBoard: true, showPiece: true });                                                       
-    }
+        gameSettingsStore.updateSettings({ showBoard: true, showPiece: true });
+      }
     },
     () => {
       const current = get(gameSettingsStore).showMoves;
       if (current) {
         gameSettingsStore.updateSettings({ showMoves: false });
       } else {
-        gameSettingsStore.updateSettings({ showBoard: true, showPiece: true, showMoves: true });
+        gameSettingsStore.updateSettings({
+          showBoard: true,
+          showPiece: true,
+          showMoves: true,
+        });
       }
-    }
+    },
   ];
 
   function getIsActive(i: number) {
     switch (i) {
-      case 0: return !$gameSettingsStore.showBoard;
-      case 1: return $gameSettingsStore.showBoard;
-      case 2: return $gameSettingsStore.showPiece;
-      case 3: return $gameSettingsStore.showMoves;
-      default: return false;
+      case 0:
+        return !$gameSettingsStore.showBoard;
+      case 1:
+        return $gameSettingsStore.showBoard;
+      case 2:
+        return $gameSettingsStore.showPiece;
+      case 3:
+        return $gameSettingsStore.showMoves;
+      default:
+        return false;
     }
   }
 </script>
 
 {#if $boardStore}
-<div class="settings-expander {isOpen ? 'open' : ''}">
-  <div
-    data-testid="settings-expander-summary"
-    class="settings-expander__summary"
-    role="button"
-    aria-label={$_('gameControls.settings')}
-    on:click={toggleExpander}
-    on:keydown={(e) => (e.key === 'Enter' || e.key === ' ') && toggleExpander()}
-    bind:this={summaryRef}
-    tabindex={0}
-  >
-    {$_('gameControls.settings')}
-    <span class="settings-expander__arrow" aria-hidden="true"><svg viewBox="0 0 24 24" width="24" height="24"><polyline points="6 9 12 15 18 9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
-  </div>
-  <div class="settings-expander__content" bind:this={contentRef} style="max-height: {contentHeight}px; opacity: {isOpen ? 1 : 0};">
-    
-    <div class="settings-expander__setting-item">
-      <span class="settings-expander__label">{$_('settings.boardSize')}</span>
-      <div class="settings-expander__size-adjuster">
-        <button
-          class="settings-expander__square-btn"
-          use:blurOnClick
-          on:click={() => changeBoardSize(-1)}
-          disabled={$boardStore.boardSize <= 2}
-          data-testid="decrease-board-size-btn"
-        >-</button>
-        <span class="settings-expander__current-size">{$boardStore.boardSize}x{$boardStore.boardSize}</span>
-        <button
-          class="settings-expander__square-btn"
-          use:blurOnClick
-          on:click={() => changeBoardSize(1)}
-          disabled={$boardStore.boardSize >= 9}
-          data-testid="increase-board-size-btn"
-        >+</button>
-      </div>
-    </div>
-    <div class="settings-expander__button-group" class:locked-setting={isCompetitiveMode} use:fitTextAction={$_('settings.visibility.hidden')}>
-      {#each [$_('settings.visibility.hidden'), $_('settings.visibility.boardOnly'), $_('settings.visibility.withPiece'), $_('settings.visibility.withMoves')] as label, i}
-        <button
-          data-testid="settings-expander-visibility-btn-{$_('settings.visibility.hidden') === label ? 'hidden' : $_('settings.visibility.boardOnly') === label ? 'boardOnly' : $_('settings.visibility.withPiece') === label ? 'withPiece' : 'withMoves'}"
-          class="settings-expander__row-btn"
-          class:active={getIsActive(i)}
-          on:click={() => {
-            logService.action(`Click: on visibility button ${label} (SettingsExpanderWidget)`);
-            isCompetitiveMode ? showCompetitiveModeModal() : toggleFunctions[i]()
-          }}
-        >
-          <SvgIcons name={icons[i]} />
-          {label}
-        </button>
-      {/each}
-    </div>
-    <hr class="settings-expander__divider" />
-    <h3 class="settings-expander__section-title">{$_('settings.gameInfoWidget.title')}</h3>
-    <div class="settings-expander__button-group settings-expander__button-group--three" use:fitTextAction={$_('settings.gameInfoWidget.hidden')}>
-      <button
-        data-testid="settings-expander-game-info-widget-hidden-btn"
-        class="settings-expander__row-btn"
-        class:active={$gameSettingsStore.showGameInfoWidget === 'hidden'}
-        on:click={() => gameSettingsStore.setGameInfoWidgetState('hidden')}
-      >
-        {$_('settings.gameInfoWidget.hidden')}
-      </button>
-      <button
-        data-testid="settings-expander-game-info-widget-shown-btn"
-        class="settings-expander__row-btn"
-        class:active={$gameSettingsStore.showGameInfoWidget === 'shown'}
-        on:click={() => gameSettingsStore.setGameInfoWidgetState('shown')}
-      >
-        {$_('settings.gameInfoWidget.shown')}
-      </button>
-      <button
-        data-testid="settings-expander-game-info-widget-compact-btn"
-        class="settings-expander__row-btn"
-        class:active={$gameSettingsStore.showGameInfoWidget === 'compact'}
-        on:click={() => gameSettingsStore.setGameInfoWidgetState('compact')}
-      >
-        {$_('settings.gameInfoWidget.compact')}
-      </button>
-    </div>
-    <hr class="settings-expander__divider" />
-    <div 
-      class:locked-setting={isCompetitiveMode} 
-      on:click|preventDefault|stopPropagation={isCompetitiveMode ? showCompetitiveModeModal : () => {}}
-      on:keydown={(e) => (e.key === 'Enter' || e.key === ' ') && (isCompetitiveMode ? showCompetitiveModeModal() : () => {})}
+  <div class="settings-expander {isOpen ? 'open' : ''}">
+    <div
+      data-testid="settings-expander-summary"
+      class="settings-expander__summary"
       role="button"
-      tabindex={isCompetitiveMode ? 0 : -1}
+      aria-label={$_("gameControls.settings")}
+      on:click={toggleExpander}
+      on:keydown={(e) =>
+        (e.key === "Enter" || e.key === " ") && toggleExpander()}
+      bind:this={summaryRef}
+      tabindex={0}
     >
-    <ToggleButton
-      label={$_('gameModes.autoHideBoard')}
-      checked={$gameSettingsStore.autoHideBoard}
-      on:toggle={isCompetitiveMode ? () => {} : handleToggleAutoHideBoard}
-      dataTestId="auto-hide-board-toggle"
-    />
+      {$_("gameControls.settings")}
+      <span class="settings-expander__arrow" aria-hidden="true"
+        ><svg viewBox="0 0 24 24" width="24" height="24"
+          ><polyline
+            points="6 9 12 15 18 9"
+            fill="none"
+            stroke="currentColor"
+            stroke-width="2"
+            stroke-linecap="round"
+            stroke-linejoin="round"
+          /></svg
+        ></span
+      >
     </div>
-    <div 
-      class:locked-setting={isCompetitiveMode} 
-      on:click|preventDefault|stopPropagation={isCompetitiveMode ? showCompetitiveModeModal : () => {}}
-      on:keydown={(e) => (e.key === 'Enter' || e.key === ' ') && (isCompetitiveMode ? showCompetitiveModeModal() : () => {})}
-      role="button"
-      tabindex={isCompetitiveMode ? 0 : -1}
+    <div
+      class="settings-expander__content"
+      bind:this={contentRef}
+      style="max-height: {contentHeight}px; opacity: {isOpen ? 1 : 0};"
     >
-    <ToggleButton
-      label={$_('gameControls.blockMode')}
-      checked={$gameSettingsStore.blockModeEnabled}
-      on:toggle={isCompetitiveMode ? () => {} : gameSettingsStore.toggleBlockMode}
-      dataTestId="block-mode-toggle"
-    />
-    </div>
-    {#if $gameSettingsStore.blockModeEnabled}
-      <div class="settings-expander__options-group">
-        <span class="settings-expander__label">{$_('gameControls.blockAfter')}</span>
-        <div class="settings-expander__button-group" use:fitTextAction={$gameSettingsStore.blockOnVisitCount}>
-          {#each [0, 1, 2, 3] as count}
-            <button data-testid="settings-expander-block-count-btn-{count}" class="settings-expander__square-btn" class:active={$gameSettingsStore.blockOnVisitCount === count} on:click={() => selectBlockCount(count)}>{count + 1}</button>
-          {/each}
+      <div class="settings-expander__setting-item">
+        <span class="settings-expander__label">{$_("settings.boardSize")}</span>
+        <div class="settings-expander__size-adjuster">
+          <button
+            class="settings-expander__square-btn"
+            use:blurOnClick
+            on:click={() => changeBoardSize(-1)}
+            disabled={$boardStore.boardSize <= 2}
+            data-testid="decrease-board-size-btn">-</button
+          >
+          <span class="settings-expander__current-size"
+            >{$boardStore.boardSize}x{$boardStore.boardSize}</span
+          >
+          <button
+            class="settings-expander__square-btn"
+            use:blurOnClick
+            on:click={() => changeBoardSize(1)}
+            disabled={$boardStore.boardSize >= 9}
+            data-testid="increase-board-size-btn">+</button
+          >
         </div>
       </div>
-    {/if}
-    <div class="settings-expander__setting-item">
-      <ToggleButton
-        label={$_('gameControls.speech')}
-        checked={speechEnabled}
-        on:toggle={() => userActionService.toggleSpeech()}
-        dataTestId="speech-toggle"
-      />
-      <button data-testid="settings-expander-voice-settings-btn" class="settings-expander__square-btn" use:blurOnClick use:customTooltip={$_('gameControls.voiceSettingsTitle')} on:click|stopPropagation={openVoiceSettingsModal}>
-        <SvgIcons name="voice-settings" />
-      </button>
-    </div>
-    <hr class="settings-expander__divider" />
-    {#if isHorizontalLayout}
-    <div class="settings-expander__setting-item">
-      <span class="settings-expander__label">{$_('ui.moveMenuItems')}</span>
-      <div style="display: flex; gap: 12px;">
+      <div
+        class="settings-expander__button-group"
+        class:locked-setting={isCompetitiveMode}
+        use:fitTextAction={$_("settings.visibility.hidden")}
+      >
+        {#each [$_("settings.visibility.hidden"), $_("settings.visibility.boardOnly"), $_("settings.visibility.withPiece"), $_("settings.visibility.withMoves")] as label, i}
+          <button
+            data-testid="settings-expander-visibility-btn-{$_(
+              'settings.visibility.hidden',
+            ) === label
+              ? 'hidden'
+              : $_('settings.visibility.boardOnly') === label
+                ? 'boardOnly'
+                : $_('settings.visibility.withPiece') === label
+                  ? 'withPiece'
+                  : 'withMoves'}"
+            class="settings-expander__row-btn"
+            class:active={getIsActive(i)}
+            on:click={() => {
+              logService.action(
+                `Click: on visibility button ${label} (SettingsExpanderWidget)`,
+              );
+              isCompetitiveMode
+                ? showCompetitiveModeModal()
+                : toggleFunctions[i]();
+            }}
+          >
+            <SvgIcons name={icons[i]} />
+            {label}
+          </button>
+        {/each}
+      </div>
+      <hr class="settings-expander__divider" />
+      <h3 class="settings-expander__section-title">
+        {$_("settings.gameInfoWidget.title")}
+      </h3>
+      <div
+        class="settings-expander__button-group settings-expander__button-group--three"
+        use:fitTextAction={$_("settings.gameInfoWidget.hidden")}
+      >
         <button
-          data-testid="settings-expander-column-style-fixed-btn"
-          class="settings-expander__square-btn"
-          aria-label="Fixed mode"
-          on:click={() => columnStyleMode.set('fixed')}
-          class:active={$columnStyleMode === 'fixed'}
+          data-testid="settings-expander-game-info-widget-hidden-btn"
+          class="settings-expander__row-btn"
+          class:active={$gameSettingsStore.showGameInfoWidget === "hidden"}
+          on:click={() => gameSettingsStore.setGameInfoWidgetState("hidden")}
         >
-          <SvgIcons name="fixed" />
+          {$_("settings.gameInfoWidget.hidden")}
         </button>
         <button
-          data-testid="settings-expander-column-style-editing-btn"
-          class="settings-expander__square-btn"
-          aria-label="Editing mode"
-          on:click={() => columnStyleMode.set('editing')}
-          class:active={$columnStyleMode === 'editing'}
+          data-testid="settings-expander-game-info-widget-shown-btn"
+          class="settings-expander__row-btn"
+          class:active={$gameSettingsStore.showGameInfoWidget === "shown"}
+          on:click={() => gameSettingsStore.setGameInfoWidgetState("shown")}
+        >
+          {$_("settings.gameInfoWidget.shown")}
+        </button>
+        <button
+          data-testid="settings-expander-game-info-widget-compact-btn"
+          class="settings-expander__row-btn"
+          class:active={$gameSettingsStore.showGameInfoWidget === "compact"}
+          on:click={() => gameSettingsStore.setGameInfoWidgetState("compact")}
         >
-          <SvgIcons name="editing" />
+          {$_("settings.gameInfoWidget.compact")}
         </button>
+      </div>
+      <hr class="settings-expander__divider" />
+      <div
+        class:locked-setting={isCompetitiveMode}
+        on:click|preventDefault|stopPropagation={isCompetitiveMode
+          ? showCompetitiveModeModal
+          : () => {}}
+        on:keydown={(e) =>
+          (e.key === "Enter" || e.key === " ") &&
+          (isCompetitiveMode ? showCompetitiveModeModal() : () => {})}
+        role="button"
+        tabindex={isCompetitiveMode ? 0 : -1}
+      >
+        <ToggleButton
+          label={$_("gameModes.autoHideBoard")}
+          checked={$gameSettingsStore.autoHideBoard}
+          on:toggle={isCompetitiveMode ? () => {} : handleToggleAutoHideBoard}
+          dataTestId="auto-hide-board-toggle"
+        />
+      </div>
+      <div
+        class:locked-setting={isCompetitiveMode}
+        on:click|preventDefault|stopPropagation={isCompetitiveMode
+          ? showCompetitiveModeModal
+          : () => {}}
+        on:keydown={(e) =>
+          (e.key === "Enter" || e.key === " ") &&
+          (isCompetitiveMode ? showCompetitiveModeModal() : () => {})}
+        role="button"
+        tabindex={isCompetitiveMode ? 0 : -1}
+      >
+        <ToggleButton
+          label={$_("gameControls.blockMode")}
+          checked={$gameSettingsStore.blockModeEnabled}
+          on:toggle={isCompetitiveMode
+            ? () => {}
+            : gameSettingsStore.toggleBlockMode}
+          dataTestId="block-mode-toggle"
+        />
+      </div>
+      {#if $gameSettingsStore.blockModeEnabled}
+        <div class="settings-expander__options-group">
+          <span class="settings-expander__label"
+            >{$_("gameControls.blockAfter")}</span
+          >
+          <div
+            class="settings-expander__button-group"
+            use:fitTextAction={$gameSettingsStore.blockOnVisitCount}
+          >
+            {#each [0, 1, 2, 3] as count}
+              <button
+                data-testid="settings-expander-block-count-btn-{count}"
+                class="settings-expander__square-btn"
+                class:active={$gameSettingsStore.blockOnVisitCount === count}
+                on:click={() => selectBlockCount(count)}>{count + 1}</button
+              >
+            {/each}
+          </div>
+        </div>
+      {/if}
+      <div class="settings-expander__setting-item">
+        <ToggleButton
+          label={$_("gameControls.speech")}
+          checked={speechEnabled}
+          on:toggle={() => userActionService.toggleSpeech()}
+          dataTestId="speech-toggle"
+        />
         <button
-          data-testid="settings-expander-reset-layout-btn"
+          data-testid="settings-expander-voice-settings-btn"
           class="settings-expander__square-btn"
           use:blurOnClick
-          aria-label="–°–∫–∏–Ω—É—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –º–µ–Ω—é"
-          use:customTooltip={$_('ui.resetMenuLayout') || '–°–∫–∏–Ω—É—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –º–µ–Ω—é'}
-          on:click={() => layoutStore.resetLayout()}
+          use:customTooltip={$_("gameControls.voiceSettingsTitle")}
+          on:click|stopPropagation={openVoiceSettingsModal}
         >
-          <span style="width:50%;height:50%;display:flex;align-items:center;justify-content:center;">
-            <SvgIcons name="clear-cache" />
-          </span>
+          <SvgIcons name="voice-settings" />
         </button>
       </div>
+      <hr class="settings-expander__divider" />
+      {#if isHorizontalLayout}
+        <div class="settings-expander__setting-item">
+          <span class="settings-expander__label">{$_("ui.moveMenuItems")}</span>
+          <div style="display: flex; gap: 12px;">
+            <button
+              data-testid="settings-expander-column-style-fixed-btn"
+              class="settings-expander__square-btn"
+              aria-label="Fixed mode"
+              on:click={() => columnStyleMode.set("fixed")}
+              class:active={$columnStyleMode === "fixed"}
+            >
+              <SvgIcons name="fixed" />
+            </button>
+            <button
+              data-testid="settings-expander-column-style-editing-btn"
+              class="settings-expander__square-btn"
+              aria-label="Flexible mode"
+              on:click={() => columnStyleMode.set("flexible")}
+              class:active={$columnStyleMode === "flexible"}
+            >
+              <SvgIcons name="editing" />
+            </button>
+            <button
+              data-testid="settings-expander-reset-layout-btn"
+              class="settings-expander__square-btn"
+              use:blurOnClick
+              aria-label="–°–∫–∏–Ω—É—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –º–µ–Ω—é"
+              use:customTooltip={$_("ui.resetMenuLayout") ||
+                "–°–∫–∏–Ω—É—Ç–∏ –ø–æ–ª–æ–∂–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –º–µ–Ω—é"}
+              on:click={() => layoutStore.resetLayout()}
+            >
+              <span
+                style="width:50%;height:50%;display:flex;align-items:center;justify-content:center;"
+              >
+                <SvgIcons name="clear-cache" />
+              </span>
+            </button>
+          </div>
+        </div>
+      {/if}
     </div>
-    {/if}
   </div>
-</div>
 {/if}
 
 <style>
@@ -401,7 +518,9 @@
     border-radius: var(--unified-border-radius);
     border: var(--unified-border);
     box-shadow: var(--dynamic-widget-shadow) var(--current-player-shadow-color);
-    transition: background 0.25s, box-shadow 0.25s;
+    transition:
+      background 0.25s,
+      box-shadow 0.25s;
     backdrop-filter: var(--unified-backdrop-filter);
   }
   .settings-expander:hover {
@@ -423,7 +542,9 @@
     border-radius: var(--unified-border-radius);
     cursor: pointer;
     user-select: none;
-    transition: background 0.2s, margin-bottom 0.4s ease-out;
+    transition:
+      background 0.2s,
+      margin-bottom 0.4s ease-out;
     display: flex;
     align-items: center;
     height: var(--summary-height);
@@ -446,7 +567,7 @@
     right: 16px;
     top: 50%;
     transform: translateY(-50%) rotate(0deg);
-    transition: transform 0.4s cubic-bezier(0.4,0,0.2,1);
+    transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
   }
   .settings-expander.open .settings-expander__arrow {
     transform: translateY(-50%) rotate(180deg);
@@ -455,7 +576,10 @@
     overflow: hidden;
     max-height: 0;
     opacity: 0;
-    transition: max-height 0.5s cubic-bezier(0.4,0,0.2,1), opacity 0.3s cubic-bezier(0.4,0,0.2,1), padding 0.5s cubic-bezier(0.4,0,0.2,1);
+    transition:
+      max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1),
+      opacity 0.3s cubic-bezier(0.4, 0, 0.2, 1),
+      padding 0.5s cubic-bezier(0.4, 0, 0.2, 1);
     padding: 0 16px;
     display: flex;
     flex-direction: column;
@@ -508,13 +632,17 @@
     font-size: calc(var(--button-height) * 0.5);
     font-weight: bold;
     cursor: pointer;
-    transition: background 0.18s, color 0.18s, border 0.18s;
+    transition:
+      background 0.18s,
+      color 0.18s,
+      border 0.18s;
     display: flex;
     align-items: center;
     justify-content: center;
     padding: 0;
   }
-  .settings-expander__square-btn:hover, .settings-expander__square-btn.active {
+  .settings-expander__square-btn:hover,
+  .settings-expander__square-btn.active {
     background: var(--control-selected);
     color: var(--control-selected-text);
     border-color: var(--control-selected);
@@ -530,7 +658,7 @@
     padding: 0 0 0 12px;
     gap: 12px;
   }
-  
+
   .settings-expander__row-btn {
     background: var(--control-bg);
     color: var(--text-primary);
@@ -539,18 +667,22 @@
     padding: 0 calc(var(--button-height) * 0.3);
     height: var(--button-height);
     min-height: var(--button-height);
-    
+
     box-sizing: border-box;
     font-size: calc(var(--button-height) * 0.4);
     font-weight: 600;
     cursor: pointer;
-    transition: background 0.18s, color 0.18s, border 0.18s;
+    transition:
+      background 0.18s,
+      color 0.18s,
+      border 0.18s;
     display: flex;
     align-items: center;
     justify-content: center;
     white-space: nowrap;
   }
-  .settings-expander__row-btn:hover, .settings-expander__row-btn:focus {
+  .settings-expander__row-btn:hover,
+  .settings-expander__row-btn:focus {
     border-color: var(--control-selected);
     color: var(--text-primary);
     outline: none;
@@ -575,12 +707,8 @@
     text-align: center;
     font-size: 1.1em;
   }
- .locked-setting {
+  .locked-setting {
     opacity: 0.2;
     cursor: help;
   }
 </style>
-
-
-
-
diff --git a/src/lib/components/widgets/TopRowWidget.svelte b/src/lib/components/widgets/TopRowWidget.svelte
index ac7ad0d..50801a4 100644
--- a/src/lib/components/widgets/TopRowWidget.svelte
+++ b/src/lib/components/widgets/TopRowWidget.svelte
@@ -1,18 +1,18 @@
 <script lang="ts">
-  import { navigationService } from '$lib/services/navigationService.js';
-  import { _ } from 'svelte-i18n';
-  import SvgIcons from '../SvgIcons.svelte';
-  import { showGameInfoModal } from '$lib/utils/uiHelpers.js';
-  import { hotkeyTooltip } from '$lib/actions/hotkeyTooltip.js';
-  import { customTooltip } from '$lib/actions/customTooltip.js';
-  import { page } from '$app/stores';
-  import { onMount } from 'svelte';
-  import { get } from 'svelte/store';
-  import { modalService } from '$lib/services/modalService';
-  import { columnStyleMode } from '$lib/stores/columnStyleStore';
-  import { logService } from '$lib/services/logService.js';
-  import { uiStateStore } from '$lib/stores/uiStateStore';
-  import hotkeyService from '$lib/services/hotkeyService';
+  import { navigationService } from "$lib/services/navigationService.js";
+  import { _ } from "svelte-i18n";
+  import SvgIcons from "../SvgIcons.svelte";
+  import { showGameInfoModal } from "$lib/utils/uiHelpers.js";
+  import { hotkeyTooltip } from "$lib/actions/hotkeyTooltip.js";
+  import { customTooltip } from "$lib/actions/customTooltip.js";
+  import { page } from "$app/stores";
+  import { onMount } from "svelte";
+  import { get } from "svelte/store";
+  import { modalService } from "$lib/services/modalService";
+  import { columnStyleMode } from "$lib/stores/columnStyleStore";
+  import { logService } from "$lib/services/logService.js";
+  import { uiStateStore } from "$lib/stores/uiStateStore";
+  import hotkeyService from "$lib/services/hotkeyService";
 
   function handleMainMenuClick() {
     const uiState = get(uiStateStore);
@@ -24,43 +24,71 @@
   }
 
   function handleLocalSetupClick() {
-    navigationService.goTo('/local-setup');
+    navigationService.goTo("/local-setup");
   }
 
   onMount(() => {
-    hotkeyService.register('global', 'KeyI', showGameInfoModal);
-    hotkeyService.register('global', 'Escape', handleMainMenuClick);
+    hotkeyService.register("global", "KeyI", showGameInfoModal);
+    hotkeyService.register("global", "Escape", handleMainMenuClick);
   });
 </script>
 
-<style>
-  .game-board-top-row {
-    margin: 0;
-  }
-</style>
-
 <div class="game-board-top-row">
-  <button class="main-menu-btn" use:hotkeyTooltip={{ title: $_('gameBoard.mainMenu'), key: 'ESC' }} on:click={handleMainMenuClick} data-testid="top-row-main-menu-btn">
+  <button
+    class="main-menu-btn"
+    use:hotkeyTooltip={{ title: $_("gameBoard.mainMenu"), key: "ESC" }}
+    on:click={handleMainMenuClick}
+    data-testid="top-row-main-menu-btn"
+  >
     <SvgIcons name="home" />
   </button>
-  {#if $page.route.id?.includes('/game/local')}
-    <button class="main-menu-btn" use:customTooltip={$_('tooltips.localGameSettings')} on:click={handleLocalSetupClick} data-testid="local-game-settings-btn">
+  {#if $page.route.id?.includes("/game/local")}
+    <button
+      class="main-menu-btn"
+      use:customTooltip={$_("tooltips.localGameSettings")}
+      on:click={handleLocalSetupClick}
+      data-testid="local-game-settings-btn"
+    >
       <SvgIcons name="hamburger-menu" />
     </button>
   {/if}
-  <button class="main-menu-btn" use:hotkeyTooltip={{ title: $_('faq.title'), key: 'I' }} on:click={showGameInfoModal} data-testid="game-info-btn">
+  <button
+    class="main-menu-btn"
+    use:hotkeyTooltip={{ title: $_("faq.title"), key: "I" }}
+    on:click={showGameInfoModal}
+    data-testid="game-info-btn"
+  >
     <SvgIcons name="info" />
   </button>
   {#if false}
-    <button class="main-menu-btn" use:customTooltip={$columnStyleMode === 'editing' ? 'Switch to Fixed' : 'Switch to Editing'} on:click={() => columnStyleMode.update(v => v === 'fixed' ? 'editing' : 'fixed')} style="display: flex; align-items: center; justify-content: center;" data-testid="column-style-mode-btn">
+    <button
+      class="main-menu-btn"
+      use:customTooltip={$columnStyleMode === "flexible"
+        ? "Switch to Fixed"
+        : "Switch to Flexible"}
+      on:click={() =>
+        columnStyleMode.update((v) => (v === "fixed" ? "flexible" : "fixed"))}
+      style="display: flex; align-items: center; justify-content: center;"
+      data-testid="column-style-mode-btn"
+    >
       <SvgIcons name="palette" />
-      {#if $columnStyleMode === 'editing'}
-        <span style="display: flex; align-items: center; justify-content: center; margin-left: 4px;"><SvgIcons name="editing" /></span>
+      {#if $columnStyleMode === "flexible"}
+        <span
+          style="display: flex; align-items: center; justify-content: center; margin-left: 4px;"
+          ><SvgIcons name="editing" /></span
+        >
       {:else}
-        <span style="display: flex; align-items: center; justify-content: center; margin-left: 4px;"><SvgIcons name="fixed" /></span>
+        <span
+          style="display: flex; align-items: center; justify-content: center; margin-left: 4px;"
+          ><SvgIcons name="fixed" /></span
+        >
       {/if}
     </button>
   {/if}
-
 </div>
 
+<style>
+  .game-board-top-row {
+    margin: 0;
+  }
+</style>
diff --git a/src/lib/services/TimerService.ts b/src/lib/services/TimerService.ts
deleted file mode 100644
index 9f4d8d3..0000000
--- a/src/lib/services/TimerService.ts
+++ /dev/null
@@ -1,36 +0,0 @@
-// src/lib/services/TimerService.ts
-
-class TimerService {
-  private gameTimer: any = null;
-  private turnTimer: any = null;
-
-  public startGameTimer(duration: number, onTimeUp: () => void) {
-    this.stopGameTimer();
-    this.gameTimer = setTimeout(() => {
-      onTimeUp();
-    }, duration * 1000);
-  }
-
-  public stopGameTimer() {
-    if (this.gameTimer) {
-      clearTimeout(this.gameTimer);
-      this.gameTimer = null;
-    }
-  }
-
-  public startTurnTimer(duration: number, onTimeUp: () => void) {
-    this.stopTurnTimer();
-    this.turnTimer = setTimeout(() => {
-      onTimeUp();
-    }, duration * 1000);
-  }
-
-  public stopTurnTimer() {
-    if (this.turnTimer) {
-      clearTimeout(this.turnTimer);
-      this.turnTimer = null;
-    }
-  }
-}
-
-export const timerService = new TimerService();
diff --git a/src/lib/stores/boardStore.ts b/src/lib/stores/boardStore.ts
index 98773a1..c3c81a1 100644
--- a/src/lib/stores/boardStore.ts
+++ b/src/lib/stores/boardStore.ts
@@ -9,6 +9,7 @@ import { logService } from '$lib/services/logService';
 import { writable } from 'svelte/store';
 import { createEmptyBoard } from '$lib/utils/boardUtils';
 import type { MoveHistoryEntry } from '$lib/models/moveHistory';
+import type { MoveDirectionType } from '$lib/models/Piece';
 
 export interface BoardState {
   boardSize: number;
@@ -17,7 +18,7 @@ export interface BoardState {
   playerCol: number | null;
   cellVisitCounts: Record<string, number>;
   moveHistory: MoveHistoryEntry[];
-  moveQueue: Array<{ player: number; direction: string; distance: number; to: { row: number; col: number } }>;
+  moveQueue: Array<{ player: number; direction: MoveDirectionType; distance: number; to: { row: number; col: number } }>;
 }
 
 function createBoardStore() {
diff --git a/src/lib/stores/derivedState.ts b/src/lib/stores/derivedState.ts
index 1d10e76..7f8230f 100644
--- a/src/lib/stores/derivedState.ts
+++ b/src/lib/stores/derivedState.ts
@@ -127,8 +127,8 @@ export const visualPosition = derived(
     } else if ($animationStore.visualMoveQueue && $animationStore.visualMoveQueue.length > 0) {
       const lastAnimatedMove = $animationStore.visualMoveQueue[$animationStore.visualMoveQueue.length - 1];
       result = {
-        row: lastAnimatedMove.to?.row ?? $boardStore.playerRow,
-        col: lastAnimatedMove.to?.col ?? $boardStore.playerCol
+        row: lastAnimatedMove.row ?? $boardStore.playerRow,
+        col: lastAnimatedMove.col ?? $boardStore.playerCol
       };
       logService.piece(`(visualPosition) animation in progress, returning animated position: [${result.row}, ${result.col}]`);
     } else {
diff --git a/src/lib/stores/replayStore.ts b/src/lib/stores/replayStore.ts
index 76b3240..c19b568 100644
--- a/src/lib/stores/replayStore.ts
+++ b/src/lib/stores/replayStore.ts
@@ -4,7 +4,7 @@
  */
 
 import { writable } from 'svelte/store';
-import type { MoveHistoryEntry } from '$lib/stores/boardStore';
+import type { MoveHistoryEntry } from '$lib/models/moveHistory';
 
 export type AutoPlayDirection = 'paused' | 'forward' | 'backward';
 
diff --git a/src/routes/game/local/+page.svelte b/src/routes/game/local/+page.svelte
index 0eda489..9cf88c9 100644
--- a/src/routes/game/local/+page.svelte
+++ b/src/routes/game/local/+page.svelte
@@ -3,7 +3,7 @@
   import "$lib/css/components/game-board.css";
   import "$lib/css/components/controls.css";
   import DraggableColumns from "$lib/components/DraggableColumns.svelte";
-  import { layoutStore, WIDGETS } from "$lib/stores/layoutStore";
+  import { layoutStore, WIDGETS, type WidgetId } from "$lib/stores/layoutStore";
   import TopRowWidget from "$lib/components/widgets/TopRowWidget.svelte";
   import ScorePanelWidget from "$lib/components/widgets/ScorePanelWidget.svelte";
   import BoardWrapperWidget from "$lib/components/widgets/BoardWrapperWidget.svelte";
@@ -83,7 +83,7 @@
     : [];
 
   function itemContent(item: { id: string; label: string }) {
-    return widgetMap[item.id] || item.id;
+    return widgetMap[item.id as keyof typeof widgetMap] || item.id;
   }
 
   function handleDrop(
@@ -103,7 +103,7 @@
       return newCols.map((col) => {
         if (col.id === dropTargetCol) {
           const widgets = [...col.widgets];
-          widgets.splice(dropIndex, 0, dragging.id);
+          widgets.splice(dropIndex, 0, dragging.id as WidgetId);
           return { ...col, widgets };
         }
         return col;
@@ -127,4 +127,3 @@
   />
   <DevClearCacheButton />
 {/if}
-
diff --git a/src/routes/game/timed/+page.svelte b/src/routes/game/timed/+page.svelte
index 2a92d43..2b14fef 100644
--- a/src/routes/game/timed/+page.svelte
+++ b/src/routes/game/timed/+page.svelte
@@ -2,33 +2,37 @@
   // –ù–ê–í–Ü–©–û: –¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¢–Ü–õ–¨–ö–ò –∑–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–≥—Ä–æ–≤–∏—Ö –≤—ñ–¥–∂–µ—Ç—ñ–≤
   // —É –ø–æ—Ç—Ä—ñ–±–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –¥–ª—è —Ä–µ–∂–∏–º—É "–≥—Ä–∞ –Ω–∞ —á–∞—Å".
   // –í—Å—è —Å–ø—ñ–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ (–º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞, –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ) –≤–∏–Ω–µ—Å–µ–Ω–∞ –≤ layout.
-  
-  import '$lib/css/components/game-board.css';
-  import '$lib/css/components/controls.css';
-  import DraggableColumns from '$lib/components/DraggableColumns.svelte';
-  import { layoutStore, WIDGETS } from '$lib/stores/layoutStore';
-  import TopRowWidget from '$lib/components/widgets/TopRowWidget.svelte';
-  import ScorePanelWidget from '$lib/components/widgets/ScorePanelWidget.svelte';
-  import BoardWrapperWidget from '$lib/components/widgets/BoardWrapperWidget.svelte';
-  import ControlsPanelWidget from '$lib/components/widgets/ControlsPanelWidget.svelte';
-  import SettingsExpanderWidget from '$lib/components/widgets/SettingsExpanderWidget.svelte';
-  import GameInfoWidget from '$lib/components/widgets/GameInfoWidget.svelte';
-  import DevClearCacheButton from '$lib/components/widgets/DevClearCacheButton.svelte';
-  import TimerWidget from '$lib/components/widgets/TimerWidget.svelte';
-  import { onMount } from 'svelte';
-  import { animationService } from '$lib/services/animationService.js';
-  import { gameModeService } from '$lib/services/gameModeService';
-  import { get } from 'svelte/store';
-  import { boardStore } from '$lib/stores/boardStore';
-  import { logService } from '$lib/services/logService';
+
+  import "$lib/css/components/game-board.css";
+  import "$lib/css/components/controls.css";
+  import DraggableColumns from "$lib/components/DraggableColumns.svelte";
+  import { layoutStore, WIDGETS, type WidgetId } from "$lib/stores/layoutStore";
+  import TopRowWidget from "$lib/components/widgets/TopRowWidget.svelte";
+  import ScorePanelWidget from "$lib/components/widgets/ScorePanelWidget.svelte";
+  import BoardWrapperWidget from "$lib/components/widgets/BoardWrapperWidget.svelte";
+  import ControlsPanelWidget from "$lib/components/widgets/ControlsPanelWidget.svelte";
+  import SettingsExpanderWidget from "$lib/components/widgets/SettingsExpanderWidget.svelte";
+  import GameInfoWidget from "$lib/components/widgets/GameInfoWidget.svelte";
+  import DevClearCacheButton from "$lib/components/widgets/DevClearCacheButton.svelte";
+  import TimerWidget from "$lib/components/widgets/TimerWidget.svelte";
+  import { onMount } from "svelte";
+  import { animationService } from "$lib/services/animationService.js";
+  import { gameModeService } from "$lib/services/gameModeService";
+  import { get } from "svelte/store";
+  import { boardStore } from "$lib/stores/boardStore";
+  import { logService } from "$lib/services/logService";
 
   onMount(() => {
     const boardState = get(boardStore);
     if (!boardState || boardState.moveHistory.length <= 1) {
-        logService.init('[TimedGamePage] onMount: No active game found, initializing "timed" mode.');
-        gameModeService.initializeGameMode('timed');
+      logService.init(
+        '[TimedGamePage] onMount: No active game found, initializing "timed" mode.',
+      );
+      gameModeService.initializeGameMode("timed");
     } else {
-        logService.init('[TimedGamePage] onMount: Active game found, not re-initializing.');
+      logService.init(
+        "[TimedGamePage] onMount: Active game found, not re-initializing.",
+      );
     }
     animationService.initialize();
   });
@@ -43,31 +47,38 @@
     [WIDGETS.TIMER]: TimerWidget,
   };
 
-  $: columns = $layoutStore.map(col => ({
+  $: columns = $layoutStore.map((col) => ({
     id: col.id,
     label: col.id,
     items: col.widgets
-      .filter(id => id !== WIDGETS.PLAYER_TURN_INDICATOR)
-      .map(id => ({ id, label: id }))
+      .filter((id) => id !== WIDGETS.PLAYER_TURN_INDICATOR)
+      .map((id) => ({ id, label: id })),
   }));
 
-  function itemContent(item: {id: string, label: string}) {
-    const Comp = widgetMap[item.id];
+  function itemContent(item: { id: string; label: string }) {
+    const Comp = widgetMap[item.id as keyof typeof widgetMap];
     if (Comp) return Comp;
     return item.id;
   }
 
-  function handleDrop(e: CustomEvent<{dragging: {id: string, label: string}, dragSourceCol: string, dropTargetCol: string, dropIndex: number}>) {
+  function handleDrop(
+    e: CustomEvent<{
+      dragging: { id: string; label: string };
+      dragSourceCol: string;
+      dropTargetCol: string;
+      dropIndex: number;
+    }>,
+  ) {
     const { dragging, dragSourceCol, dropTargetCol, dropIndex } = e.detail;
-    layoutStore.update(cols => {
-      let newCols = cols.map(col => ({
+    layoutStore.update((cols) => {
+      let newCols = cols.map((col) => ({
         ...col,
-        widgets: col.widgets.filter(id => id !== dragging.id)
+        widgets: col.widgets.filter((id) => id !== dragging.id),
       }));
-      return newCols.map(col => {
+      return newCols.map((col) => {
         if (col.id === dropTargetCol) {
           const widgets = [...col.widgets];
-          widgets.splice(dropIndex, 0, dragging.id);
+          widgets.splice(dropIndex, 0, dragging.id as WidgetId);
           return { ...col, widgets };
         }
         return col;
@@ -76,6 +87,5 @@
   }
 </script>
 
-  <DraggableColumns {columns} itemContent={itemContent} on:drop={handleDrop} />
-  <DevClearCacheButton />
-
+<DraggableColumns {columns} {itemContent} on:drop={handleDrop} />
+<DevClearCacheButton />
diff --git a/src/routes/game/training/+page.svelte b/src/routes/game/training/+page.svelte
index 51fbccb..194862a 100644
--- a/src/routes/game/training/+page.svelte
+++ b/src/routes/game/training/+page.svelte
@@ -2,40 +2,43 @@
   // –ù–ê–í–Ü–©–û: –¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Ç–µ–ø–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¢–Ü–õ–¨–ö–ò –∑–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–≥—Ä–æ–≤–∏—Ö –≤—ñ–¥–∂–µ—Ç—ñ–≤
   // —É –ø–æ—Ç—Ä—ñ–±–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –¥–ª—è —Ä–µ–∂–∏–º—É "–≥—Ä–∞ –ø—Ä–æ—Ç–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞".
   // –í—Å—è —Å–ø—ñ–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ (–º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞, –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ) –≤–∏–Ω–µ—Å–µ–Ω–∞ –≤ layout.
-  
-  import '$lib/css/components/game-board.css';
-  import '$lib/css/components/controls.css';
-  import DraggableColumns from '$lib/components/DraggableColumns.svelte';
-  import { layoutStore, WIDGETS } from '$lib/stores/layoutStore';
-  import TopRowWidget from '$lib/components/widgets/TopRowWidget.svelte';
-  import ScorePanelWidget from '$lib/components/widgets/ScorePanelWidget.svelte';
-  import BoardWrapperWidget from '$lib/components/widgets/BoardWrapperWidget.svelte';
-  import ControlsPanelWidget from '$lib/components/widgets/ControlsPanelWidget.svelte';
-  import SettingsExpanderWidget from '$lib/components/widgets/SettingsExpanderWidget.svelte';
-  import GameInfoWidget from '$lib/components/widgets/GameInfoWidget.svelte';
-  import DevClearCacheButton from '$lib/components/widgets/DevClearCacheButton.svelte';
-  import TimerWidget from '$lib/components/widgets/TimerWidget.svelte';
-  import GameModeWidget from '$lib/components/widgets/GameModeWidget.svelte';
-  
-  import { onMount } from 'svelte';
-  import { animationService } from '$lib/services/animationService.js';
-  import { gameModeService } from '$lib/services/gameModeService';
-  import { logService } from '$lib/services/logService';
 
-  import { get } from 'svelte/store';
-  import { boardStore } from '$lib/stores/boardStore';
+  import "$lib/css/components/game-board.css";
+  import "$lib/css/components/controls.css";
+  import DraggableColumns from "$lib/components/DraggableColumns.svelte";
+  import { layoutStore, WIDGETS, type WidgetId } from "$lib/stores/layoutStore";
+  import TopRowWidget from "$lib/components/widgets/TopRowWidget.svelte";
+  import ScorePanelWidget from "$lib/components/widgets/ScorePanelWidget.svelte";
+  import BoardWrapperWidget from "$lib/components/widgets/BoardWrapperWidget.svelte";
+  import ControlsPanelWidget from "$lib/components/widgets/ControlsPanelWidget.svelte";
+  import SettingsExpanderWidget from "$lib/components/widgets/SettingsExpanderWidget.svelte";
+  import GameInfoWidget from "$lib/components/widgets/GameInfoWidget.svelte";
+  import DevClearCacheButton from "$lib/components/widgets/DevClearCacheButton.svelte";
+  import TimerWidget from "$lib/components/widgets/TimerWidget.svelte";
+  import GameModeWidget from "$lib/components/widgets/GameModeWidget.svelte";
+
+  import { onMount } from "svelte";
+  import { animationService } from "$lib/services/animationService.js";
+  import { gameModeService } from "$lib/services/gameModeService";
+  import { logService } from "$lib/services/logService";
+
+  import { get } from "svelte/store";
+  import { boardStore } from "$lib/stores/boardStore";
 
   onMount(() => {
     const boardState = get(boardStore);
     if (!boardState || boardState.moveHistory.length <= 1) {
-        logService.init('[TrainingPage] onMount: No active game found, initializing "training" mode.');
-        gameModeService.initializeGameMode('training');
+      logService.init(
+        '[TrainingPage] onMount: No active game found, initializing "training" mode.',
+      );
+      gameModeService.initializeGameMode("training");
     } else {
-        logService.init('[TrainingPage] onMount: Active game found, not re-initializing.');
+      logService.init(
+        "[TrainingPage] onMount: Active game found, not re-initializing.",
+      );
     }
   });
 
-
   const widgetMap = {
     [WIDGETS.TOP_ROW]: TopRowWidget,
     [WIDGETS.SCORE_PANEL]: ScorePanelWidget,
@@ -45,38 +48,46 @@
     [WIDGETS.GAME_INFO]: GameInfoWidget,
     [WIDGETS.TIMER]: TimerWidget,
     [WIDGETS.GAME_MODE]: GameModeWidget,
-    
   };
 
-    $: columns = $layoutStore.map(col => ({
+  $: columns = $layoutStore.map((col) => ({
     id: col.id,
     label: col.id,
     items: col.widgets
-      .filter(id => id !== WIDGETS.PLAYER_TURN_INDICATOR && id !== WIDGETS.TIMER)
-      .map(id => ({ id, label: id }))
+      .filter(
+        (id) => id !== WIDGETS.PLAYER_TURN_INDICATOR && id !== WIDGETS.TIMER,
+      )
+      .map((id) => ({ id, label: id })),
   }));
 
   // –ù–ê–í–Ü–©–û: –õ–æ–≥—ñ–∫–∞ –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç—É—Ç, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞
   // –¥–ª—è —ñ–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, –∞ –Ω–µ –¥–ª—è layout
   // –¶—è –ª–æ–≥—ñ–∫–∞ —Ç–µ–ø–µ—Ä –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –≤ `endGame` –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –≥—Ä–∏
 
-  function itemContent(item: {id: string, label: string}) {
-    const Comp = widgetMap[item.id];
+  function itemContent(item: { id: string; label: string }) {
+    const Comp = widgetMap[item.id as keyof typeof widgetMap];
     if (Comp) return Comp;
     return item.id;
   }
 
-  function handleDrop(e: CustomEvent<{dragging: {id: string, label: string}, dragSourceCol: string, dropTargetCol: string, dropIndex: number}>) {
+  function handleDrop(
+    e: CustomEvent<{
+      dragging: { id: string; label: string };
+      dragSourceCol: string;
+      dropTargetCol: string;
+      dropIndex: number;
+    }>,
+  ) {
     const { dragging, dragSourceCol, dropTargetCol, dropIndex } = e.detail;
-    layoutStore.update(cols => {
-      let newCols = cols.map(col => ({
+    layoutStore.update((cols) => {
+      let newCols = cols.map((col) => ({
         ...col,
-        widgets: col.widgets.filter(id => id !== dragging.id)
+        widgets: col.widgets.filter((id) => id !== dragging.id),
       }));
-      return newCols.map(col => {
+      return newCols.map((col) => {
         if (col.id === dropTargetCol) {
           const widgets = [...col.widgets];
-          widgets.splice(dropIndex, 0, dragging.id);
+          widgets.splice(dropIndex, 0, dragging.id as WidgetId);
           return { ...col, widgets };
         }
         return col;
@@ -85,6 +96,5 @@
   }
 </script>
 
-  <DraggableColumns {columns} itemContent={itemContent} on:drop={handleDrop} />
-  <DevClearCacheButton />
-
+<DraggableColumns {columns} {itemContent} on:drop={handleDrop} />
+<DevClearCacheButton />
diff --git a/src/routes/game/virtual-player/+page.svelte b/src/routes/game/virtual-player/+page.svelte
index 1611ea5..f986c9c 100644
--- a/src/routes/game/virtual-player/+page.svelte
+++ b/src/routes/game/virtual-player/+page.svelte
@@ -2,48 +2,50 @@
   // –ù–ê–í–Ü–©–û: –¶—è —Å—Ç–æ—Ä—ñ–Ω–∫–∞ —Ç–µ–ø–µ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –¢–Ü–õ–¨–ö–ò –∑–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–≥—Ä–æ–≤–∏—Ö –≤—ñ–¥–∂–µ—Ç—ñ–≤
   // —É –ø–æ—Ç—Ä—ñ–±–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É –¥–ª—è —Ä–µ–∂–∏–º—É "–≥—Ä–∞ –ø—Ä–æ—Ç–∏ –∫–æ–º–ø'—é—Ç–µ—Ä–∞".
   // –í—Å—è —Å–ø—ñ–ª—å–Ω–∞ –ª–æ–≥—ñ–∫–∞ (–º–æ–¥–∞–ª—å–Ω—ñ –≤—ñ–∫–Ω–∞, –≥–∞—Ä—è—á—ñ –∫–ª–∞–≤—ñ—à—ñ) –≤–∏–Ω–µ—Å–µ–Ω–∞ –≤ layout.
-  
-  import '$lib/css/components/game-board.css';
-  import '$lib/css/components/controls.css';
-  import DraggableColumns from '$lib/components/DraggableColumns.svelte';
-  import { layoutStore, WIDGETS } from '$lib/stores/layoutStore';
-  import TopRowWidget from '$lib/components/widgets/TopRowWidget.svelte';
-  import ScorePanelWidget from '$lib/components/widgets/ScorePanelWidget.svelte';
-  import BoardWrapperWidget from '$lib/components/widgets/BoardWrapperWidget.svelte';
-  import ControlsPanelWidget from '$lib/components/widgets/ControlsPanelWidget.svelte';
-  import SettingsExpanderWidget from '$lib/components/widgets/SettingsExpanderWidget.svelte';
-  import GameInfoWidget from '$lib/components/widgets/GameInfoWidget.svelte';
-  import DevClearCacheButton from '$lib/components/widgets/DevClearCacheButton.svelte';
-  import TimerWidget from '$lib/components/widgets/TimerWidget.svelte';
-  import GameModeWidget from '$lib/components/widgets/GameModeWidget.svelte';
-  
-  import { onMount } from 'svelte';
-  import { animationService } from '$lib/services/animationService.js';
-  import { gameModeService } from '$lib/services/gameModeService';
-  import { logService } from '$lib/services/logService';
 
-  import { get } from 'svelte/store';
-  import { boardStore } from '$lib/stores/boardStore';
-  import { gameSettingsStore } from '$lib/stores/gameSettingsStore.js';
+  import "$lib/css/components/game-board.css";
+  import "$lib/css/components/controls.css";
+  import DraggableColumns from "$lib/components/DraggableColumns.svelte";
+  import { layoutStore, WIDGETS, type WidgetId } from "$lib/stores/layoutStore";
+  import TopRowWidget from "$lib/components/widgets/TopRowWidget.svelte";
+  import ScorePanelWidget from "$lib/components/widgets/ScorePanelWidget.svelte";
+  import BoardWrapperWidget from "$lib/components/widgets/BoardWrapperWidget.svelte";
+  import ControlsPanelWidget from "$lib/components/widgets/ControlsPanelWidget.svelte";
+  import SettingsExpanderWidget from "$lib/components/widgets/SettingsExpanderWidget.svelte";
+  import GameInfoWidget from "$lib/components/widgets/GameInfoWidget.svelte";
+  import DevClearCacheButton from "$lib/components/widgets/DevClearCacheButton.svelte";
+  import TimerWidget from "$lib/components/widgets/TimerWidget.svelte";
+  import GameModeWidget from "$lib/components/widgets/GameModeWidget.svelte";
+
+  import { onMount } from "svelte";
+  import { animationService } from "$lib/services/animationService.js";
+  import { gameModeService } from "$lib/services/gameModeService";
+  import { logService } from "$lib/services/logService";
+
+  import { get } from "svelte/store";
+  import { boardStore } from "$lib/stores/boardStore";
+  import { gameSettingsStore } from "$lib/stores/gameSettingsStore.js";
 
   onMount(() => {
     const boardState = get(boardStore);
     // Only initialize if there is no game in progress.
     if (!boardState || boardState.moveHistory.length <= 1) {
-        const settings = get(gameSettingsStore);
-        const selectedMode = settings.gameMode;
-        
-        logService.init(`[VirtualPlayerPage] onMount: No active game. Initializing mode from settings: "${selectedMode}"`);
-        
-        // Use the mode from settings, but have a fallback just in case.
-        gameModeService.initializeGameMode(selectedMode || 'virtual-player');
+      const settings = get(gameSettingsStore);
+      const selectedMode = settings.gameMode;
+
+      logService.init(
+        `[VirtualPlayerPage] onMount: No active game. Initializing mode from settings: "${selectedMode}"`,
+      );
 
+      // Use the mode from settings, but have a fallback just in case.
+      gameModeService.initializeGameMode(selectedMode || "virtual-player");
     } else {
-        logService.init('[VirtualPlayerPage] onMount: Active game found, not re-initializing.');
+      logService.init(
+        "[VirtualPlayerPage] onMount: Active game found, not re-initializing.",
+      );
     }
   });
 
-
   const widgetMap = {
     [WIDGETS.TOP_ROW]: TopRowWidget,
     [WIDGETS.SCORE_PANEL]: ScorePanelWidget,
@@ -53,42 +55,49 @@
     [WIDGETS.GAME_INFO]: GameInfoWidget,
     [WIDGETS.TIMER]: TimerWidget,
     [WIDGETS.GAME_MODE]: GameModeWidget,
-    
   };
 
-  $: columns = $layoutStore.map(col => ({
+  $: columns = $layoutStore.map((col) => ({
     id: col.id,
     label: col.id,
     items: col.widgets
-      .filter(id => {
+      .filter((id) => {
         if (id === WIDGETS.PLAYER_TURN_INDICATOR) return false;
-        if (id === WIDGETS.TIMER && $gameSettingsStore.gameMode !== 'timed') return false;
+        if (id === WIDGETS.TIMER && $gameSettingsStore.gameMode !== "timed")
+          return false;
         return true;
       })
-      .map(id => ({ id, label: id }))
+      .map((id) => ({ id, label: id })),
   }));
 
   // –ù–ê–í–Ü–©–û: –õ–æ–≥—ñ–∫–∞ –º–æ–¥–∞–ª—å–Ω–∏—Ö –≤—ñ–∫–æ–Ω –∑–∞–ª–∏—à–∞—î—Ç—å—Å—è —Ç—É—Ç, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∞
   // –¥–ª—è —ñ–≥—Ä–æ–≤–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—É, –∞ –Ω–µ –¥–ª—è layout
   // –¶—è –ª–æ–≥—ñ–∫–∞ —Ç–µ–ø–µ—Ä –æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è –≤ `endGame` –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –≥—Ä–∏
 
-  function itemContent(item: {id: string, label: string}) {
-    const Comp = widgetMap[item.id];
+  function itemContent(item: { id: string; label: string }) {
+    const Comp = widgetMap[item.id as keyof typeof widgetMap];
     if (Comp) return Comp;
     return item.id;
   }
 
-  function handleDrop(e: CustomEvent<{dragging: {id: string, label: string}, dragSourceCol: string, dropTargetCol: string, dropIndex: number}>) {
+  function handleDrop(
+    e: CustomEvent<{
+      dragging: { id: string; label: string };
+      dragSourceCol: string;
+      dropTargetCol: string;
+      dropIndex: number;
+    }>,
+  ) {
     const { dragging, dragSourceCol, dropTargetCol, dropIndex } = e.detail;
-    layoutStore.update(cols => {
-      let newCols = cols.map(col => ({
+    layoutStore.update((cols) => {
+      let newCols = cols.map((col) => ({
         ...col,
-        widgets: col.widgets.filter(id => id !== dragging.id)
+        widgets: col.widgets.filter((id) => id !== dragging.id),
       }));
-      return newCols.map(col => {
+      return newCols.map((col) => {
         if (col.id === dropTargetCol) {
           const widgets = [...col.widgets];
-          widgets.splice(dropIndex, 0, dragging.id);
+          widgets.splice(dropIndex, 0, dragging.id as WidgetId);
           return { ...col, widgets };
         }
         return col;
@@ -97,6 +106,5 @@
   }
 </script>
 
-  <DraggableColumns {columns} itemContent={itemContent} on:drop={handleDrop} />
-  <DevClearCacheButton />
-
+<DraggableColumns {columns} {itemContent} on:drop={handleDrop} />
+<DevClearCacheButton />
