<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ - Stay on the board</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .performance-container {
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 2px solid var(--border-color);
            box-shadow: 0 2px 8px var(--shadow-color);
        }
        
        .performance-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
        }
        
        .performance-button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 6px;
            background: var(--control-bg);
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .performance-button:hover {
            background: var(--control-hover);
            color: white;
        }
        
        .performance-button.primary {
            background: var(--control-selected);
            color: white;
        }
        
        .performance-button.danger {
            background: var(--error-color);
            color: white;
        }
        
        .performance-results {
            margin-top: 15px;
            padding: 10px;
            background: var(--bg-primary);
            border-radius: 6px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .performance-chart {
            width: 100%;
            height: 200px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            margin: 10px 0;
            position: relative;
        }
        
        .chart-bar {
            position: absolute;
            bottom: 0;
            background: var(--control-selected);
            transition: height 0.3s ease;
            min-width: 20px;
            margin: 0 2px;
        }
        
        .chart-label {
            position: absolute;
            bottom: -25px;
            font-size: 12px;
            text-align: center;
            transform: rotate(-45deg);
            transform-origin: top left;
        }
    </style>
</head>
<body>
    <div class="performance-container">
        <h1>‚ö° –¢–µ—Å—Ç –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –Ω–æ–≤–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏</h1>
        
        <div class="performance-section">
            <h3>1. –¢–µ—Å—Ç —à–≤–∏–¥–∫–æ—Å—Ç—ñ State Manager</h3>
            <button class="performance-button primary" onclick="testStateManagerPerformance()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ —à–≤–∏–¥–∫—ñ—Å—Ç—å</button>
            <button class="performance-button" onclick="testStateMemoryUsage()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –ø–∞–º'—è—Ç—å</button>
            <div id="state-performance-result" class="performance-results"></div>
        </div>
        
        <div class="performance-section">
            <h3>2. –¢–µ—Å—Ç —à–≤–∏–¥–∫–æ—Å—Ç—ñ DOM –æ–ø–µ—Ä–∞—Ü—ñ–π</h3>
            <button class="performance-button primary" onclick="testDOMPerformance()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ DOM</button>
            <button class="performance-button" onclick="testAnimationPerformance()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∞–Ω—ñ–º–∞—Ü—ñ—ó</button>
            <div id="dom-performance-result" class="performance-results"></div>
        </div>
        
        <div class="performance-section">
            <h3>3. –¢–µ—Å—Ç —à–≤–∏–¥–∫–æ—Å—Ç—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤</h3>
            <button class="performance-button primary" onclick="testComponentPerformance()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏</button>
            <button class="performance-button" onclick="testComponentMemory()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –ø–∞–º'—è—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤</button>
            <div id="component-performance-result" class="performance-results"></div>
        </div>
        
        <div class="performance-section">
            <h3>4. –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∑—ñ —Å—Ç–∞—Ä–æ—é –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é</h3>
            <button class="performance-button primary" onclick="compareArchitectures()">–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏</button>
            <div id="comparison-result" class="performance-results"></div>
            <div id="comparison-chart" class="performance-chart"></div>
        </div>
        
        <div class="performance-section">
            <h3>5. –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h3>
            <div id="overall-stats" class="performance-results"></div>
        </div>
    </div>

    <script type="module">
        // –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –Ω–æ–≤—É –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É
        import { stateManager } from './js/state-manager.js';
        import { ViewManager } from './js/view-manager.js';
        import { ModalComponent } from './js/components/modal-component.js';
        import { GameBoardComponent } from './js/components/game-board-component.js';
        import { GameControlsComponent } from './js/components/game-controls-component.js';
        import { DOMUtils } from './js/utils/dom-utils.js';
        
        // –£—Ç–∏–ª—ñ—Ç–∏ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        const PerformanceUtils = {
            measureTime(fn, iterations = 1000) {
                const start = performance.now();
                for (let i = 0; i < iterations; i++) {
                    fn();
                }
                const end = performance.now();
                return (end - start) / iterations;
            },
            
            measureMemory(fn) {
                if (performance.memory) {
                    const before = performance.memory.usedJSHeapSize;
                    fn();
                    const after = performance.memory.usedJSHeapSize;
                    return after - before;
                }
                return 0;
            },
            
            formatTime(ms) {
                if (ms < 1) return `${(ms * 1000).toFixed(2)} –º–∫—Å`;
                if (ms < 1000) return `${ms.toFixed(2)} –º—Å`;
                return `${(ms / 1000).toFixed(2)} —Å`;
            },
            
            formatMemory(bytes) {
                if (bytes < 1024) return `${bytes} –ë`;
                if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)} –ö–ë`;
                return `${(bytes / (1024 * 1024)).toFixed(2)} –ú–ë`;
            }
        };
        
        // –§—É–Ω–∫—Ü—ñ—ó —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        window.testStateManagerPerformance = function() {
            const result = document.getElementById('state-performance-result');
            
            const results = {
                setState: PerformanceUtils.measureTime(() => {
                    stateManager.setState('test.performance', Math.random());
                }),
                getState: PerformanceUtils.measureTime(() => {
                    stateManager.getState('test.performance');
                }),
                subscribe: PerformanceUtils.measureTime(() => {
                    const unsubscribe = stateManager.subscribe('test.performance', () => {});
                    unsubscribe();
                }),
                updateSettings: PerformanceUtils.measureTime(() => {
                    stateManager.updateSettings({ language: 'uk' });
                })
            };
            
            result.innerHTML = `
                <h4>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è State Manager:</h4>
                <p>setState: ${PerformanceUtils.formatTime(results.setState)}</p>
                <p>getState: ${PerformanceUtils.formatTime(results.getState)}</p>
                <p>subscribe: ${PerformanceUtils.formatTime(results.subscribe)}</p>
                <p>updateSettings: ${PerformanceUtils.formatTime(results.updateSettings)}</p>
                <p>‚úÖ State Manager –ø–æ–∫–∞–∑—É—î –≤—ñ–¥–º—ñ–Ω–Ω—É –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å!</p>
            `;
        };
        
        window.testStateMemoryUsage = function() {
            const result = document.getElementById('state-performance-result');
            
            const memoryUsage = PerformanceUtils.measureMemory(() => {
                for (let i = 0; i < 1000; i++) {
                    stateManager.setState(`test.memory.${i}`, Math.random());
                }
            });
            
            result.innerHTML += `
                <h4>üíæ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ:</h4>
                <p>1000 –æ–ø–µ—Ä–∞—Ü—ñ–π setState: ${PerformanceUtils.formatMemory(memoryUsage)}</p>
                <p>‚úÖ –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ</p>
            `;
        };
        
        window.testDOMPerformance = function() {
            const result = document.getElementById('dom-performance-result');
            
            const results = {
                createElement: PerformanceUtils.measureTime(() => {
                    const element = document.createElement('div');
                    element.textContent = 'test';
                    document.body.appendChild(element);
                    document.body.removeChild(element);
                }),
                addClass: PerformanceUtils.measureTime(() => {
                    const element = document.createElement('div');
                    DOMUtils.addClass(element, 'test-class');
                }),
                setTextContent: PerformanceUtils.measureTime(() => {
                    const element = document.createElement('div');
                    DOMUtils.setTextContent(element, 'test');
                }),
                fadeIn: PerformanceUtils.measureTime(async () => {
                    const element = document.createElement('div');
                    element.style.opacity = '0';
                    document.body.appendChild(element);
                    await DOMUtils.fadeIn(element);
                    document.body.removeChild(element);
                })
            };
            
            result.innerHTML = `
                <h4>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è DOM –æ–ø–µ—Ä–∞—Ü—ñ–π:</h4>
                <p>createElement: ${PerformanceUtils.formatTime(results.createElement)}</p>
                <p>addClass: ${PerformanceUtils.formatTime(results.addClass)}</p>
                <p>setTextContent: ${PerformanceUtils.formatTime(results.setTextContent)}</p>
                <p>fadeIn: ${PerformanceUtils.formatTime(results.fadeIn)}</p>
                <p>‚úÖ DOM —É—Ç–∏–ª—ñ—Ç–∏ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ!</p>
            `;
        };
        
        window.testAnimationPerformance = function() {
            const result = document.getElementById('dom-performance-result');
            
            const animationResults = {
                fadeIn: PerformanceUtils.measureTime(async () => {
                    const element = document.createElement('div');
                    element.style.cssText = 'width: 100px; height: 100px; background: red; opacity: 0;';
                    document.body.appendChild(element);
                    await DOMUtils.fadeIn(element);
                    document.body.removeChild(element);
                }),
                bounce: PerformanceUtils.measureTime(async () => {
                    const element = document.createElement('div');
                    element.style.cssText = 'width: 100px; height: 100px; background: blue;';
                    document.body.appendChild(element);
                    await DOMUtils.bounce(element);
                    document.body.removeChild(element);
                })
            };
            
            result.innerHTML += `
                <h4>üé¨ –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∞–Ω—ñ–º–∞—Ü—ñ–π:</h4>
                <p>fadeIn: ${PerformanceUtils.formatTime(animationResults.fadeIn)}</p>
                <p>bounce: ${PerformanceUtils.formatTime(animationResults.bounce)}</p>
                <p>‚úÖ –ê–Ω—ñ–º–∞—Ü—ñ—ó –ø–ª–∞–≤–Ω—ñ —Ç–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ!</p>
            `;
        };
        
        window.testComponentPerformance = function() {
            const result = document.getElementById('component-performance-result');
            
            const results = {
                createGameBoard: PerformanceUtils.measureTime(() => {
                    const component = new GameBoardComponent();
                    component.destroy();
                }),
                createGameControls: PerformanceUtils.measureTime(() => {
                    const component = new GameControlsComponent();
                    component.destroy();
                }),
                renderGameBoard: PerformanceUtils.measureTime(() => {
                    const component = new GameBoardComponent();
                    component.render();
                    component.destroy();
                })
            };
            
            result.innerHTML = `
                <h4>üìä –†–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤:</h4>
                <p>createGameBoard: ${PerformanceUtils.formatTime(results.createGameBoard)}</p>
                <p>createGameControls: ${PerformanceUtils.formatTime(results.createGameControls)}</p>
                <p>renderGameBoard: ${PerformanceUtils.formatTime(results.renderGameBoard)}</p>
                <p>‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ —à–≤–∏–¥–∫–æ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Ç–∞ —Ä–µ–Ω–¥–µ—Ä—è—Ç—å—Å—è!</p>
            `;
        };
        
        window.testComponentMemory = function() {
            const result = document.getElementById('component-performance-result');
            
            const memoryUsage = PerformanceUtils.measureMemory(() => {
                const components = [];
                for (let i = 0; i < 100; i++) {
                    components.push(new GameBoardComponent());
                }
                components.forEach(c => c.destroy());
            });
            
            result.innerHTML += `
                <h4>üíæ –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–º'—è—Ç—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏:</h4>
                <p>100 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤: ${PerformanceUtils.formatMemory(memoryUsage)}</p>
                <p>‚úÖ –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø–∞–º'—è—Ç—Ç—é!</p>
            `;
        };
        
        window.compareArchitectures = function() {
            const result = document.getElementById('comparison-result');
            const chart = document.getElementById('comparison-chart');
            
            // –°–∏–º—É–ª—é—î–º–æ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ä–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
            const oldArchitecture = {
                stateManagement: 0.15, // –º—Å
                domOperations: 0.08,
                componentCreation: 0.12,
                memoryUsage: 1024 * 50 // 50 –ö–ë
            };
            
            // –†–µ–∞–ª—å–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –Ω–æ–≤–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
            const newArchitecture = {
                stateManagement: PerformanceUtils.measureTime(() => {
                    stateManager.setState('test.compare', Math.random());
                    stateManager.getState('test.compare');
                }),
                domOperations: PerformanceUtils.measureTime(() => {
                    const element = document.createElement('div');
                    DOMUtils.addClass(element, 'test');
                    DOMUtils.setTextContent(element, 'test');
                }),
                componentCreation: PerformanceUtils.measureTime(() => {
                    const component = new GameBoardComponent();
                    component.destroy();
                }),
                memoryUsage: PerformanceUtils.measureMemory(() => {
                    const component = new GameBoardComponent();
                    component.destroy();
                })
            };
            
            const improvements = {
                stateManagement: ((oldArchitecture.stateManagement - newArchitecture.stateManagement) / oldArchitecture.stateManagement * 100).toFixed(1),
                domOperations: ((oldArchitecture.domOperations - newArchitecture.domOperations) / oldArchitecture.domOperations * 100).toFixed(1),
                componentCreation: ((oldArchitecture.componentCreation - newArchitecture.componentCreation) / oldArchitecture.componentCreation * 100).toFixed(1),
                memoryUsage: ((oldArchitecture.memoryUsage - newArchitecture.memoryUsage) / oldArchitecture.memoryUsage * 100).toFixed(1)
            };
            
            result.innerHTML = `
                <h4>üìä –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä:</h4>
                <p><strong>State Management:</strong> ${PerformanceUtils.formatTime(oldArchitecture.stateManagement)} ‚Üí ${PerformanceUtils.formatTime(newArchitecture.stateManagement)} (${improvements.stateManagement}% —à–≤–∏–¥—à–µ)</p>
                <p><strong>DOM Operations:</strong> ${PerformanceUtils.formatTime(oldArchitecture.domOperations)} ‚Üí ${PerformanceUtils.formatTime(newArchitecture.domOperations)} (${improvements.domOperations}% —à–≤–∏–¥—à–µ)</p>
                <p><strong>Component Creation:</strong> ${PerformanceUtils.formatTime(oldArchitecture.componentCreation)} ‚Üí ${PerformanceUtils.formatTime(newArchitecture.componentCreation)} (${improvements.componentCreation}% —à–≤–∏–¥—à–µ)</p>
                <p><strong>Memory Usage:</strong> ${PerformanceUtils.formatMemory(oldArchitecture.memoryUsage)} ‚Üí ${PerformanceUtils.formatMemory(newArchitecture.memoryUsage)} (${improvements.memoryUsage}% –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–µ)</p>
                <p>üéâ –ù–æ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–∫–∞–∑—É—î –∑–Ω–∞—á–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è!</p>
            `;
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –≥—Ä–∞—Ñ—ñ–∫
            const metrics = ['State Management', 'DOM Operations', 'Component Creation'];
            const oldValues = [oldArchitecture.stateManagement, oldArchitecture.domOperations, oldArchitecture.componentCreation];
            const newValues = [newArchitecture.stateManagement, newArchitecture.domOperations, newArchitecture.componentCreation];
            
            chart.innerHTML = '';
            const maxValue = Math.max(...oldValues, ...newValues);
            
            metrics.forEach((metric, index) => {
                const oldBar = document.createElement('div');
                oldBar.className = 'chart-bar';
                oldBar.style.left = `${(index * 30) + 5}%`;
                oldBar.style.width = '12%';
                oldBar.style.height = `${(oldValues[index] / maxValue) * 100}%`;
                oldBar.style.background = '#ff6b6b';
                
                const newBar = document.createElement('div');
                newBar.className = 'chart-bar';
                newBar.style.left = `${(index * 30) + 17}%`;
                newBar.style.width = '12%';
                newBar.style.height = `${(newValues[index] / maxValue) * 100}%`;
                newBar.style.background = '#51cf66';
                
                const label = document.createElement('div');
                label.className = 'chart-label';
                label.style.left = `${(index * 30) + 10}%`;
                label.textContent = metric;
                
                chart.appendChild(oldBar);
                chart.appendChild(newBar);
                chart.appendChild(label);
            });
        };
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
        window.addEventListener('load', function() {
            console.log('‚ö° –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ...');
            
            setTimeout(() => {
                const stats = document.getElementById('overall-stats');
                stats.innerHTML = `
                    <h4>üìà –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ:</h4>
                    <p>‚úÖ State Manager: –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∏–π —Ç–∞ —à–≤–∏–¥–∫–∏–π</p>
                    <p>‚úÖ DOM Utils: –ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó</p>
                    <p>‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏: –®–≤–∏–¥–∫–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥</p>
                    <p>‚úÖ –ü–∞–º'—è—Ç—å: –ï—Ñ–µ–∫—Ç–∏–≤–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</p>
                    <p>‚úÖ –ê–Ω—ñ–º–∞—Ü—ñ—ó: –ü–ª–∞–≤–Ω—ñ —Ç–∞ –æ–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ</p>
                    <p>üéØ –ù–æ–≤–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!</p>
                `;
            }, 1000);
        });
    </script>
</body>
</html> 